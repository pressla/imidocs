
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://imitrix.de/docs/print_page/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.3">
    
    
      
        <title>Print Site - imitrix docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d7758b05.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
    <script>__md_scope=new URL("/docs/",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="imitrix docs" class="md-header__button md-logo" aria-label="imitrix docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            imitrix docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print Site
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="imitrix docs" class="md-nav__button md-logo" aria-label="imitrix docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    imitrix docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-behavioral-patterns-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Behavioral Patterns Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-patterns-part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Patterns Part 3
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-deployment-ch3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 3 - Deployments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-chap-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-chap-5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-chap-6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-daemon-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Daemon Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-batch-job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Batch Job
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-periodic-job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Periodic Job
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-ingress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingress
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-kind/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kind Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rke2-deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RKE2 Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-traefik/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Traefik on RKE2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-deployment-opensource/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open Source K8s Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-rke2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible on RKE2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-harbor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Harbor Registry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-portworkx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Portworx Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-airflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Airflow
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Monitoring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-loki/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loki
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tools & References
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Tools & References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubecheat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mkdocscheat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vim-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vim Commands
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../windows-disk-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows Disk Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../opensuse-disk-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenSUSE Disk Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../opensuse-usb-devices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenSUSE USB Devices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wsl2-linux-mint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WSL2 Linux Mint Setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Other
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Other
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../30-100/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    30-100
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../streamlit-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streamlit Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#" class="md-nav__link">
    <span class="md-ellipsis">
      1. Home
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-kubernetes-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      I. Kubernetes Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="I. Kubernetes Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kube-behavioral-patterns-intro" class="md-nav__link">
    <span class="md-ellipsis">
      2. Behavioral Patterns Intro
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-patterns-part3" class="md-nav__link">
    <span class="md-ellipsis">
      3. Patterns Part 3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-kubernetes-core" class="md-nav__link">
    <span class="md-ellipsis">
      II. Kubernetes Core
    </span>
  </a>
  
    <nav class="md-nav" aria-label="II. Kubernetes Core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kube-deployment-ch3" class="md-nav__link">
    <span class="md-ellipsis">
      4. Chapter 3 - Deployments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-chap-4" class="md-nav__link">
    <span class="md-ellipsis">
      5. Chapter 4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-chap-5" class="md-nav__link">
    <span class="md-ellipsis">
      6. Chapter 5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-chap-6" class="md-nav__link">
    <span class="md-ellipsis">
      7. Chapter 6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-app" class="md-nav__link">
    <span class="md-ellipsis">
      8. Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-kubernetes-services" class="md-nav__link">
    <span class="md-ellipsis">
      III. Kubernetes Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III. Kubernetes Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kube-daemon-service" class="md-nav__link">
    <span class="md-ellipsis">
      9. Daemon Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-batch-job" class="md-nav__link">
    <span class="md-ellipsis">
      10. Batch Job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-periodic-job" class="md-nav__link">
    <span class="md-ellipsis">
      11. Periodic Job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      12. Ingress
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      IV. Infrastructure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IV. Infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kube-kind" class="md-nav__link">
    <span class="md-ellipsis">
      13. Kind Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rke2-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      14. RKE2 Deployment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-traefik" class="md-nav__link">
    <span class="md-ellipsis">
      15. Traefik on RKE2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-deployment-opensource" class="md-nav__link">
    <span class="md-ellipsis">
      16. Open Source K8s Stack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-rke2" class="md-nav__link">
    <span class="md-ellipsis">
      17. Ansible on RKE2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-harbor" class="md-nav__link">
    <span class="md-ellipsis">
      18. Harbor Registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-portworkx" class="md-nav__link">
    <span class="md-ellipsis">
      19. Portworx Storage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-airflow" class="md-nav__link">
    <span class="md-ellipsis">
      20. Airflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      V. Monitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="V. Monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kube-loki" class="md-nav__link">
    <span class="md-ellipsis">
      21. Loki
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-tools-references" class="md-nav__link">
    <span class="md-ellipsis">
      VI. Tools & References
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VI. Tools & References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubecheat" class="md-nav__link">
    <span class="md-ellipsis">
      22. Kubernetes Cheatsheet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mkdocscheat" class="md-nav__link">
    <span class="md-ellipsis">
      23. MkDocs Cheatsheet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vim-commands" class="md-nav__link">
    <span class="md-ellipsis">
      24. Vim Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-disk-management" class="md-nav__link">
    <span class="md-ellipsis">
      25. Windows Disk Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opensuse-disk-management" class="md-nav__link">
    <span class="md-ellipsis">
      26. OpenSUSE Disk Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opensuse-usb-devices" class="md-nav__link">
    <span class="md-ellipsis">
      27. OpenSUSE USB Devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsl2-linux-mint" class="md-nav__link">
    <span class="md-ellipsis">
      28. WSL2 Linux Mint Setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-other" class="md-nav__link">
    <span class="md-ellipsis">
      VII. Other
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VII. Other">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#30-100" class="md-nav__link">
    <span class="md-ellipsis">
      29. 30-100
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streamlit-guide" class="md-nav__link">
    <span class="md-ellipsis">
      30. Streamlit Guide
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index"><h1 id="index-welcome-to-imitrix-docs">Welcome to Imitrix Docs<a class="headerlink" href="#index-welcome-to-imitrix-docs" title="Permanent link">&para;</a></h1>
<p>Welcome to the official documentation hub for Imitrix. This documentation serves as a comprehensive collection of guides, cheat sheets, and reference materials for various tools and technologies.</p>
<h2 id="index-available-documentation">Available Documentation<a class="headerlink" href="#index-available-documentation" title="Permanent link">&para;</a></h2>
<h3 id="index-kubernetes-resources">Kubernetes Resources<a class="headerlink" href="#index-kubernetes-resources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="#kubecheat">Kubernetes Cheat Sheet</a> - Quick reference guide for common Kubernetes commands and operations</li>
<li><a href="#kube-kind">Kind Kubernetes</a> - Guide for working with Kind (Kubernetes in Docker)</li>
<li><a href="#rke2-deployment">RKE2 Deployment</a> - Instructions for deploying RKE2 clusters</li>
<li><a href="#kube-deployment-pattern-rh.md">Kubernetes Deployment Patterns</a> - Guide to deployment strategies and patterns in Kubernetes</li>
</ul>
<h3 id="index-development-tools">Development Tools<a class="headerlink" href="#index-development-tools" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="#vim-commands">Vim Commands</a> - Reference guide for Vim text editor commands</li>
<li><a href="#mkdocscheat">MkDocs Cheat Sheet</a> - Quick reference for MkDocs documentation system</li>
<li><a href="#streamlit-guide">Streamlit Guide</a> - Guide for working with Streamlit applications</li>
</ul>
<h2 id="index-documentation-features">Documentation Features<a class="headerlink" href="#index-documentation-features" title="Permanent link">&para;</a></h2>
<p>This documentation is built with MkDocs using the Material theme and includes support for:</p>
<ul>
<li>Mermaid diagrams for visualizing workflows and architectures</li>
<li>PlantUML for UML diagrams</li>
<li>Code syntax highlighting</li>
<li>Advanced markdown features</li>
</ul>
<p>Feel free to navigate through the sections using the navigation menu to find detailed information about specific topics.</p></section>
                        <h1 class='nav-section-title' id='section-kubernetes-patterns'>
                            Kubernetes Patterns <a class='headerlink' href='#section-kubernetes-patterns' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="kube-behavioral-patterns-intro"><h1 id="kube-behavioral-patterns-intro-behavioral-patterns">Behavioral Patterns<a class="headerlink" href="#kube-behavioral-patterns-intro-behavioral-patterns" title="Permanent link">&para;</a></h1>
<p>The patterns in this category are focused on the communications and interactions between the Pods and the managing platform. Depending on the type of managing controller used, a Pod may run until completion or be scheduled to run periodically. It can run as a daemon or ensure uniqueness guarantees to its replicas. There are different ways to run a Pod on Kubernetes, and picking the right Pod-management primitives requires understanding their behavior.</p>
<p>In the following chapters, we explore the patterns:</p>
<ul>
<li>Chapter 7, "Batch Job", describes how to isolate an atomic unit of work and run it until completion.</li>
<li>Chapter 8, "Periodic Job", allows the execution of a unit of work to be triggered by a temporal event.</li>
<li>Chapter 9, "Daemon Service", allows you to run infrastructure-focused Pods on specific nodes, before application Pods are placed.</li>
<li>Chapter 10, "Singleton Service", ensures that only one instance of a service is active at a time and still remains highly available.</li>
<li>Chapter 11, "Stateless Service", describes the building blocks used for managing identical application instances.</li>
<li>Chapter 12, "Stateful Service", is all about how to create and manage distributed stateful applications with Kubernetes.</li>
<li>Chapter 13, "Service Discovery", explains how client services can discover and consume the instances of providing services.</li>
<li>Chapter 14, "Self Awareness", describes mechanisms for introspection and metadata injection into applications.</li>
</ul></section><section class="print-page" id="kube-patterns-part3"><h1 id="kube-patterns-part3-discussion-chapter-3-declarative-deployment">Discussion (Chapter 3 - Declarative Deployment)<a class="headerlink" href="#kube-patterns-part3-discussion-chapter-3-declarative-deployment" title="Permanent link">&para;</a></h1>
<p>The Deployment primitive is an example of Kubernetes turning the tedious process of manually updating applications into a declarative activity that can be repeated and automated. The out-of-the-box deployment strategies (rolling and recreate) control the replacement of old containers by new ones, and the advanced release strategies (Blue-Green and canary) control how the new version becomes available to service consumers. The latter two release strategies are based on a human decision for the transition trigger and as a consequence are not fully automated by Kubernetes but require human interaction.</p>
<p>All software is different, and deploying complex systems usually requires additional steps and checks. The techniques discussed in this chapter cover the Pod update process, but do not include updating and rolling back other Pod dependencies such as ConfigMaps, Secrets, or other dependent services.</p>
<h2 id="kube-patterns-part3-pre-and-post-deployment-hooks">Pre and Post Deployment Hooks<a class="headerlink" href="#kube-patterns-part3-pre-and-post-deployment-hooks" title="Permanent link">&para;</a></h2>
<p>In the past, there has been a proposal for Kubernetes to allow hooks in the deployment process. Pre and Post hooks would allow the execution of custom commands before and after Kubernetes has executed a deployment strategy. Such commands could perform additional actions while the deployment is in progress and would additionally be able to abort, retry, or continue a deployment. Those hooks are a good step toward new automated deployment and release strategies. Unfortunately, this effort has been stalled for some years (as of 2023), so it is unclear whether this feature will ever come to Kubernetes.</p>
<p>One approach that works today is to create a script to manage the update process of services and their dependencies using the Deployment and other primitives discussed in this book. However, this imperative approach that describes the individual update steps does not match the declarative nature of Kubernetes.</p>
<p>As an alternative, higher-level declarative approaches have emerged on top of Kubernetes. The most important platforms are described in the sidebar that follows. Those techniques work with operators (see Chapter 28, "Operator") that take a declarative description of the rollout process and perform the necessary actions on the server side, some of them also including automatic rollbacks in case of an update error. For advanced, production-ready rollout scenarios, it is recommended to look at one of those extensions.</p>
<h2 id="kube-patterns-part3-higher-level-deployments">Higher-Level Deployments<a class="headerlink" href="#kube-patterns-part3-higher-level-deployments" title="Permanent link">&para;</a></h2>
<p>The Deployment resource is a good abstraction over ReplicaSets and Pods to allow a simple declarative rollout that a handful of parameters can tune. However, as we have seen, Deployment does not support more sophisticated strategies like canary or Blue-Green deployments directly. There are higher-level abstractions that enhance Kubernetes by introducing new resource types, enabling the declaration of more flexible deployment strategies. Those extensions all leverage the Operator pattern described in Chapter 28 and introduce their own custom resources for describing the desired rollout behavior.</p>
<p>As of 2023, the most prominent platforms that support higher-level Deployments include the following:</p>
<h3 id="kube-patterns-part3-flagger">Flagger<a class="headerlink" href="#kube-patterns-part3-flagger" title="Permanent link">&para;</a></h3>
<p>Flagger implements several deployment strategies and is part of the Flux CD GitOps tools. It supports canary and Blue-Green deployments and integrates with many ingress controllers and service meshes to provide the necessary traffic split between your app's old and new versions. It can also monitor the status of the rollout process based on a custom metric and detect if the rollout fails so that it can trigger an automatic rollback.</p>
<h3 id="kube-patterns-part3-argo-rollouts">Argo Rollouts<a class="headerlink" href="#kube-patterns-part3-argo-rollouts" title="Permanent link">&para;</a></h3>
<p>The focus on this part of the Argo family of tools is on providing a comprehensive and opinionated continuous delivery (CD) solution for Kubernetes. Argo Rollouts support advanced deployment strategies, like Flagger, and integrate into many ingress controllers and service meshes. It has very similar capabilities to Flagger, so the decision about which one to use should be based on which CD solution you prefer, Argo or Flux.</p>
<h3 id="kube-patterns-part3-knative">Knative<a class="headerlink" href="#kube-patterns-part3-knative" title="Permanent link">&para;</a></h3>
<p>Knative is a serverless platform on top of Kubernetes. A core feature of Knative is traffic-driven autoscaling support, which is described in detail in Chapter 29, "Elastic Scale". Knative also provides a simplified deployment model and traffic splitting, which is very helpful for supporting high-level deployment rollouts. The support for rollout or rollbacks is not as advanced as with Flagger or Argo Rollouts but is still a substantial improvement over the rollout capabilities of Kubernetes Deployments. If you are using Knative anyway, the intuitive way of splitting traffic between two application versions is a good alternative to Deployments.</p>
<p>Like Kubernetes, all of these projects are part of the Cloud Native Computing Foundation (CNCF) project and have excellent community support.</p>
<p>Regardless of the deployment strategy you are using, it is essential for Kubernetes to know when your application Pods are up and running to perform the required sequence of steps to reach the defined target deployment state. The next pattern, Health Probe, describes how your application can communicate its health state to Kubernetes.</p>
<h2 id="kube-patterns-part3-more-information">More Information<a class="headerlink" href="#kube-patterns-part3-more-information" title="Permanent link">&para;</a></h2>
<ul>
<li>Declarative Deployment Example</li>
<li>Performing a Rolling Update</li>
<li>Deployments</li>
<li>Run a Stateless Application Using a Deployment</li>
<li>Blue-Green Deployment</li>
<li>Canary Release</li>
<li>Flagger: Deployment Strategies</li>
<li>Argo Rollouts</li>
<li>Knative: Traffic Management</li>
</ul>
<h1 id="kube-patterns-part3-chapter-4-health-probe">Chapter 4: Health Probe<a class="headerlink" href="#kube-patterns-part3-chapter-4-health-probe" title="Permanent link">&para;</a></h1>
<p>The Health Probe pattern indicates how an application can communicate its health state to Kubernetes. To be fully automatable, a cloud native application must be highly observable by allowing its state to be inferred so that Kubernetes can detect whether the application is up and whether it is ready to serve requests. These observations influence the lifecycle management of Pods and the way traffic is routed to the application.</p>
<h2 id="kube-patterns-part3-problem">Problem<a class="headerlink" href="#kube-patterns-part3-problem" title="Permanent link">&para;</a></h2>
<p>Kubernetes regularly checks the container process status and restarts it if issues are detected. However, from practice, we know that checking the process status is not sufficient to determine the health of an application. In many cases, an application hangs, but its process is still up and running. For example, a Java application may throw an OutOfMemoryError and still have the JVM process running. Alternatively, an application may freeze because it runs into an infinite loop, deadlock, or some thrashing (cache, heap, process). To detect these kinds of situations, Kubernetes needs a reliable way to check the health of applications—that is, not to understand how an application works internally, but to check whether the application is functioning as expected and capable of serving consumers.</p>
<h2 id="kube-patterns-part3-solution">Solution<a class="headerlink" href="#kube-patterns-part3-solution" title="Permanent link">&para;</a></h2>
<p>The software industry has accepted the fact that it is not possible to write bug-free code. Moreover, the chances for failure increase even more when working with distributed applications. As a result, the focus for dealing with failures has shifted from avoiding them to detecting faults and recovering. Detecting failure is not a simple task that can be performed uniformly for all applications, as everyone has different definitions of a failure. Also, various types of failures require different corrective actions. Transient failures may self-recover, given enough time, and some other failures may need a restart of the application. Let's look at the checks Kubernetes uses to detect and correct failures.</p>
<h3 id="kube-patterns-part3-process-health-checks">Process Health Checks<a class="headerlink" href="#kube-patterns-part3-process-health-checks" title="Permanent link">&para;</a></h3>
<p>A process health check is the simplest health check the Kubelet constantly performs on the container processes. If the container processes are not running, the container is restarted on the node to which the Pod is assigned. So even without any other health checks, the application becomes slightly more robust with this generic check. If your application is capable of detecting any kind of failure and shutting itself down, the process health check is all you need. However, for most cases, that is not enough, and other types of health checks are also necessary.</p>
<h3 id="kube-patterns-part3-liveness-probes">Liveness Probes<a class="headerlink" href="#kube-patterns-part3-liveness-probes" title="Permanent link">&para;</a></h3>
<p>If your application runs into a deadlock, it is still considered healthy from the process health check's point of view. To detect this kind of issue and any other types of failure according to your application business logic, Kubernetes has liveness probes—regular checks performed by the Kubelet agent that asks your container to confirm it is still healthy. It is important to have the health check performed from the outside rather than in the application itself, as some failures may prevent the application watchdog from reporting its failure. Regarding corrective action, this health check is similar to a process health check, since if a failure is detected, the container is restarted. However, it offers more flexibility regarding which methods to use for checking the application health, as follows:</p>
<ul>
<li><strong>HTTP probe</strong>: Performs an HTTP GET request to the container IP address and expects a successful HTTP response code between 200 and 399.</li>
<li><strong>TCP Socket probe</strong>: Assumes a successful TCP connection.</li>
<li><strong>Exec probe</strong>: Executes an arbitrary command in the container's user and kernel namespace and expects a successful exit code (0).</li>
<li><strong>gRPC probe</strong>: Leverages gRPC's intrinsic support for health checks.</li>
</ul>
<p>In addition to the probe action, the health check behavior can be influenced with the following parameters:</p>
<ul>
<li><strong>initialDelaySeconds</strong>: Specifies the number of seconds to wait until the first liveness probe is checked.</li>
<li><strong>periodSeconds</strong>: The interval in seconds between liveness probe checks.</li>
<li><strong>timeoutSeconds</strong>: The maximum time allowed for a probe check to return before it is considered to have failed.</li>
<li><strong>failureThreshold</strong>: Specifies how many times a probe check needs to fail in a row until the container is considered to be unhealthy and needs to be restarted.</li>
</ul>
<p>Example of an HTTP-based liveness probe:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-with-liveness-check</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">    </span><span class="nt">env</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DELAY_STARTUP</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20&quot;</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">    </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">      </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">                  </span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/actuator/health</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w">   </span>
</code></pre></div>
<p>Depending on the nature of your application, you can choose the method that is most suitable for you. It is up to your application to decide whether it considers itself healthy or not. However, keep in mind that the result of not passing a health check is that your container will restart. If restarting your container does not help, there is no benefit to having a failing health check as Kubernetes restarts your container without fixing the underlying issue.</p>
<h3 id="kube-patterns-part3-readiness-probes">Readiness Probes<a class="headerlink" href="#kube-patterns-part3-readiness-probes" title="Permanent link">&para;</a></h3>
<p>Liveness checks help keep applications healthy by killing unhealthy containers and replacing them with new ones. But sometimes, when a container is not healthy, restarting it may not help. A typical example is a container that is still starting up and is not ready to handle any requests. Another example is an application that is still waiting for a dependency like a database to be available. Also, a container can be overloaded, increasing its latency, so you want it to shield itself from the additional load for a while and indicate that it is not ready until the load decreases.</p>
<p>For this kind of scenario, Kubernetes has readiness probes. The methods (HTTP, TCP, Exec, gRPC) and timing options for performing readiness checks are the same as for liveness checks, but the corrective action is different. Rather than restarting the container, a failed readiness probe causes the container to be removed from the service endpoint and not receive any new traffic.</p>
<p>Example of a readiness probe:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-with-readiness-check</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">    </span><span class="nt">readinessProbe</span><span class="p">:</span>
<span class="w">      </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;stat&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/var/run/random-generator-ready&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
</code></pre></div>
<h3 id="kube-patterns-part3-custom-pod-readiness-gates">Custom Pod Readiness Gates<a class="headerlink" href="#kube-patterns-part3-custom-pod-readiness-gates" title="Permanent link">&para;</a></h3>
<p>Readiness probes work on a per-container level, and a Pod is considered ready to serve requests when all containers pass their readiness probes. In some situations, this is not good enough—for example, when an external load balancer like the AWS LoadBalancer needs to be reconfigured and ready too. In this case, the readinessGates field of a Pod's specification can be used to specify extra conditions that need to be met for the Pod to become ready.</p>
<p>Example of a readiness gate:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">readinessGates</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">conditionType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;k8spatterns.io/load-balancer-ready&quot;</span>
<span class="nt">status</span><span class="p">:</span>
<span class="w">  </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;k8spatterns.io/load-balancer-ready&quot;</span>
<span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;False&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ready</span>
<span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;False&quot;</span>
</code></pre></div>
<h3 id="kube-patterns-part3-startup-probes">Startup Probes<a class="headerlink" href="#kube-patterns-part3-startup-probes" title="Permanent link">&para;</a></h3>
<p>When applications take minutes to start (for example, Jakarta EE application servers), Kubernetes provides startup probes. Startup probes are configured with the same format as liveness probes but allow for different values for the probe action and the timing parameters.</p>
<p>Example of a startup probe:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-with-startup-check</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/wildfly/wildfly</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wildfly</span>
<span class="w">    </span><span class="nt">startupProbe</span><span class="p">:</span>
<span class="w">      </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;stat&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/opt/jboss/wildfly/standalone/tmp/startup-marker&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">      </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">    </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">      </span><span class="nt">httpGet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9990</span>
<span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">        </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</code></pre></div>
<h2 id="kube-patterns-part3-discussion">Discussion<a class="headerlink" href="#kube-patterns-part3-discussion" title="Permanent link">&para;</a></h2>
<p>To be fully automatable, cloud native applications must be highly observable by providing a means for the managing platform to read and interpret the application health, and if necessary, take corrective actions. Health checks play a fundamental role in the automation of activities such as deployment, self-healing, scaling, and others.</p>
<p>The obvious and old method for this purpose is through logging. It is a good practice for containers to log any significant events to system out and system error and have these logs collected to a central location for further analysis. Apart from logging to standard streams, it is also a good practice to log the reason for exiting a container to /dev/termination-log.</p>
<p>Containers provide a unified way for packaging and running applications by treating them like opaque systems. However, any container that is aiming to become a cloud native citizen must provide APIs for the runtime environment to observe the container health and act accordingly.</p>
<p>Even-better-behaving applications must also provide other means for the managing platform to observe the state of the containerized application by integrating with tracing and metrics-gathering libraries such as OpenTracing or Prometheus.</p>
<h2 id="kube-patterns-part3-more-information_1">More Information<a class="headerlink" href="#kube-patterns-part3-more-information_1" title="Permanent link">&para;</a></h2>
<ul>
<li>Health Probe Example</li>
<li>Configure Liveness, Readiness, and Startup Probes</li>
<li>Kubernetes Best Practices: Setting Up Health Checks with Readiness and Liveness Probes</li>
<li>Graceful Shutdown with Node.js and Kubernetes</li>
<li>Kubernetes Startup Probe—Practical Guide</li>
<li>Improving Application Availability with Pod Readiness Gates</li>
<li>Customizing the Termination Message</li>
<li>SmallRye Health</li>
<li>Spring Boot Actuator: Production-Ready Features</li>
<li>Advanced Health Check Patterns in Kubernetes</li>
</ul>
<h1 id="kube-patterns-part3-chapter-5-managed-lifecycle">Chapter 5: Managed Lifecycle<a class="headerlink" href="#kube-patterns-part3-chapter-5-managed-lifecycle" title="Permanent link">&para;</a></h1>
<p>Containerized applications managed by cloud native platforms have no control over their lifecycle, and to be good cloud native citizens, they have to listen to the events emitted by the managing platform and adapt their lifecycles accordingly. The Managed Lifecycle pattern describes how applications can and should react to these lifecycle events.</p>
<h2 id="kube-patterns-part3-problem_1">Problem<a class="headerlink" href="#kube-patterns-part3-problem_1" title="Permanent link">&para;</a></h2>
<p>In Chapter 4, "Health Probe", we explained why containers have to provide APIs for the different health checks. Health-check APIs are read-only endpoints the platform is continually probing to get application insight. It is a mechanism for the platform to extract information from the application.</p>
<p>In addition to monitoring the state of a container, the platform sometimes may issue commands and expect the application to react to them. Driven by policies and external factors, a cloud native platform may decide to start or stop the applications it is managing at any moment. It is up to the containerized application to determine which events are important to react to and how to react.</p>
<h2 id="kube-patterns-part3-solution_1">Solution<a class="headerlink" href="#kube-patterns-part3-solution_1" title="Permanent link">&para;</a></h2>
<p>We saw that checking only the process status is not a good enough indication of the health of an application. That is why there are different APIs for monitoring the health of a container. Similarly, using only the process model to run and stop a process is not good enough. Real-world applications require more fine-grained interactions and lifecycle management capabilities.</p>
<h3 id="kube-patterns-part3-sigterm-signal">SIGTERM Signal<a class="headerlink" href="#kube-patterns-part3-sigterm-signal" title="Permanent link">&para;</a></h3>
<p>Whenever Kubernetes decides to shut down a container, whether that is because the Pod it belongs to is shutting down or simply because a failed liveness probe causes the container to be restarted, the container receives a SIGTERM signal. SIGTERM is a gentle poke for the container to shut down cleanly before Kubernetes sends a more abrupt SIGKILL signal.</p>
<h3 id="kube-patterns-part3-sigkill-signal">SIGKILL Signal<a class="headerlink" href="#kube-patterns-part3-sigkill-signal" title="Permanent link">&para;</a></h3>
<p>If a container process has not shut down after a SIGTERM signal, it is shut down forcefully by the following SIGKILL signal. Kubernetes does not send the SIGKILL signal immediately but waits 30 seconds by default after it has issued a SIGTERM signal.</p>
<h3 id="kube-patterns-part3-poststart-hook">PostStart Hook<a class="headerlink" href="#kube-patterns-part3-poststart-hook" title="Permanent link">&para;</a></h3>
<p>Using only process signals for managing lifecycles is somewhat limited. That is why additional lifecycle hooks such as postStart and preStop are provided by Kubernetes.</p>
<p>Example of a postStart hook:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">post-start-hook</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">    </span><span class="nt">lifecycle</span><span class="p">:</span>
<span class="w">      </span><span class="nt">postStart</span><span class="p">:</span>
<span class="w">        </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sleep 30 &amp;&amp; echo &quot;Wake up!&quot; &gt; /tmp/postStart_done</span>
</code></pre></div>
<h3 id="kube-patterns-part3-prestop-hook">PreStop Hook<a class="headerlink" href="#kube-patterns-part3-prestop-hook" title="Permanent link">&para;</a></h3>
<p>The preStop hook is a blocking call sent to a container before it is terminated. It has the same semantics as the SIGTERM signal and should be used to initiate a graceful shutdown of the container when reacting to SIGTERM is not possible.</p>
<p>Example of a preStop hook:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pre-stop-hook</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">    </span><span class="nt">lifecycle</span><span class="p">:</span>
<span class="w">      </span><span class="nt">preStop</span><span class="p">:</span>
<span class="w">        </span><span class="nt">httpGet</span><span class="p">:</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shutdown</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div>
<h2 id="kube-patterns-part3-discussion_1">Discussion<a class="headerlink" href="#kube-patterns-part3-discussion_1" title="Permanent link">&para;</a></h2>
<p>One of the main benefits the cloud native platform provides is the ability to run and scale applications reliably and predictably on top of potentially unreliable cloud infrastructure. These platforms provide a set of constraints and contracts for an application running on them. It is in the interest of the application to honor these contracts to benefit from all of the capabilities offered by the cloud native platform.</p>
<p>Besides managing the application lifecycle, the other big duty of orchestration platforms like Kubernetes is to distribute containers over a fleet of nodes. The next pattern, Automated Placement, explains the options to influence the scheduling decisions from the outside.</p>
<h2 id="kube-patterns-part3-more-information_2">More Information<a class="headerlink" href="#kube-patterns-part3-more-information_2" title="Permanent link">&para;</a></h2>
<ul>
<li>Managed Lifecycle Example</li>
<li>Container Lifecycle Hooks</li>
<li>Attach Handlers to Container Lifecycle Events</li>
<li>Kubernetes Best Practices: Terminating with Grace</li>
<li>Graceful Shutdown of Pods with Kubernetes</li>
<li>Argo and Tekton: Pushing the Boundaries of the Possible on Kubernetes</li>
<li>Russian Doll: Extending Containers with Nested Processes</li>
</ul>
<h1 id="kube-patterns-part3-chapter-6-automated-placement">Chapter 6: Automated Placement<a class="headerlink" href="#kube-patterns-part3-chapter-6-automated-placement" title="Permanent link">&para;</a></h1>
<p>Automated Placement is the core function of the Kubernetes scheduler for assigning new Pods to nodes that match container resource requests and honor scheduling policies. This pattern describes the principles of the Kubernetes scheduling algorithm and how to influence the placement decisions from the outside.</p>
<h2 id="kube-patterns-part3-problem_2">Problem<a class="headerlink" href="#kube-patterns-part3-problem_2" title="Permanent link">&para;</a></h2>
<p>A reasonably sized microservices-based system consists of tens or even hundreds of isolated processes. Containers and Pods do provide nice abstractions for packaging and deployment but do not solve the problem of placing these processes on suitable nodes. With a large and ever-growing number of microservices, assigning and placing them individually to nodes is not a manageable activity.</p>
<p>Containers have dependencies among themselves, dependencies to nodes, and resource demands, and all of that changes over time too. The resources available on a cluster also vary over time, through shrinking or extending the cluster or by having it consumed by already-placed containers. The way we place containers impacts the availability, performance, and capacity of the distributed systems as well. All of that makes scheduling containers to nodes a moving target.</p>
<h2 id="kube-patterns-part3-solution_2">Solution<a class="headerlink" href="#kube-patterns-part3-solution_2" title="Permanent link">&para;</a></h2>
<p>In Kubernetes, assigning Pods to nodes is done by the scheduler. It is a part of Kubernetes that is highly configurable, and it is still evolving and improving. The Kubernetes scheduler is a potent and time-saving tool. It plays a fundamental role in the Kubernetes platform as a whole, but similar to other Kubernetes components (API Server, Kubelet), it can be run in isolation or not used at all.</p>
<h3 id="kube-patterns-part3-available-node-resources">Available Node Resources<a class="headerlink" href="#kube-patterns-part3-available-node-resources" title="Permanent link">&para;</a></h3>
<p>First of all, the Kubernetes cluster needs to have nodes with enough resource capacity to run new Pods. Every node has capacity available for running Pods, and the scheduler ensures that the sum of the container resources requested for a Pod is less than the available allocatable node capacity.</p>
<p>Node capacity is calculated as:
<div class="highlight"><pre><span></span><code>Allocatable [capacity for application pods] =
    Node Capacity [available capacity on a node]
        - Kube-Reserved [Kubernetes daemons like kubelet, container runtime]
        - System-Reserved [Operating System daemons like sshd, udev]
        - Eviction Thresholds [Reserved memory to prevent system OOMs]
</code></pre></div></p>
<h3 id="kube-patterns-part3-container-resource-demands">Container Resource Demands<a class="headerlink" href="#kube-patterns-part3-container-resource-demands" title="Permanent link">&para;</a></h3>
<p>Another important requirement for an efficient Pod placement is to define the containers' runtime dependencies and resource demands. We covered that in more detail in Chapter 2, "Predictable Demands". It boils down to having containers that declare their resource profiles (with request and limit) and environment dependencies such as storage or ports.</p>
<h3 id="kube-patterns-part3-scheduler-configurations">Scheduler Configurations<a class="headerlink" href="#kube-patterns-part3-scheduler-configurations" title="Permanent link">&para;</a></h3>
<p>The scheduler has a default set of predicate and priority policies configured that is good enough for most use cases. In newer versions of Kubernetes, scheduling profiles are used to achieve customization. This approach exposes the different steps of the scheduling process as extension points and allows you to configure plugins that override the default implementations of the steps.</p>
<p>Example of a scheduler configuration:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubescheduler.config.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KubeSchedulerConfiguration</span>
<span class="nt">profiles</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">plugins</span><span class="p">:</span>
<span class="w">      </span><span class="nt">score</span><span class="p">:</span>
<span class="w">        </span><span class="nt">disabled</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodTopologySpread</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyCustomPlugin</span>
<span class="w">          </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</code></pre></div>
<p>By default, the scheduler uses the default-scheduler profile with default plugins. It is also possible to run multiple schedulers on the cluster, or multiple profiles on the scheduler, and allow Pods to specify which profile to use.</p>
<h3 id="kube-patterns-part3-node-selection">Node Selection<a class="headerlink" href="#kube-patterns-part3-node-selection" title="Permanent link">&para;</a></h3>
<p>In most cases, it is better to let the scheduler do the Pod-to-node assignment and not micromanage the placement logic. However, on some occasions, you may want to force the assignment of a Pod to a specific node or group of nodes.</p>
<p>Example of using nodeSelector:</p>
<p>```yaml
apiVersion: v1
kind: Pod
metadata:
  name: random-generator
spec:
  containers:
  - image: k8spatterns/random-generator:1.0
    name: random-generator
  nodeSelector:
    disktype: ssd</p></section><h1 class='nav-section-title-end'>Ended: Kubernetes Patterns</h1>
                        <h1 class='nav-section-title' id='section-kubernetes-core'>
                            Kubernetes Core <a class='headerlink' href='#section-kubernetes-core' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="kube-deployment-ch3"><h1 id="kube-deployment-ch3-kubernetes-deployment-patterns">Kubernetes Deployment Patterns<a class="headerlink" href="#kube-deployment-ch3-kubernetes-deployment-patterns" title="Permanent link">&para;</a></h1>
<p>foot <sup id="fnref:1"><a class="footnote-ref" href="#kube-deployment-ch3-fn:1">1</a></sup> </p>
<h2 id="kube-deployment-ch3-declarative-deployment">Declarative Deployment<a class="headerlink" href="#kube-deployment-ch3-declarative-deployment" title="Permanent link">&para;</a></h2>
<h3 id="kube-deployment-ch3-problem">Problem<a class="headerlink" href="#kube-deployment-ch3-problem" title="Permanent link">&para;</a></h3>
<p>As the number of microservices grows, the manual process of upgrading services—including starting the new Pod version, gracefully stopping the old one, verifying successful launches, and rolling back if necessary—becomes burdensome. Manual steps can lead to human errors, and scripting them requires significant effort. Kubernetes addresses this challenge with the <strong>Deployment</strong> resource, which automates application upgrades and makes them repeatable and efficient [<em>chapter 3</em>]</p>
<h3 id="kube-deployment-ch3-solution">Solution<a class="headerlink" href="#kube-deployment-ch3-solution" title="Permanent link">&para;</a></h3>
<p>The Kubernetes Deployment resource abstracts the complexities of managing upgrades and rollbacks of container groups. By defining the desired state, Kubernetes performs necessary actions to ensure the system conforms to that state. Deployment strategies supported include:</p>
<div class="admonition note rolling deployment">
<p class="admonition-title">Note</p>
<p>The default strategy that updates Pods incrementally to ensure zero downtime. It creates new Pods while progressively replacing old ones, adhering to parameters like <code>maxSurge</code> (temporary additional Pods) and <code>maxUnavailable</code> (maximum Pods unavailable during updates).</p>
</div>
<div class="admonition example kubectl rollout commands">
<p class="admonition-title">Example</p>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>kubectl rollout status</code></td>
<td>Shows the current status of a Deployment’s rollout.</td>
</tr>
<tr>
<td><code>kubectl rollout pause</code></td>
<td>Pauses a rolling update so that multiple changes can be applied to a Deployment without retriggering another rollout.</td>
</tr>
<tr>
<td><code>kubectl rollout resume</code></td>
<td>Resumes a previously paused rollout.</td>
</tr>
<tr>
<td><code>kubectl rollout undo</code></td>
<td>Performs a rollback to a previous revision of a Deployment. A rollback is helpful in case of an error during the update.</td>
</tr>
</tbody>
</table>
</div>
<p><em>Example configuration:</em></p>
<p class="annotate">Lorem ipsum dolor sit amet, (1) consectetur adipiscing elit.</p>
<ol>
<li>I'm an annotation! I can contain <code>code</code>, <strong>formatted
    text</strong>, images, ... basically anything that can be expressed in Markdown.</li>
</ol>
<p><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rolling-deployment</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="hll"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># (1)</span>
</span><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
<span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span>
<span class="hll"><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rolling-app</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rolling-app</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rolling-app</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-image:v1</span>
<span class="w">        </span><span class="nt">readinessProbe</span><span class="p">:</span>
<span class="w">          </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">            </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;stat&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/tmp/app-ready&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
{ .annotate }
1.  Declaration of three replicas. You need more than one replica for a rolling update to make sense.
2.  Number of Pods that can be run temporarily in addition to the replicas specified during an update. In this example, it could be a maximum of four replicas.
3.  Number of Pods that may be unavailable during the update. Here it could be that only two Pods are available at a time during the update.
4.  Duration in seconds of all readiness probes for a rolled-out Pod needs to be healthy until the rollout continues.
5.  Readiness probes that are very important for a rolling deployment to ensure zero downtime.</p>
<p><em>Figure 3-1. Rolling deployment strategy.</em></p>
<p><img alt="Rolling deployment strategy" src="../img/f3-1.png" /></p>
<h4 id="kube-deployment-ch3-recreate-deployment">Recreate Deployment<a class="headerlink" href="#kube-deployment-ch3-recreate-deployment" title="Permanent link">&para;</a></h4>
<p>This strategy stops all existing Pods before starting new ones, ensuring no overlap but introducing downtime.</p>
<p><em>Figure 3-2. Fixed deployment using a Recreate strategy.</em></p>
<p><img alt="Fixed deployment using a Recreate strategy" src="../img/f3-2.png" /></p>
<h4 id="kube-deployment-ch3-blue-green-deployment">Blue-Green Deployment<a class="headerlink" href="#kube-deployment-ch3-blue-green-deployment" title="Permanent link">&para;</a></h4>
<p>This strategy minimizes downtime by deploying a new version in parallel with the existing one. Once verified, traffic switches to the new version by updating the Service selector. Resources for the old version can then be released.</p>
<p><em>Figure 3-3. Blue-Green release.</em></p>
<p><img alt="Blue-Green release" src="../img/f3-3.png" /></p>
<h4 id="kube-deployment-ch3-canary-release">Canary Release<a class="headerlink" href="#kube-deployment-ch3-canary-release" title="Permanent link">&para;</a></h4>
<p>This approach gradually introduces a new version to a subset of users. If successful, it replaces the old version entirely. It involves managing two Deployments and adjusting traffic split using service mesh or ingress controllers</p>
<p><em>Figure 3-4. Canary release.</em></p>
<p><img alt="Canary release" src="../img/f3-4.png" /></p>
<h3 id="kube-deployment-ch3-advanced-deployment-strategies">Advanced Deployment Strategies<a class="headerlink" href="#kube-deployment-ch3-advanced-deployment-strategies" title="Permanent link">&para;</a></h3>
<h4 id="kube-deployment-ch3-pre-and-post-deployment-hooks">Pre- and Post-Deployment Hooks<a class="headerlink" href="#kube-deployment-ch3-pre-and-post-deployment-hooks" title="Permanent link">&para;</a></h4>
<p>These hooks were proposed to allow custom commands during deployments but are not fully implemented in Kubernetes. Current alternatives include higher-level abstractions using operators.</p>
<h4 id="kube-deployment-ch3-higher-level-platforms">Higher-Level Platforms<a class="headerlink" href="#kube-deployment-ch3-higher-level-platforms" title="Permanent link">&para;</a></h4>
<p>Platforms like Flagger (part of Flux CD), Argo Rollouts, and Knative provide advanced deployment strategies, integrating canary and blue-green mechanisms while supporting traffic splitting and rollbacks.</p>
<h3 id="kube-deployment-ch3-benefits-of-declarative-deployment">Benefits of Declarative Deployment<a class="headerlink" href="#kube-deployment-ch3-benefits-of-declarative-deployment" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Automation</strong>: Reduces manual intervention and human error.</li>
<li><strong>Repeatability</strong>: Ensures consistent results across environments.</li>
<li><strong>Observability</strong>: Provides monitoring capabilities and rollback mechanisms.</li>
<li><strong>Declarative Nature</strong>: Focuses on desired state rather than procedural steps.</li>
</ul>
<h3 id="kube-deployment-ch3-conclusion">Conclusion<a class="headerlink" href="#kube-deployment-ch3-conclusion" title="Permanent link">&para;</a></h3>
<p>Kubernetes’ Deployment abstraction simplifies service upgrades, balancing downtime, resource utilization, and operational risks. Advanced tools further enhance its capabilities, making it suitable for modern, scalable application environments.</p>
<p><em>Figure 3-5. Deployment and release strategies.</em></p>
<p><img alt="Deployment and release strategies" src="../img/f3-5.png" /></p>
<div class="footnote">
<hr />
<ol>
<li id="kube-deployment-ch3-fn:1">
<p>Kubernetes Patterns Reusable Elements for Designing
Cloud Native Applications&#160;<a class="footnote-backref" href="#kube-deployment-ch3-fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div></section><section class="print-page" id="kube-chap-4"><h1 id="kube-chap-4-chapter-4-health-probe">Chapter 4: Health Probe<a class="headerlink" href="#kube-chap-4-chapter-4-health-probe" title="Permanent link">&para;</a></h1>
<p>The Health Probe pattern enables applications to communicate their health state to Kubernetes, allowing automated management of Pods and traffic routing.</p>
<h2 id="kube-chap-4-problem">Problem<a class="headerlink" href="#kube-chap-4-problem" title="Permanent link">&para;</a></h2>
<p>Process status checks alone are insufficient for determining application health, as applications may hang while their processes remain running.</p>
<h2 id="kube-chap-4-solution">Solution<a class="headerlink" href="#kube-chap-4-solution" title="Permanent link">&para;</a></h2>
<h3 id="kube-chap-4-process-health-checks">Process Health Checks<a class="headerlink" href="#kube-chap-4-process-health-checks" title="Permanent link">&para;</a></h3>
<ul>
<li>Kubelet performs basic container process monitoring</li>
<li>Containers are restarted if processes stop running</li>
</ul>
<h3 id="kube-chap-4-liveness-probes">Liveness Probes<a class="headerlink" href="#kube-chap-4-liveness-probes" title="Permanent link">&para;</a></h3>
<p>Kubelet performs external health checks using:
- <strong>HTTP probe</strong>: HTTP GET request expecting 200-399 response
- <strong>TCP Socket probe</strong>: Requires successful TCP connection
- <strong>Exec probe</strong>: Command execution expecting exit code 0
- <strong>gRPC probe</strong>: Uses gRPC health checks</p>
<p>Configuration parameters:
- <strong>initialDelaySeconds</strong>: Delay before first check
- <strong>periodSeconds</strong>: Interval between checks
- <strong>timeoutSeconds</strong>: Maximum probe duration
- <strong>failureThreshold</strong>: Failed checks before unhealthy status</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-with-liveness-check</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">    </span><span class="nt">env</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DELAY_STARTUP</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20&quot;</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">    </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">      </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">                  </span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/actuator/health</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w">   </span>
</code></pre></div></p>
<h3 id="kube-chap-4-readiness-probes">Readiness Probes<a class="headerlink" href="#kube-chap-4-readiness-probes" title="Permanent link">&para;</a></h3>
<ul>
<li>Uses same methods as liveness probes (HTTP, TCP, Exec, gRPC)</li>
<li>Failed checks remove container from service endpoint</li>
<li>No container restart on failure</li>
</ul>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-with-readiness-check</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">    </span><span class="nt">readinessProbe</span><span class="p">:</span>
<span class="w">      </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;stat&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/var/run/random-generator-ready&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
</code></pre></div></p>
<h3 id="kube-chap-4-custom-pod-readiness-gates">Custom Pod Readiness Gates<a class="headerlink" href="#kube-chap-4-custom-pod-readiness-gates" title="Permanent link">&para;</a></h3>
<ul>
<li>Enables additional Pod-level readiness conditions</li>
<li>Useful for external dependencies like load balancers</li>
</ul>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">readinessGates</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">conditionType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;k8spatterns.io/load-balancer-ready&quot;</span>
<span class="nt">status</span><span class="p">:</span>
<span class="w">  </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;k8spatterns.io/load-balancer-ready&quot;</span>
<span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;False&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ready</span>
<span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;False&quot;</span>
</code></pre></div></p>
<h3 id="kube-chap-4-startup-probes">Startup Probes<a class="headerlink" href="#kube-chap-4-startup-probes" title="Permanent link">&para;</a></h3>
<ul>
<li>Designed for applications with long startup times</li>
<li>Uses same format as liveness probes with different timing parameters</li>
</ul>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-with-startup-check</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/wildfly/wildfly</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wildfly</span>
<span class="w">    </span><span class="nt">startupProbe</span><span class="p">:</span>
<span class="w">      </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;stat&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/opt/jboss/wildfly/standalone/tmp/startup-marker&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">      </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">    </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">      </span><span class="nt">httpGet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9990</span>
<span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">        </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</code></pre></div></p>
<h2 id="kube-chap-4-best-practices">Best Practices<a class="headerlink" href="#kube-chap-4-best-practices" title="Permanent link">&para;</a></h2>
<ul>
<li>Log significant events to stdout/stderr</li>
<li>Log termination reasons to /dev/termination-log</li>
<li>Integrate with tracing and metrics libraries (OpenTracing, Prometheus)</li>
</ul></section><section class="print-page" id="kube-chap-5"><h1 id="kube-chap-5-chapter-5-managed-lifecycle">Chapter 5: Managed Lifecycle<a class="headerlink" href="#kube-chap-5-chapter-5-managed-lifecycle" title="Permanent link">&para;</a></h1>
<p>The Managed Lifecycle pattern defines how containerized applications should react to platform lifecycle events.</p>
<h2 id="kube-chap-5-problem">Problem<a class="headerlink" href="#kube-chap-5-problem" title="Permanent link">&para;</a></h2>
<p>Applications need to respond to platform-issued commands for proper lifecycle management beyond basic process monitoring.</p>
<h2 id="kube-chap-5-solution">Solution<a class="headerlink" href="#kube-chap-5-solution" title="Permanent link">&para;</a></h2>
<h3 id="kube-chap-5-sigterm-signal">SIGTERM Signal<a class="headerlink" href="#kube-chap-5-sigterm-signal" title="Permanent link">&para;</a></h3>
<ul>
<li>Sent when Kubernetes initiates container shutdown</li>
<li>Allows for clean shutdown before SIGKILL</li>
<li>Triggered by Pod shutdown or failed liveness probe</li>
</ul>
<h3 id="kube-chap-5-sigkill-signal">SIGKILL Signal<a class="headerlink" href="#kube-chap-5-sigkill-signal" title="Permanent link">&para;</a></h3>
<ul>
<li>Forcefully terminates container if not shut down after SIGTERM</li>
<li>Sent 30 seconds after SIGTERM by default</li>
</ul>
<h3 id="kube-chap-5-poststart-hook">PostStart Hook<a class="headerlink" href="#kube-chap-5-poststart-hook" title="Permanent link">&para;</a></h3>
<p>Executes commands when container starts.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">post-start-hook</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">    </span><span class="nt">lifecycle</span><span class="p">:</span>
<span class="w">      </span><span class="nt">postStart</span><span class="p">:</span>
<span class="w">        </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sleep 30 &amp;&amp; echo &quot;Wake up!&quot; &gt; /tmp/postStart_done</span>
</code></pre></div></p>
<h3 id="kube-chap-5-prestop-hook">PreStop Hook<a class="headerlink" href="#kube-chap-5-prestop-hook" title="Permanent link">&para;</a></h3>
<p>Blocking call before container termination, similar to SIGTERM.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pre-stop-hook</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">    </span><span class="nt">lifecycle</span><span class="p">:</span>
<span class="w">      </span><span class="nt">preStop</span><span class="p">:</span>
<span class="w">        </span><span class="nt">httpGet</span><span class="p">:</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shutdown</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div></p>
<h3 id="kube-chap-5-lifecycle-controls-comparison">Lifecycle Controls Comparison<a class="headerlink" href="#kube-chap-5-lifecycle-controls-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Lifecycle hooks</th>
<th>Init containers</th>
</tr>
</thead>
<tbody>
<tr>
<td>Activates on</td>
<td>Container lifecycle phases</td>
<td>Pod lifecycle phases</td>
</tr>
<tr>
<td>Startup phase</td>
<td>postStart command</td>
<td>initContainers list</td>
</tr>
<tr>
<td>Shutdown phase</td>
<td>preStop command</td>
<td>None</td>
</tr>
<tr>
<td>Timing</td>
<td>Concurrent with ENTRYPOINT</td>
<td>Sequential before app containers</td>
</tr>
<tr>
<td>Use cases</td>
<td>Container-specific cleanup</td>
<td>Sequential Pod initialization</td>
</tr>
</tbody>
</table>
<h3 id="kube-chap-5-advanced-container-control">Advanced Container Control<a class="headerlink" href="#kube-chap-5-advanced-container-control" title="Permanent link">&para;</a></h3>
<p>Example of entrypoint rewriting for advanced lifecycle management:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wrapped-random-generator</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wrapper</span>
<span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">initContainers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">copy-supervisor</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/supervisor</span>
<span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/wrapper</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wrapper</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">cp</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">supervisor</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">/var/run/wrapper/supervisor</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/wrapper</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wrapper</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;/var/run/wrapper/supervisor&quot;</span>
<span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;random-generator-runner&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;--seed&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;42&quot;</span>
</code></pre></div>
<h2 id="kube-chap-5-best-practices">Best Practices<a class="headerlink" href="#kube-chap-5-best-practices" title="Permanent link">&para;</a></h2>
<ul>
<li>Implement graceful startup and shutdown handling</li>
<li>Honor platform lifecycle events for reliable operation</li>
<li>Application lifecycle is fully automated by the platform</li>
</ul></section><section class="print-page" id="kube-chap-6"><h1 id="kube-chap-6-chapter-6-automated-placement">Chapter 6: Automated Placement<a class="headerlink" href="#kube-chap-6-chapter-6-automated-placement" title="Permanent link">&para;</a></h1>
<p>Automated Placement is the core function of the Kubernetes scheduler for assigning new Pods to nodes that match container resource requests and honor scheduling policies. This pattern describes the principles of the Kubernetes scheduling algorithm and how to influence the placement decisions from the outside.</p>
<h2 id="kube-chap-6-problem">Problem<a class="headerlink" href="#kube-chap-6-problem" title="Permanent link">&para;</a></h2>
<p>A reasonably sized microservices-based system consists of tens or even hundreds of isolated processes. Containers and Pods do provide nice abstractions for packaging and deployment but do not solve the problem of placing these processes on suitable nodes. With a large and ever-growing number of microservices, assigning and placing them individually to nodes is not a manageable activity.</p>
<p>Containers have dependencies among themselves, dependencies to nodes, and resource demands, and all of that changes over time too. The resources available on a cluster also vary over time, through shrinking or extending the cluster or by having it consumed by already-placed containers. The way we place containers impacts the availability, performance, and capacity of the distributed systems as well. All of that makes scheduling containers to nodes a moving target.</p>
<h2 id="kube-chap-6-solution">Solution<a class="headerlink" href="#kube-chap-6-solution" title="Permanent link">&para;</a></h2>
<p>In Kubernetes, assigning Pods to nodes is done by the scheduler. It is a part of Kubernetes that is highly configurable, and it is still evolving and improving. The Kubernetes scheduler is a potent and time-saving tool. It plays a fundamental role in the Kubernetes platform as a whole, but similar to other Kubernetes components (API Server, Kubelet), it can be run in isolation or not used at all.</p>
<h3 id="kube-chap-6-available-node-resources">Available Node Resources<a class="headerlink" href="#kube-chap-6-available-node-resources" title="Permanent link">&para;</a></h3>
<p>First of all, the Kubernetes cluster needs to have nodes with enough resource capacity to run new Pods. Every node has capacity available for running Pods, and the scheduler ensures that the sum of the container resources requested for a Pod is less than the available allocatable node capacity.</p>
<p>Node capacity is calculated as:
<div class="highlight"><pre><span></span><code>Allocatable [capacity for application pods] =
    Node Capacity [available capacity on a node]
        - Kube-Reserved [Kubernetes daemons like kubelet, container runtime]
        - System-Reserved [Operating System daemons like sshd, udev]
        - Eviction Thresholds [Reserved memory to prevent system OOMs]
</code></pre></div></p>
<p>If you don't reserve resources for system daemons that power the OS and Kubernetes itself, the Pods can be scheduled up to the full capacity of the node, which may cause Pods and system daemons to compete for resources, leading to resource starvation issues on the node. Even then, memory pressure on the node can affect all Pods running on it through OOMKilled errors or cause the node to go temporarily offline.</p>
<p>Also keep in mind that if containers are running on a node that is not managed by Kubernetes, the resources used by these containers are not reflected in the node capacity calculations by Kubernetes. A workaround is to run a placeholder Pod that doesn't do anything but has only resource requests for CPU and memory corresponding to the untracked containers' resource use amount.</p>
<h3 id="kube-chap-6-container-resource-demands">Container Resource Demands<a class="headerlink" href="#kube-chap-6-container-resource-demands" title="Permanent link">&para;</a></h3>
<p>Another important requirement for an efficient Pod placement is to define the containers' runtime dependencies and resource demands. We covered that in more detail in Chapter 2, "Predictable Demands". It boils down to having containers that declare their resource profiles (with request and limit) and environment dependencies such as storage or ports.</p>
<h3 id="kube-chap-6-scheduler-configurations">Scheduler Configurations<a class="headerlink" href="#kube-chap-6-scheduler-configurations" title="Permanent link">&para;</a></h3>
<p>The scheduler has a default set of predicate and priority policies configured that is good enough for most use cases. In newer versions of Kubernetes, scheduling profiles are used to achieve customization. This approach exposes the different steps of the scheduling process as extension points and allows you to configure plugins that override the default implementations of the steps.</p>
<p>Example of a scheduler configuration:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubescheduler.config.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KubeSchedulerConfiguration</span>
<span class="nt">profiles</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">plugins</span><span class="p">:</span>
<span class="w">      </span><span class="nt">score</span><span class="p">:</span>
<span class="w">        </span><span class="nt">disabled</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodTopologySpread</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyCustomPlugin</span>
<span class="w">          </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</code></pre></div>
<p>By default, the scheduler uses the default-scheduler profile with default plugins. It is also possible to run multiple schedulers on the cluster, or multiple profiles on the scheduler, and allow Pods to specify which profile to use.</p>
<h3 id="kube-chap-6-node-selection">Node Selection<a class="headerlink" href="#kube-chap-6-node-selection" title="Permanent link">&para;</a></h3>
<p>In most cases, it is better to let the scheduler do the Pod-to-node assignment and not micromanage the placement logic. However, on some occasions, you may want to force the assignment of a Pod to a specific node or group of nodes.</p>
<p>Example of using nodeSelector:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">disktype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssd</span>
</code></pre></div>
<p>In addition to specifying custom labels to your nodes, you can use some of the default labels that are present on every node. Every node has a unique kubernetes.io/hostname label that can be used to place a Pod on a node by its hostname. Other default labels that indicate the OS, architecture, and instance type can be useful for placement too.</p></section><section class="print-page" id="kube-app"><h1 id="kube-app-configuring-an-application-in-kubernetes">Configuring an Application in Kubernetes<a class="headerlink" href="#kube-app-configuring-an-application-in-kubernetes" title="Permanent link">&para;</a></h1>
<h2 id="kube-app-1-define-the-application-components">1. Define the Application Components<a class="headerlink" href="#kube-app-1-define-the-application-components" title="Permanent link">&para;</a></h2>
<p>Determine what components your application requires:
- Containers (e.g., web server, database).
- Configuration (e.g., environment variables, command-line arguments).
- Networking (e.g., ports, service exposure).
- Storage (e.g., persistent data).</p>
<hr />
<h2 id="kube-app-2-create-the-required-kubernetes-resources">2. Create the Required Kubernetes Resources<a class="headerlink" href="#kube-app-2-create-the-required-kubernetes-resources" title="Permanent link">&para;</a></h2>
<p>You need to define the following resources based on your application:</p>
<h3 id="kube-app-a-pods">a. Pods<a class="headerlink" href="#kube-app-a-pods" title="Permanent link">&para;</a></h3>
<p>Pods are the smallest deployable unit in Kubernetes. Typically, you don't define pods directly but through higher-level resources like Deployments.</p>
<h3 id="kube-app-b-deployments">b. Deployments<a class="headerlink" href="#kube-app-b-deployments" title="Permanent link">&para;</a></h3>
<p>Manages the desired state of pods, ensuring availability and handling updates.</p>
<p>Example YAML:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-container</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-image:latest</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div></p>
<hr />
<h3 id="kube-app-c-services">c. Services<a class="headerlink" href="#kube-app-c-services" title="Permanent link">&para;</a></h3>
<p>Expose your application within the cluster or to the external world.</p>
<p>Example YAML:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-service</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</code></pre></div></p>
<hr />
<h3 id="kube-app-d-configmaps">d. ConfigMaps<a class="headerlink" href="#kube-app-d-configmaps" title="Permanent link">&para;</a></h3>
<p>Store configuration data (non-sensitive) in a key-value format.</p>
<p>Example YAML:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-config</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app.properties</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">key1=value1</span>
<span class="w">    </span><span class="no">key2=value2</span>
</code></pre></div></p>
<p>Mount or reference this in your pod:
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nt">envFrom</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">configMapRef</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-config</span>
</code></pre></div></p>
<hr />
<h3 id="kube-app-e-secrets">e. Secrets<a class="headerlink" href="#kube-app-e-secrets" title="Permanent link">&para;</a></h3>
<p>Store sensitive data like passwords or API keys securely.</p>
<p>Example YAML:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-secret</span>
<span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bXlVc2Vy</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bXlQYXNz</span>
</code></pre></div></p>
<p>Reference this in your pod:
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nt">env</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_USERNAME</span>
<span class="w">      </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">        </span><span class="nt">secretKeyRef</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-secret</span>
<span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_PASSWORD</span>
<span class="w">      </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">        </span><span class="nt">secretKeyRef</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-secret</span>
<span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</code></pre></div></p>
<hr />
<h3 id="kube-app-f-persistent-volumes-and-claims">f. Persistent Volumes and Claims<a class="headerlink" href="#kube-app-f-persistent-volumes-and-claims" title="Permanent link">&para;</a></h3>
<p>If your application needs to store data persistently.</p>
<p>Define a PersistentVolumeClaim (PVC):
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-pvc</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</code></pre></div></p>
<p>Mount it in your pod:
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/data&quot;</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-volume</span>
<span class="w"> </span><span class="w w-Error"> </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-volume</span>
<span class="w">    </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">      </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-pvc</span>
</code></pre></div></p>
<hr />
<h2 id="kube-app-3-apply-the-configuration">3. Apply the Configuration<a class="headerlink" href="#kube-app-3-apply-the-configuration" title="Permanent link">&para;</a></h2>
<p>Use <code>kubectl</code> to apply your configuration files to the cluster:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deployment.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>service.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>configmap.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>secret.yaml
</code></pre></div></p>
<hr />
<h2 id="kube-app-4-monitor-and-adjust">4. Monitor and Adjust<a class="headerlink" href="#kube-app-4-monitor-and-adjust" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <code>kubectl get pods</code> or <code>kubectl describe pod [pod-name]</code> to check the pod's status.</li>
<li>Adjust configurations or scaling as needed:
  <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>scale<span class="w"> </span>deployment<span class="w"> </span>my-app<span class="w"> </span>--replicas<span class="o">=</span><span class="m">5</span>
</code></pre></div></li>
</ul>
<hr />
<p>You now have a fully configured Kubernetes application!</p></section><h1 class='nav-section-title-end'>Ended: Kubernetes Core</h1>
                        <h1 class='nav-section-title' id='section-kubernetes-services'>
                            Kubernetes Services <a class='headerlink' href='#section-kubernetes-services' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="kube-daemon-service"><h1 id="kube-daemon-service-daemon-service">Daemon Service<a class="headerlink" href="#kube-daemon-service-daemon-service" title="Permanent link">&para;</a></h1>
<p>The Daemon Service pattern allows you to place and run prioritized, infrastructure-focused Pods on targeted nodes. It is used primarily by administrators to run node-specific Pods to enhance the Kubernetes platform capabilities.</p>
<h2 id="kube-daemon-service-problem">Problem<a class="headerlink" href="#kube-daemon-service-problem" title="Permanent link">&para;</a></h2>
<p>The concept of a daemon in software systems exists at many levels:</p>
<ul>
<li>At an operating system level, a daemon is a long-running, self-recovering computer program that runs as a background process</li>
<li>In Unix, daemon names end in d (httpd, named, sshd)</li>
<li>Other OS terms: services-started tasks, ghost jobs</li>
<li>JVM has daemon threads that provide supporting services to user threads</li>
</ul>
<p>Similarly, Kubernetes also has the concept of a DaemonSet. Considering that Kubernetes is a distributed platform spread across multiple nodes and with the primary goal of managing application Pods, a DaemonSet is represented by Pods that run on the cluster nodes and provide some background capabilities for the rest of the cluster.</p>
<h2 id="kube-daemon-service-solution">Solution<a class="headerlink" href="#kube-daemon-service-solution" title="Permanent link">&para;</a></h2>
<p>ReplicaSet and its predecessor ReplicationController are control structures responsible for making sure a specific number of Pods are running. These controllers constantly monitor the list of running Pods and make sure the actual number of Pods always matches the desired number. In that regard, a DaemonSet is a similar construct and is responsible for ensuring that a certain number of Pods are always running.</p>
<p>The difference is that the first two run a specific number of Pods, usually driven by the application requirements of high availability and user load, irrespective of the node count. On the other hand, a DaemonSet is not driven by consumer load in deciding how many Pod instances to run and where to run. Its main purpose is to keep running a single Pod on every node or specific nodes.</p>
<h3 id="kube-daemon-service-example-daemonset-resource">Example DaemonSet Resource<a class="headerlink" href="#kube-daemon-service-example-daemonset-resource" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-refresher</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-refresher</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-refresher</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">            </span><span class="c1"># Use only nodes with the label feature set to value hw-rng</span>
<span class="w">        </span><span class="nt">feature</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hw-rng</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;java&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;RandomRunner&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/numbers.txt&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;10000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;30&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">          </span><span class="c1"># DaemonSets often mount a portion of a node&#39;s filesystem</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/host_dev</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">devices</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">devices</span>
<span class="w">        </span><span class="nt">hostPath</span><span class="p">:</span><span class="w">              </span><span class="c1"># hostPath for accessing the node directories directly</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev</span>
</code></pre></div>
<p>Given this behavior, the primary candidates for a DaemonSet are usually infrastructure-related processes, such as:
- Cluster storage providers
- Log collectors
- Metric exporters
- kube-proxy</p>
<h3 id="kube-daemon-service-key-differences-from-replicaset">Key Differences from ReplicaSet<a class="headerlink" href="#kube-daemon-service-key-differences-from-replicaset" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Pod Placement</strong></li>
<li>By default, a DaemonSet places one Pod instance on every node</li>
<li>
<p>Can be controlled/limited to subset of nodes using nodeSelector or affinity fields</p>
</li>
<li>
<p><strong>Scheduling</strong></p>
</li>
<li>A Pod created by DaemonSet already has nodeName specified</li>
<li>Doesn't require Kubernetes scheduler to run containers</li>
<li>Can run before scheduler has started</li>
<li>
<p>Unschedulable field of a node is not respected by DaemonSet controller</p>
</li>
<li>
<p><strong>Pod Configuration</strong></p>
</li>
<li>RestartPolicy can only be Always or left unspecified (defaults to Always)</li>
<li>
<p>This ensures container restart when liveness probe fails</p>
</li>
<li>
<p><strong>Priority</strong></p>
</li>
<li>Pods managed by DaemonSet are treated with higher priority</li>
<li>Descheduler will avoid evicting such Pods</li>
<li>Cluster autoscaler manages them separately</li>
</ol>
<h3 id="kube-daemon-service-accessing-daemonset-pods">Accessing DaemonSet Pods<a class="headerlink" href="#kube-daemon-service-accessing-daemonset-pods" title="Permanent link">&para;</a></h3>
<p>There are several ways to reach Pods managed by DaemonSets:</p>
<ol>
<li><strong>Service</strong></li>
<li>Create a Service with same Pod selector as DaemonSet</li>
<li>
<p>Use Service to reach daemon Pod load-balanced to random node</p>
</li>
<li>
<p><strong>DNS</strong></p>
</li>
<li>Create headless Service with same Pod selector</li>
<li>
<p>Retrieve multiple A records from DNS containing all Pod IPs and ports</p>
</li>
<li>
<p><strong>Node IP with hostPort</strong></p>
</li>
<li>Pods can specify hostPort to be reachable via node IP addresses</li>
<li>
<p>Combination of node IP, hostPort and protocol must be unique</p>
</li>
<li>
<p><strong>External Push</strong></p>
</li>
<li>Application in DaemonSet Pods can push data to external location/service</li>
<li>No consumer needs to reach DaemonSet Pods directly</li>
</ol>
<h3 id="kube-daemon-service-static-pods">Static Pods<a class="headerlink" href="#kube-daemon-service-static-pods" title="Permanent link">&para;</a></h3>
<p>Another way to run containers similar to DaemonSet is through static Pods:</p>
<ul>
<li>Kubelet can get resource definitions from local directory</li>
<li>Managed by Kubelet only and run on one node only</li>
<li>API service doesn't observe these Pods</li>
<li>No controller or health checks performed</li>
<li>Kubelet watches and restarts them when they crash</li>
<li>Kubelet scans configured directory for Pod definition changes</li>
</ul>
<p>While static Pods can be used to run containerized Kubernetes system processes, DaemonSets are better integrated with the platform and are recommended over static Pods.</p>
<h2 id="kube-daemon-service-discussion">Discussion<a class="headerlink" href="#kube-daemon-service-discussion" title="Permanent link">&para;</a></h2>
<p>There are other ways to run daemon processes on every node, but they all have limitations:</p>
<ul>
<li><strong>Static Pods</strong>: Managed by Kubelet but can't be managed through Kubernetes APIs</li>
<li><strong>Bare Pods</strong>: Can't survive accidental deletion/termination or node failure</li>
<li><strong>Init Scripts</strong>: Require different toolchains for monitoring and management</li>
</ul>
<p>DaemonSet is somewhere between developer and administrator toolbox, inclining more toward the administrator side. However, it's relevant to application developers as it demonstrates how Kubernetes turns single-node concepts into multinode clustered primitives for managing distributed systems.</p>
<h2 id="kube-daemon-service-more-information">More Information<a class="headerlink" href="#kube-daemon-service-more-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/k8spatterns/examples/tree/main/behavioural/DaemonService">Daemon Service Example</a></li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/">DaemonSet Documentation</a></li>
<li><a href="https://kubernetes.io/docs/tasks/manage-daemon/update-daemon-set/">Perform a Rolling Update on a DaemonSet</a></li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/">DaemonSets and Jobs</a></li>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/">Create Static Pods</a></li>
</ul></section><section class="print-page" id="kube-batch-job"><h1 id="kube-batch-job-batch-job">Batch Job<a class="headerlink" href="#kube-batch-job-batch-job" title="Permanent link">&para;</a></h1>
<p>The Batch Job pattern is suited for managing isolated atomic units of work. It is based on the Job resource, which runs short-lived Pods reliably until completion on a distributed environment.</p>
<h2 id="kube-batch-job-problem">Problem<a class="headerlink" href="#kube-batch-job-problem" title="Permanent link">&para;</a></h2>
<p>The main primitive in Kubernetes for managing and running containers is the Pod. There are different ways of creating Pods with varying characteristics:</p>
<p><strong>Bare Pod</strong><br />
It is possible to create a Pod manually to run containers. However, when the node such a Pod is running on fails, the Pod is not restarted. Running Pods this way is discouraged except for development or testing purposes. This mechanism is also known as unmanaged or naked Pods.</p>
<p><strong>ReplicaSet</strong><br />
This controller is used for creating and managing the lifecycle of Pods expected to run continuously (e.g., to run a web server container). It maintains a stable set of replica Pods running at any given time and guarantees the availability of a specified number of identical Pods. ReplicaSets are described in detail in Chapter 11, "Stateless Service".</p>
<p><strong>DaemonSet</strong><br />
This controller runs a single Pod on every node and is used for managing platform capabilities such as monitoring, log aggregation, storage containers, and others. See Chapter 9, "Daemon Service", for a more detailed discussion.</p>
<p>A common aspect of these Pods is that they represent long-running processes that are not meant to stop after a certain time. However, in some cases there is a need to perform a predefined finite unit of work reliably and then shut down the container. For this task, Kubernetes provides the Job resource.</p>
<h2 id="kube-batch-job-solution">Solution<a class="headerlink" href="#kube-batch-job-solution" title="Permanent link">&para;</a></h2>
<p>A Kubernetes Job is similar to a ReplicaSet as it creates one or more Pods and ensures they run successfully. However, the difference is that, once the expected number of Pods terminate successfully, the Job is considered complete, and no additional Pods are started.</p>
<h3 id="kube-batch-job-example-job-specification">Example Job Specification<a class="headerlink" href="#kube-batch-job-example-job-specification" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Job</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">completions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w">                 </span><span class="c1"># Job should run five Pods to completion, which all must succeed</span>
<span class="w">  </span><span class="nt">parallelism</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">                 </span><span class="c1"># Two Pods can run in parallel</span>
<span class="w">  </span><span class="nt">ttlSecondsAfterFinished</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w">   </span><span class="c1"># Keep Pods for five minutes (300 seconds) before garbage-collecting them</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span><span class="w">   </span><span class="c1"># Specifying the restartPolicy is mandatory for a Job</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;java&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;RandomRunner&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/numbers.txt&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;10000&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>One crucial difference between the Job and the ReplicaSet definition is the <code>.spec.template.spec.restartPolicy</code>. The default value for a ReplicaSet is Always, which makes sense for long-running processes that must always be kept running. The value Always is not allowed for a Job, and the only possible options are OnFailure or Never.</p>
<h3 id="kube-batch-job-benefits-of-using-jobs-over-bare-pods">Benefits of Using Jobs Over Bare Pods<a class="headerlink" href="#kube-batch-job-benefits-of-using-jobs-over-bare-pods" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>A Job is not an ephemeral in-memory task but a persisted one that survives cluster restarts.</p>
</li>
<li>
<p>When a Job is completed, it is not deleted but is kept for tracking purposes. The Pods that are created as part of the Job are also not deleted but are available for examination (e.g., to check the container logs).</p>
</li>
<li>
<p>A Job may need to be performed multiple times. Using the <code>.spec.completions</code> field, it is possible to specify how many times a Pod should complete successfully before the Job itself is done.</p>
</li>
<li>
<p>When a Job has to be completed multiple times, it can also be scaled and executed by starting multiple Pods at the same time using the <code>.spec.parallelism</code> field.</p>
</li>
<li>
<p>A Job can be suspended by setting the field <code>.spec.suspend</code> to true. In this case, all active Pods are deleted and restarted if the Job is resumed.</p>
</li>
<li>
<p>If the node fails or when the Pod is evicted for some reason while still running, the scheduler places the Pod on a new healthy node and reruns it.</p>
</li>
</ol>
<h3 id="kube-batch-job-types-of-jobs">Types of Jobs<a class="headerlink" href="#kube-batch-job-types-of-jobs" title="Permanent link">&para;</a></h3>
<p>Based on the completions and parallelism parameters, there are the following types of Jobs:</p>
<p><strong>Single Pod Jobs</strong><br />
- Leave out both <code>.spec.completions</code> and <code>.spec.parallelism</code> or set them to their default values of 1
- Starts only one Pod and is completed when the single Pod terminates successfully</p>
<p><strong>Fixed Completion Count Jobs</strong><br />
- Set <code>.spec.completions</code> to the number of completions needed
- Can set <code>.spec.parallelism</code> or leave it unset (defaults to 1)
- Completed after the <code>.spec.completions</code> number of Pods has completed successfully</p>
<p><strong>Work Queue Jobs</strong><br />
- Leave <code>.spec.completions</code> unset
- Set <code>.spec.parallelism</code> to a number greater than one
- Completed when at least one Pod has terminated successfully and all other Pods have terminated
- Requires Pods to coordinate among themselves</p>
<p><strong>Indexed Jobs</strong><br />
- Similar to Work queue Jobs but without needing an external work queue
- Uses fixed completion count and <code>.spec.completionMode</code> set to Indexed
- Each Pod gets an index from 0 to <code>.spec.completions - 1</code>
- Index available through annotation or JOB_COMPLETION_INDEX environment variable</p>
<h3 id="kube-batch-job-example-indexed-job">Example Indexed Job<a class="headerlink" href="#kube-batch-job-example-indexed-job" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Job</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file-split</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">completionMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Indexed</span><span class="w">     </span><span class="c1"># Enable indexed completion mode</span>
<span class="w">  </span><span class="nt">completions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w">              </span><span class="c1"># Run five Pods in parallel to completion</span>
<span class="w">  </span><span class="nt">parallelism</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file-split</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">split</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w">              </span><span class="c1"># Execute shell script to process file ranges</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;sh&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">start=$(expr $JOB_COMPLETION_INDEX \* 10000)      </span>
<span class="w">          </span><span class="no">end=$(expr $JOB_COMPLETION_INDEX \* 10000 + 10000)</span>
<span class="w">          </span><span class="no">awk &quot;NR&gt;=$start &amp;&amp; NR&lt;$end&quot; /logs/random.log \    </span>
<span class="w">              </span><span class="no">&gt; /logs/random-$JOB_COMPLETION_INDEX.txt</span>
<span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">         </span><span class="c1"># Mount input data from external volume</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/logs</span><span class="w">    </span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log-volume</span>
<span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
</code></pre></div>
<h2 id="kube-batch-job-discussion">Discussion<a class="headerlink" href="#kube-batch-job-discussion" title="Permanent link">&para;</a></h2>
<p>The Job abstraction is a basic but fundamental primitive that other primitives such as CronJobs are based on. Jobs help turn isolated work units into a reliable and scalable unit of execution. However, a Job doesn't dictate how you should map individually processable work items into Jobs or Pods. That is something you have to determine after considering the pros and cons of each option:</p>
<p><strong>One Job per work item</strong><br />
- Has overhead of creating Kubernetes Jobs
- Platform has to manage large number of Jobs consuming resources
- Useful when each work item is a complex task that needs independent tracking</p>
<p><strong>One Job for all work items</strong><br />
- Right for large number of work items that don't need independent tracking
- Work items managed from within application via batch framework</p>
<p>The Job primitive provides only the minimum basics for scheduling work items. Any complex implementation has to combine the Job primitive with a batch application framework (e.g., Spring Batch, JBeret) to achieve the desired outcome.</p>
<p>Not all services must run all the time. Using Jobs can run Pods only when needed and only for the duration of the task execution. Jobs are scheduled on nodes that have the required capacity, satisfy Pod placement policies, and take into account other container dependency considerations. Using Jobs for short-lived tasks rather than long-running abstractions saves resources for other workloads on the platform.</p>
<h2 id="kube-batch-job-more-information">More Information<a class="headerlink" href="#kube-batch-job-more-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/k8spatterns/examples/tree/main/behavioural/BatchJob">Batch Job Example</a></li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Jobs Documentation</a></li>
<li><a href="https://kubernetes.io/docs/tasks/job/parallel-processing-expansion/">Parallel Processing Using Expansions</a></li>
<li><a href="https://kubernetes.io/docs/tasks/job/coarse-parallel-processing-work-queue/">Coarse Parallel Processing Using a Work Queue</a></li>
<li><a href="https://kubernetes.io/docs/tasks/job/fine-parallel-processing-work-queue/">Fine Parallel Processing Using a Work Queue</a></li>
<li><a href="https://kubernetes.io/docs/tasks/job/indexed-parallel-processing-static/">Indexed Job for Parallel Processing</a></li>
<li><a href="https://spring.io/blog/2018/12/10/spring-batch-on-kubernetes">Spring Batch on Kubernetes</a></li>
<li><a href="https://jberet.gitbooks.io/jberet-user-guide/content/">JBeret Introduction</a></li>
</ul></section><section class="print-page" id="kube-periodic-job"><h1 id="kube-periodic-job-periodic-job">Periodic Job<a class="headerlink" href="#kube-periodic-job-periodic-job" title="Permanent link">&para;</a></h1>
<p>The Periodic Job pattern extends the Batch Job pattern by adding a time dimension and allowing the execution of a unit of work to be triggered by a temporal event.</p>
<h2 id="kube-periodic-job-problem">Problem<a class="headerlink" href="#kube-periodic-job-problem" title="Permanent link">&para;</a></h2>
<p>In the world of distributed systems and microservices, there is a clear tendency toward real-time and event-driven application interactions using HTTP and lightweight messaging. However, regardless of the latest trends in software development, job scheduling has a long history, and it is still relevant. Periodic jobs are commonly used for automating system maintenance or administrative tasks. They are also relevant to business applications requiring specific tasks to be performed periodically. Typical examples here are business-to-business integration through file transfer, application integration through database polling, sending newsletter emails, and cleaning up and archiving old files.</p>
<p>The traditional way of handling periodic jobs for system maintenance purposes has been to use specialized scheduling software or cron. However, specialized software can be expensive for simple use cases, and cron jobs running on a single server are difficult to maintain and represent a single point of failure. That is why, very often, developers tend to implement solutions that can handle both the scheduling aspect and the business logic that needs to be performed.</p>
<p>For example, in the Java world, libraries such as Quartz, Spring Batch, and custom implementations with the ScheduledThreadPoolExecutor class can run temporal tasks. But similar to cron, the main difficulty with this approach is making the scheduling capability resilient and highly available, which leads to high resource consumption. Also, with this approach, the time-based job scheduler is part of the application, and to make the scheduler highly available, the whole application must be highly available. Typically, that involves running multiple instances of the application and at the same time ensuring that only a single instance is active and schedules jobs—which involves leader election and other distributed systems challenges.</p>
<p>In the end, a simple service that has to copy a few files once a day may end up requiring multiple nodes, a distributed leader election mechanism, and more. Kubernetes CronJob implementation solves all that by allowing scheduling of Job resources using the well-known cron format and letting developers focus only on implementing the work to be performed rather than the temporal scheduling aspect.</p>
<h2 id="kube-periodic-job-solution">Solution<a class="headerlink" href="#kube-periodic-job-solution" title="Permanent link">&para;</a></h2>
<p>A CronJob instance is similar to one line of a Unix crontab (cron table) and manages the temporal aspects of a Job. It allows the execution of a Job periodically at a specified point in time.</p>
<h3 id="kube-periodic-job-example-cronjob-resource">Example CronJob Resource<a class="headerlink" href="#kube-periodic-job-example-cronjob-resource" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CronJob</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*/3</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span><span class="w">  </span><span class="c1"># Cron specification for running every three minutes</span>
<span class="w">  </span><span class="nt">jobTemplate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span><span class="w">            </span><span class="c1"># Job template that uses the same specification as a regular Job</span>
<span class="w">        </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">          </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8spatterns/random-generator:1.0</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random-generator</span>
<span class="w">            </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;java&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;RandomRunner&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/numbers.txt&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;10000&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
</code></pre></div>
<h3 id="kube-periodic-job-additional-cronjob-fields">Additional CronJob Fields<a class="headerlink" href="#kube-periodic-job-additional-cronjob-fields" title="Permanent link">&para;</a></h3>
<ol>
<li><code>.spec.schedule</code></li>
<li>Crontab entry for specifying the Job's schedule</li>
<li>
<p>Can use shortcuts like @daily or @hourly</p>
</li>
<li>
<p><code>.spec.startingDeadlineSeconds</code></p>
</li>
<li>Deadline (in seconds) for starting the Job if it misses scheduled time</li>
<li>Don't use fewer than 10 seconds</li>
<li>
<p>Useful when task is only valid within certain timeframe</p>
</li>
<li>
<p><code>.spec.concurrencyPolicy</code></p>
</li>
<li>Manages concurrent executions of Jobs from same CronJob</li>
<li>
<p>Options:</p>
<ul>
<li>Allow (default): Creates new Jobs even if previous not completed</li>
<li>Forbid: Skip next run if current one not completed</li>
<li>Replace: Cancel current Job and start new one</li>
</ul>
</li>
<li>
<p><code>.spec.suspend</code></p>
</li>
<li>Suspends subsequent executions without affecting started executions</li>
<li>
<p>Different from Job's .spec.suspend</p>
</li>
<li>
<p><code>.spec.successfulJobsHistoryLimit</code> and <code>.spec.failedJobsHistoryLimit</code></p>
</li>
<li>Specify how many completed/failed Jobs to keep for auditing</li>
</ol>
<h2 id="kube-periodic-job-discussion">Discussion<a class="headerlink" href="#kube-periodic-job-discussion" title="Permanent link">&para;</a></h2>
<p>A CronJob is a simple primitive that adds clustered, cron-like behavior to the existing Job definition. When combined with other primitives such as Pods, container resource isolation, and features like Automated Placement or Health Probe, it becomes a powerful job-scheduling system.</p>
<p>This enables developers to focus solely on the problem domain and implement a containerized application responsible only for the business logic. The scheduling is performed outside the application, as part of the platform with benefits like:
- High availability
- Resiliency
- Capacity management
- Policy-driven Pod placement</p>
<p>Similar to Job implementation, when implementing a CronJob container, your application must consider all corner and failure cases:
- Duplicate runs
- No runs
- Parallel runs
- Cancellations</p>
<h2 id="kube-periodic-job-more-information">More Information<a class="headerlink" href="#kube-periodic-job-more-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/k8spatterns/examples/tree/main/behavioural/PeriodicJob">Periodic Job Example</a></li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/">CronJob Documentation</a></li>
<li><a href="https://en.wikipedia.org/wiki/Cron">Cron</a></li>
<li><a href="https://en.wikipedia.org/wiki/Cron#CRON_expression">Crontab Specification</a></li>
<li><a href="https://www.freeformatter.com/cron-expression-generator-quartz.html">Cron Expression Generator</a></li>
</ul></section><section class="print-page" id="kube-ingress"><h1 id="kube-ingress-kubernetes-ingress">Kubernetes Ingress<a class="headerlink" href="#kube-ingress-kubernetes-ingress" title="Permanent link">&para;</a></h1>
<p>An Ingress is a Kubernetes resource that manages external access to services in a cluster. It provides HTTP/HTTPS routing, SSL termination, and name-based virtual hosting.</p>
<h2 id="kube-ingress-complete-example">Complete Example<a class="headerlink" href="#kube-ingress-complete-example" title="Permanent link">&para;</a></h2>
<p>Here's a complete example showing the full stack of Pod, ConfigMap, Service, and Ingress:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># First file: pod-and-configmap.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-pod</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">endpoint-test</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-server</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">html-volume</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">html-volume</span>
<span class="w">      </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-html</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-html</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">index.html</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">&lt;html&gt;</span>
<span class="w">    </span><span class="no">&lt;head&gt;&lt;title&gt;Test Page&lt;/title&gt;&lt;/head&gt;</span>
<span class="w">    </span><span class="no">&lt;body&gt;&lt;h1&gt;Hello, Kubernetes!&lt;/h1&gt;&lt;/body&gt;</span>
<span class="w">    </span><span class="no">&lt;/html&gt;</span>
<span class="nn">---</span>
<span class="c1"># Second file: service.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-pod-service</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">endpoint-test</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="nn">---</span>
<span class="c1"># Ingress with path</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-ingress</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/rewrite-target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fuck</span>
<span class="w">    </span><span class="nt">http</span><span class="p">:</span>
<span class="w">      </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/test</span>
<span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">          </span><span class="nt">service</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-pod-service</span>
<span class="w">            </span><span class="nt">port</span><span class="p">:</span>
<span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
<h2 id="kube-ingress-how-ingress-endpoints-and-pods-interlink">How Ingress, Endpoints, and Pods Interlink<a class="headerlink" href="#kube-ingress-how-ingress-endpoints-and-pods-interlink" title="Permanent link">&para;</a></h2>
<p>```plantuml
@startuml
!theme plain
skinparam componentStyle rectangle</p>
<p>rectangle "External Traffic" as client</p>
<p>package "Kubernetes Cluster" {
  component "Ingress\n(Load Balancer)" as ingress
  component "Service" as svc
  collections "Endpoints" as ep</p>
<p>rectangle "Pod 1" as pod1
  rectangle "Pod 2" as pod2
  rectangle "Pod 3" as pod3
}</p>
<p>client &rarr; ingress : "HTTP/HTTPS"
ingress &rarr; svc : "Routes to Service"
svc &rarr; ep : "Selects"
ep &rarr; pod1
ep &rarr; pod2
ep &rarr; pod3</p>
<p>note right of ingress
  Handles:
  - SSL Termination
  - URL Routing
  - Load Balancing
end note</p>
<p>note right of svc
  Service selects pods
  using labels
end note</p>
<p>note right of ep
  Endpoints track
  pod IP addresses
end note
@enduml
```</p>
<h3 id="kube-ingress-understanding-the-connection-flow">Understanding the Connection Flow<a class="headerlink" href="#kube-ingress-understanding-the-connection-flow" title="Permanent link">&para;</a></h3>
<p>Let's analyze how each component in our YAML example works together:</p>
<ol>
<li><strong>Pod Configuration</strong> (First YAML section):
   <div class="highlight"><pre><span></span><code><span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-pod</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">endpoint-test</span><span class="w">   </span><span class="c1"># This label is key for Service selection</span>
</code></pre></div></li>
<li>Defines a Pod running nginx with a custom HTML page</li>
<li>Uses the label <code>app: endpoint-test</code> which is crucial for Service discovery</li>
<li>
<p>Mounts a volume from ConfigMap to serve custom content</p>
</li>
<li>
<p><strong>ConfigMap Integration</strong> (Second YAML section):
   <div class="highlight"><pre><span></span><code><span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">html-volume</span>
<span class="w">    </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-html</span><span class="w">   </span><span class="c1"># Links to the ConfigMap</span>
</code></pre></div></p>
</li>
<li>Provides the HTML content that the Pod will serve</li>
<li>Connected to the Pod through volume mounting</li>
<li>
<p>Demonstrates configuration separation from the Pod</p>
</li>
<li>
<p><strong>Service Layer</strong> (Third YAML section):
   <div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">endpoint-test</span><span class="w">   </span><span class="c1"># Matches Pod&#39;s label</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w">          </span><span class="c1"># Service port</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w">    </span><span class="c1"># Pod port</span>
</code></pre></div></p>
</li>
<li>Creates a stable network endpoint for the Pod</li>
<li>Uses label selector <code>app: endpoint-test</code> to find our Pod</li>
<li>
<p>Maps port 80 on the service to port 80 on the Pod</p>
</li>
<li>
<p><strong>Ingress Configuration</strong> (Fourth YAML section):
   <div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.local</span>
<span class="w">    </span><span class="nt">http</span><span class="p">:</span>
<span class="w">      </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/test</span><span class="w">    </span><span class="c1"># URL path</span>
<span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">          </span><span class="nt">service</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-pod-service</span><span class="w">   </span><span class="c1"># References Service name</span>
</code></pre></div></p>
</li>
<li>Defines external access rules</li>
<li>Routes <code>/test</code> path to our Service</li>
<li>References the Service by name: <code>test-pod-service</code></li>
</ol>
<h3 id="kube-ingress-key-relationships-in-the-stack">Key Relationships in the Stack<a class="headerlink" href="#kube-ingress-key-relationships-in-the-stack" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Pod → Service Connection</strong>:</li>
<li>Pod's label <code>app: endpoint-test</code> matches Service's selector</li>
<li>Service automatically discovers Pod through this label matching</li>
<li>
<p>If Pod is recreated with same labels, Service automatically finds it</p>
</li>
<li>
<p><strong>Service → Ingress Connection</strong>:</p>
</li>
<li>Ingress backend references Service by name: <code>test-pod-service</code></li>
<li>Traffic flow: Ingress → Service → Pod</li>
<li>
<p>Service provides stable internal endpoint regardless of Pod changes</p>
</li>
<li>
<p><strong>ConfigMap → Pod Connection</strong>:</p>
</li>
<li>Pod mounts ConfigMap as volume</li>
<li>Changes to ConfigMap can update Pod's content without rebuild</li>
<li>Separates configuration from application container</li>
</ol>
<p>This interconnected system provides:
- Dynamic service discovery through labels
- Load balancing across multiple Pods (if scaled)
- External access control through Ingress rules
- Configuration management through ConfigMaps</p></section><h1 class='nav-section-title-end'>Ended: Kubernetes Services</h1>
                        <h1 class='nav-section-title' id='section-infrastructure'>
                            Infrastructure <a class='headerlink' href='#section-infrastructure' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="kube-kind"><h1 id="kube-kind-local-kubernetes-development-with-kind">Local Kubernetes Development with Kind<a class="headerlink" href="#kube-kind-local-kubernetes-development-with-kind" title="Permanent link">&para;</a></h1>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td>OpenSuse Hauptseite</td>
<td><a href="https://de.opensuse.org/Hauptseite">opensuse.org</a></td>
</tr>
<tr>
<td>SUSE Container Guide</td>
<td><a href="https://documentation.suse.com/container/all/html/Container-guide/index.html">documentation.suse.com/container</a></td>
</tr>
<tr>
<td>SUSE Container Registry</td>
<td><a href="https://registry.suse.com/repositories?categories%5B%5D=apps">registry.suse.com</a></td>
</tr>
<tr>
<td>openSUSE Leap 15.6</td>
<td><a href="https://build.opensuse.org/project/show/openSUSE:Leap:15.6">build.opensuse.org</a></td>
</tr>
</tbody>
</table>
<p>This guide walks through setting up a complete local Kubernetes development environment using Kind (Kubernetes in Docker), along with essential tools and monitoring.</p>
<h2 id="kube-kind-prerequisites">Prerequisites<a class="headerlink" href="#kube-kind-prerequisites" title="Permanent link">&para;</a></h2>
<p>This guide is specifically for openSUSE Linux distributions. Ensure you have:
- openSUSE Leap 15.6 or newer
- Root/sudo access
- Terminal access
- At least 8GB RAM and 4 CPU cores recommended</p>
<h2 id="kube-kind-installing-podman">Installing Podman<a class="headerlink" href="#kube-kind-installing-podman" title="Permanent link">&para;</a></h2>
<p>Podman is the officially supported container engine in SUSE/openSUSE:</p>
<ol>
<li>
<p>Install Podman and required tools:
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>podman<span class="w"> </span>podman-docker<span class="w"> </span>cni-plugins
</code></pre></div></p>
</li>
<li>
<p>Enable and start Podman socket (for Docker API compatibility):
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>podman.socket
</code></pre></div></p>
</li>
<li>
<p>Configure Podman for rootless mode:
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>touch<span class="w"> </span>/etc/subuid<span class="w"> </span>/etc/subgid
sudo<span class="w"> </span>usermod<span class="w"> </span>--add-subuids<span class="w"> </span><span class="m">100000</span>-165535<span class="w"> </span>--add-subgids<span class="w"> </span><span class="m">100000</span>-165535<span class="w"> </span><span class="nv">$USER</span>
</code></pre></div></p>
</li>
<li>
<p>Set up Docker compatibility:
<div class="highlight"><pre><span></span><code><span class="c1"># Create Docker compatibility symlink</span>
sudo<span class="w"> </span>ln<span class="w"> </span>-sf<span class="w"> </span>/run/podman/podman.sock<span class="w"> </span>/var/run/docker.sock

<span class="c1"># Add current user to podman group</span>
sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>podman<span class="w"> </span><span class="nv">$USER</span>
</code></pre></div></p>
</li>
<li>
<p>Log out and back in for group changes to take effect, then verify:
<div class="highlight"><pre><span></span><code>podman<span class="w"> </span>--version
podman<span class="w"> </span>ps
</code></pre></div></p>
</li>
</ol>
<p>Note: The <code>docker</code> command will also work due to the podman-docker compatibility package.</p>
<h2 id="kube-kind-installing-kind">Installing Kind<a class="headerlink" href="#kube-kind-installing-kind" title="Permanent link">&para;</a></h2>
<p>Kind (Kubernetes in Docker) allows running local Kubernetes clusters using Docker containers as nodes.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Download Kind binary</span>
curl<span class="w"> </span>-Lo<span class="w"> </span>./kind<span class="w"> </span>https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
chmod<span class="w"> </span>+x<span class="w"> </span>./kind
sudo<span class="w"> </span>mv<span class="w"> </span>./kind<span class="w"> </span>/usr/local/bin/kind

<span class="c1"># Verify installation</span>
kind<span class="w"> </span>--version
</code></pre></div>
<h2 id="kube-kind-installing-kubectl">Installing kubectl<a class="headerlink" href="#kube-kind-installing-kubectl" title="Permanent link">&para;</a></h2>
<p>Install kubectl using the official Kubernetes repository:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Add Kubernetes repository</span>
sudo<span class="w"> </span>zypper<span class="w"> </span>addrepo<span class="w"> </span>--refresh<span class="w"> </span>https://download.opensuse.org/repositories/containers:/kubetools/15.5/containers:kubetools.repo

<span class="c1"># Install kubectl</span>
sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>kubernetes-client

<span class="c1"># Verify installation</span>
kubectl<span class="w"> </span>version<span class="w"> </span>--client
</code></pre></div>
<h2 id="kube-kind-installing-helm">Installing Helm<a class="headerlink" href="#kube-kind-installing-helm" title="Permanent link">&para;</a></h2>
<p>Install Helm using the openSUSE package manager:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Add Helm repository</span>
sudo<span class="w"> </span>zypper<span class="w"> </span>addrepo<span class="w"> </span>https://download.opensuse.org/repositories/home:tlusk:kubectl/15.6/home:tlusk:kubectl.repo

<span class="c1"># Install Helm</span>
sudo<span class="w"> </span>zypper<span class="w"> </span>refresh
sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>helm

<span class="c1"># Verify installation</span>
helm<span class="w"> </span>version
</code></pre></div>
<h2 id="kube-kind-creating-a-kind-cluster">Creating a Kind Cluster<a class="headerlink" href="#kube-kind-creating-a-kind-cluster" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Create a cluster configuration file <code>kind-config.yaml</code>:
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kind.x-k8s.io/v1alpha4</span>
<span class="nt">nodes</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">control-plane</span>
<span class="w">  </span><span class="nt">extraPortMappings</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker</span>
</code></pre></div></p>
</li>
<li>
<p>Create the cluster:
<div class="highlight"><pre><span></span><code>kind<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span>--name<span class="w"> </span>monitoring<span class="w"> </span>--config<span class="w"> </span>kind-config.yaml
</code></pre></div></p>
</li>
<li>
<p>Verify cluster is running:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>cluster-info
</code></pre></div></p>
</li>
</ol>
<h2 id="kube-kind-installing-monitoring-stack">Installing Monitoring Stack<a class="headerlink" href="#kube-kind-installing-monitoring-stack" title="Permanent link">&para;</a></h2>
<p>We'll set up a complete monitoring solution with Prometheus, Grafana, and Loki using Helm charts.</p>
<ol>
<li>
<p>Create monitoring namespace:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>monitoring
</code></pre></div></p>
</li>
<li>
<p>Add required Helm repositories:
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>prometheus-community<span class="w"> </span>https://prometheus-community.github.io/helm-charts
helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>grafana<span class="w"> </span>https://grafana.github.io/helm-charts
helm<span class="w"> </span>repo<span class="w"> </span>update
</code></pre></div></p>
</li>
<li>
<p>Install Prometheus stack:
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>install<span class="w"> </span>prometheus<span class="w"> </span>prometheus-community/kube-prometheus-stack<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>monitoring<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>grafana.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>prometheus.service.type<span class="o">=</span>ClusterIP<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--values<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">grafana:</span>
<span class="s">  service:</span>
<span class="s">    type: ClusterIP</span>
<span class="s">  adminPassword: admin123</span>
<span class="s">prometheus:</span>
<span class="s">  prometheusSpec:</span>
<span class="s">    retention: 7d</span>
<span class="s">EOF</span>
</code></pre></div></p>
</li>
<li>
<p>Install Loki stack:
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>install<span class="w"> </span>loki<span class="w"> </span>grafana/loki-stack<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>monitoring<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>grafana.enabled<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>loki.persistence.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>loki.persistence.size<span class="o">=</span>10Gi
</code></pre></div></p>
</li>
<li>
<p>Verify installations:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>monitoring
</code></pre></div></p>
</li>
</ol>
<h2 id="kube-kind-setting-up-nginx-reverse-proxy">Setting up Nginx Reverse Proxy<a class="headerlink" href="#kube-kind-setting-up-nginx-reverse-proxy" title="Permanent link">&para;</a></h2>
<p>Create a file named <code>nginx-proxy.yaml</code>:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-config</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">nginx.conf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">events {</span>
<span class="w">      </span><span class="no">worker_connections 1024;</span>
<span class="w">    </span><span class="no">}</span>
<span class="w">    </span><span class="no">http {</span>
<span class="w">      </span><span class="no">server {</span>
<span class="w">        </span><span class="no">listen 80;</span>

<span class="w">        </span><span class="no">location /grafana/ {</span>
<span class="w">          </span><span class="no">proxy_pass http://prometheus-grafana.monitoring.svc.cluster.local:80/;</span>
<span class="w">          </span><span class="no">proxy_set_header Host $host;</span>
<span class="w">        </span><span class="no">}</span>

<span class="w">        </span><span class="no">location /prometheus/ {</span>
<span class="w">          </span><span class="no">proxy_pass http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090/;</span>
<span class="w">          </span><span class="no">proxy_set_header Host $host;</span>
<span class="w">        </span><span class="no">}</span>

<span class="w">        </span><span class="no">location /loki/ {</span>
<span class="w">          </span><span class="no">proxy_pass http://loki.monitoring.svc.cluster.local:3100/;</span>
<span class="w">          </span><span class="no">proxy_set_header Host $host;</span>
<span class="w">        </span><span class="no">}</span>
<span class="w">      </span><span class="no">}</span>
<span class="w">    </span><span class="no">}</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-proxy</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-proxy</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-proxy</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.suse.com/suse/nginx:latest</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-config</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-config</span>
<span class="w">        </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-config</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-proxy</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-proxy</span>
</code></pre></div></p>
<p>Apply the configuration:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>nginx-proxy.yaml
</code></pre></div></p>
<h2 id="kube-kind-accessing-the-dashboards">Accessing the Dashboards<a class="headerlink" href="#kube-kind-accessing-the-dashboards" title="Permanent link">&para;</a></h2>
<p>Get the Grafana admin password (if you didn't set it in the values):
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>-n<span class="w"> </span>monitoring<span class="w"> </span>prometheus-grafana<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.data.admin-password}&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>--decode
</code></pre></div></p>
<p>Access the dashboards through the Nginx proxy:
- Grafana: http://localhost/grafana
  - Username: admin
  - Password: admin123 (or from above command if not set in values)
- Prometheus: http://localhost/prometheus
- Loki: http://localhost/loki</p>
<p>Configure Loki as a data source in Grafana:
1. Go to Configuration &gt; Data Sources in Grafana
2. Add a new Loki data source
3. Set the URL to: http://loki:3100
4. Click "Save &amp; Test"</p>
<h2 id="kube-kind-cleaning-up">Cleaning Up<a class="headerlink" href="#kube-kind-cleaning-up" title="Permanent link">&para;</a></h2>
<p>To delete the Kind cluster:
<div class="highlight"><pre><span></span><code>kind<span class="w"> </span>delete<span class="w"> </span>cluster<span class="w"> </span>--name<span class="w"> </span>monitoring
</code></pre></div></p>
<h2 id="kube-kind-next-steps">Next Steps<a class="headerlink" href="#kube-kind-next-steps" title="Permanent link">&para;</a></h2>
<p>With this setup, you now have:</p>
<ul>
<li>A local multi-node Kubernetes cluster</li>
<li>The Kubernetes CLI (kubectl) for cluster management</li>
<li>Helm for package management</li>
<li>A complete monitoring stack with Prometheus and Grafana</li>
</ul>
<p>You can now:</p>
<ol>
<li>Deploy applications to your cluster</li>
<li>Monitor cluster and application metrics</li>
<li>Set up alerts based on metrics</li>
<li>Explore Grafana dashboards for visualization</li>
</ol>
<h2 id="kube-kind-troubleshooting">Troubleshooting<a class="headerlink" href="#kube-kind-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="kube-kind-common-issues">Common Issues<a class="headerlink" href="#kube-kind-common-issues" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Podman service not running</strong>
  Check Podman socket status: <code>sudo systemctl status podman.socket</code>
  Start Podman if stopped: <code>sudo systemctl start podman.socket</code>
  Verify Podman is working: <code>podman ps</code></p>
</li>
<li>
<p><strong>Permission issues</strong>
  Check subuid/subgid mappings: <code>grep $USER /etc/subuid /etc/subgid</code>
  Verify Podman socket permissions: <code>ls -l /run/podman/podman.sock</code>
  Ensure your user is in the podman group: <code>groups $USER</code>
  Run: <code>podman system migrate</code> to update container storage</p>
</li>
<li>
<p><strong>Port conflicts</strong>
  Check if port 80 is in use: <code>sudo netstat -tulpn | grep :80</code>
  Ensure no other web servers are running on port 80
  You may need root privileges to bind to port 80</p>
</li>
<li>
<p><strong>Resource constraints</strong>
  Check available resources: <code>free -h</code> and <code>nproc</code>
  Close unnecessary applications
  Consider adding swap space if needed
  Verify cgroup settings: <code>cat /proc/cmdline | grep cgroup</code></p>
</li>
<li>
<p><strong>Repository issues</strong>
   Refresh repositories: <code>sudo zypper refresh</code>
   Check for repository errors: <code>sudo zypper repos -u</code>
   Verify network connectivity to repository URLs</p>
</li>
</ol></section><section class="print-page" id="rke2-deployment"><h1 id="rke2-deployment-rke2-default-deployment">RKE2 Default Deployment<a class="headerlink" href="#rke2-deployment-rke2-default-deployment" title="Permanent link">&para;</a></h1>
<p>rke2 version v1.31.4+rke2r1
30.12.2024</p>
<p><a href="https://docs.rke2.io/install/quickstart">RKE2 Quickstart</a></p>
<p>kubeconfig env vaiable required to target kubectl to the file:
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/rancher/rke2/rke2.yaml
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--all-namespaces
helm<span class="w"> </span>ls<span class="w"> </span>--all-namespaces
</code></pre></div>
cleanup_completed.sh:
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># List all namespaces</span>
<span class="nv">namespaces</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>namespaces<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.items[*].metadata.name}&quot;</span><span class="k">)</span>

<span class="c1"># Loop through each namespace and delete completed pods</span>
<span class="k">for</span><span class="w"> </span>ns<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$namespaces</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Cleaning up completed pods in namespace: </span><span class="nv">$ns</span><span class="s2">&quot;</span>
<span class="w">    </span>kubectl<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>--namespace<span class="o">=</span><span class="nv">$ns</span><span class="w"> </span>--field-selector<span class="o">=</span>status.phase<span class="o">=</span>Succeeded
<span class="k">done</span>
</code></pre></div>
or
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CronJob</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup-completed-pods</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span><span class="w">  </span><span class="c1"># Run daily at midnight</span>
<span class="w">  </span><span class="nt">jobTemplate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">          </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl</span>
<span class="w">            </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/kubectl</span>
<span class="w">            </span><span class="nt">command</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">              </span><span class="no">kubectl delete pod --all-namespaces --field-selector=status.phase=Succeeded</span>
<span class="w">          </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
</code></pre></div></p>
<p>This document describes the default deployment of RKE2 components in the <code>kube-system</code> namespace.</p>
<h2 id="rke2-deployment-core-components">Core Components<a class="headerlink" href="#rke2-deployment-core-components" title="Permanent link">&para;</a></h2>
<h3 id="rke2-deployment-control-plane-components">Control Plane Components<a class="headerlink" href="#rke2-deployment-control-plane-components" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>kube-apiserver</strong>: The API server is the front-end for the Kubernetes control plane, handling all API operations and serving as the gateway for the cluster.</li>
<li><strong>kube-controller-manager</strong>: Runs controller processes that regulate the state of the cluster.</li>
<li><strong>kube-scheduler</strong>: Handles pod scheduling across the cluster nodes.</li>
<li><strong>etcd</strong>: The distributed key-value store that maintains cluster state.</li>
</ul>
<h3 id="rke2-deployment-networking-components">Networking Components<a class="headerlink" href="#rke2-deployment-networking-components" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>rke2-canal</strong>: Provides networking and network policy implementation using Calico and Flannel.</li>
<li><strong>kube-proxy</strong>: Maintains network rules on nodes for pod communication.</li>
<li><strong>rke2-ingress-nginx-controller</strong>: The NGINX ingress controller for handling incoming traffic to the cluster.</li>
</ul>
<h3 id="rke2-deployment-dns-services">DNS Services<a class="headerlink" href="#rke2-deployment-dns-services" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>rke2-coredns</strong>: Provides DNS services within the cluster.</li>
<li><strong>rke2-coredns-autoscaler</strong>: Automatically scales CoreDNS deployments based on cluster load.</li>
</ul>
<h3 id="rke2-deployment-monitoring-and-metrics">Monitoring and Metrics<a class="headerlink" href="#rke2-deployment-monitoring-and-metrics" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>rke2-metrics-server</strong>: Collects resource metrics from kubelets for horizontal pod autoscaling.</li>
</ul>
<h3 id="rke2-deployment-storage-management">Storage Management<a class="headerlink" href="#rke2-deployment-storage-management" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>rke2-snapshot-controller</strong>: Manages volume snapshots in the cluster.</li>
<li><strong>rke2-snapshot-validation-webhook</strong>: Validates volume snapshot operations.</li>
</ul>
<h3 id="rke2-deployment-cloud-integration">Cloud Integration<a class="headerlink" href="#rke2-deployment-cloud-integration" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>cloud-controller-manager</strong>: Integrates with underlying cloud provider APIs.</li>
</ul>
<h2 id="rke2-deployment-deployment-diagram">Deployment Diagram<a class="headerlink" href="#rke2-deployment-deployment-diagram" title="Permanent link">&para;</a></h2>
<p><img alt="Kroki" src="https://kroki.io/plantuml/svg/eNqVVU1r20AQve-v2ObSk6hb6CUEk8YNoZCaUJdCKTlsVhN50XpXndm1Y0r-e0eflmwJE12Mdt578_VWFtcUFIa4seJdCs_Ggfxxu_j5ZXl3fyu1VURCvJcrCHILGIxWVlq19zEIC89BBi_RZOsgU4Ogg_FOUG5coVBtpPMpEBTy42zWO0Xl8vL080z0TrXfFN6BC_KfkPzcKJ1n6KNLF956vLrSHmE-l_dlthsbYRzlIOw85i3wDgHcODJ11KJ-g7V-Nw7bQECjO-iDcfk4kIJHlcEhs9pPNGJ9TFvYYq-ceC1HvPAuoLfywSregeLRroHHW4iCBVhYXgwQF82c_uTxCRJVGALkDT22g6qCqQrqSRFzIej0YhCribrWtIDJRjlOc6RQo0ivIY22H2xqRpDGPaOigFGHyK_dIulQ-bLeinFZVzbm8CnRnNI-9rbWy1mgf9mfxioeCyEQJS4z7qXXwwD-WhsXt0aPV_V1uWrjdFQX98X-eGxcchpJVAye-DJUOWsQ5-ukv3tn2A8nDTduSrpldfYa0Fe1l4ZccqqgtQ_DfjvbjSG3yhr2AN_KZAdPa-_zAaOfclG6Un5zATKsGF3yyq8TRqmtXI_6V_t9QLCVAq1NQeLYoDJJ_c4lc1laUl7Kshwg_lEBxKQpZRIL5pyIXcqdCuxO-hAL7hTafAfHvoHZ8-Q0C6HwGOqCY5uuNuvZVJIau4kzPj6v1FDF0LBvrmDEz63GUJgXVYZb3pGRz4-rIYhpO01r1AiSFZUVyUc8tDB2L85rtawTlZE7M63WgFkP4W8EYjlxDS4t_07_A5urj2Y=?"></p>
<h2 id="rke2-deployment-installation-process">Installation Process<a class="headerlink" href="#rke2-deployment-installation-process" title="Permanent link">&para;</a></h2>
<p>The deployment shows several completed Helm installations that set up these components:
- helm-install-rke2-canal
- helm-install-rke2-coredns
- helm-install-rke2-ingress-nginx
- helm-install-rke2-metrics-server
- helm-install-rke2-snapshot-controller
- helm-install-rke2-snapshot-validation-webhook</p>
<p>Each component is deployed and managed as part of the RKE2 system, ensuring a production-ready Kubernetes cluster with all necessary services for networking, DNS, metrics collection, and storage management.</p></section><section class="print-page" id="kube-traefik"><h1 id="kube-traefik-traefik-on-rke2">Traefik on RKE2<a class="headerlink" href="#kube-traefik-traefik-on-rke2" title="Permanent link">&para;</a></h1>
<h2 id="kube-traefik-summary">Summary<a class="headerlink" href="#kube-traefik-summary" title="Permanent link">&para;</a></h2>
<p>This guide demonstrates how to deploy Traefik as an ingress controller on RKE2 Kubernetes cluster, including sample configurations for routing traffic to applications.</p>
<h2 id="kube-traefik-quick-start">Quick Start<a class="headerlink" href="#kube-traefik-quick-start" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Deploy sample web application</span>
kubectl<span class="w"> </span>create<span class="w"> </span>deployment<span class="w"> </span>whoami<span class="w"> </span>--image<span class="o">=</span>traefik/whoami
kubectl<span class="w"> </span>expose<span class="w"> </span>deployment<span class="w"> </span>whoami<span class="w"> </span>--port<span class="o">=</span><span class="m">80</span>

<span class="c1"># Create test ingress route</span>
cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: traefik.containo.us/v1alpha1</span>
<span class="s">kind: IngressRoute</span>
<span class="s">metadata:</span>
<span class="s">  name: whoami-route</span>
<span class="s">spec:</span>
<span class="s">  entryPoints:</span>
<span class="s">    - web</span>
<span class="s">  routes:</span>
<span class="s">    - match: PathPrefix(`/test`)</span>
<span class="s">      kind: Rule</span>
<span class="s">      services:</span>
<span class="s">        - name: whoami</span>
<span class="s">          port: 80</span>
<span class="s">EOF</span>

<span class="c1"># Create Longhorn ingress route</span>
cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: traefik.containo.us/v1alpha1</span>
<span class="s">kind: IngressRoute</span>
<span class="s">metadata:</span>
<span class="s">  name: longhorn-route</span>
<span class="s">spec:</span>
<span class="s">  entryPoints:</span>
<span class="s">    - web</span>
<span class="s">  routes:</span>
<span class="s">    - match: PathPrefix(`/longhorn`)</span>
<span class="s">      kind: Rule</span>
<span class="s">      services:</span>
<span class="s">        - name: longhorn-frontend</span>
<span class="s">          port: 80</span>
<span class="s">EOF</span>
</code></pre></div>
<h2 id="kube-traefik-architecture">Architecture<a class="headerlink" href="#kube-traefik-architecture" title="Permanent link">&para;</a></h2>
<p>```plantuml
@startuml
!include <C4/C4_Container></p>
<p>Person(user, "User", "External user accessing applications")
Container(traefik, "Traefik", "Ingress Controller", "Routes external traffic to services")
Container(whoami, "Whoami", "Demo Application", "Simple web service showing request info")
Container(longhorn, "Longhorn UI", "Storage Dashboard", "Web interface for Longhorn storage")</p>
<p>Rel(user, traefik, "HTTP requests", "/test, /longhorn")
Rel(traefik, whoami, "Routes /test", "HTTP")
Rel(traefik, longhorn, "Routes /longhorn", "HTTP")
@enduml
```</p>
<h2 id="kube-traefik-detailed-configuration">Detailed Configuration<a class="headerlink" href="#kube-traefik-detailed-configuration" title="Permanent link">&para;</a></h2>
<h3 id="kube-traefik-1-verify-traefik-installation">1. Verify Traefik Installation<a class="headerlink" href="#kube-traefik-1-verify-traefik-installation" title="Permanent link">&para;</a></h3>
<p>RKE2 comes with Traefik installed by default. Verify the installation:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>traefik
</code></pre></div>
<h3 id="kube-traefik-2-deploy-sample-application">2. Deploy Sample Application<a class="headerlink" href="#kube-traefik-2-deploy-sample-application" title="Permanent link">&para;</a></h3>
<p>Deploy the whoami application which will serve as our test endpoint:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># whoami-deployment.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">whoami</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">whoami</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">whoami</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">whoami</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik/whoami</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">whoami</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">whoami</span>
</code></pre></div>
<p>Apply the configuration:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>whoami-deployment.yaml
</code></pre></div></p>
<h3 id="kube-traefik-3-configure-test-route">3. Configure Test Route<a class="headerlink" href="#kube-traefik-3-configure-test-route" title="Permanent link">&para;</a></h3>
<p>Create an IngressRoute for the whoami service:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># whoami-route.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.containo.us/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IngressRoute</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">whoami-route</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">entryPoints</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">  </span><span class="nt">routes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PathPrefix(`/test`)</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Rule</span>
<span class="w">      </span><span class="nt">services</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">whoami</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
<p>Apply the route:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>whoami-route.yaml
</code></pre></div></p>
<h3 id="kube-traefik-4-configure-longhorn-ui-route">4. Configure Longhorn UI Route<a class="headerlink" href="#kube-traefik-4-configure-longhorn-ui-route" title="Permanent link">&para;</a></h3>
<p>Create an IngressRoute for the Longhorn frontend:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># longhorn-route.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.containo.us/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IngressRoute</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">longhorn-route</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">entryPoints</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">  </span><span class="nt">routes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PathPrefix(`/longhorn`)</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Rule</span>
<span class="w">      </span><span class="nt">services</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">longhorn-frontend</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
<p>Apply the route:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>longhorn-route.yaml
</code></pre></div></p>
<h3 id="kube-traefik-5-verify-routes">5. Verify Routes<a class="headerlink" href="#kube-traefik-5-verify-routes" title="Permanent link">&para;</a></h3>
<p>Test the configurations:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Get Traefik service NodePort</span>
kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>traefik

<span class="c1"># Test whoami endpoint</span>
curl<span class="w"> </span>http://&lt;node-ip&gt;:&lt;nodeport&gt;/test

<span class="c1"># Access Longhorn UI</span>
curl<span class="w"> </span>http://&lt;node-ip&gt;:&lt;nodeport&gt;/longhorn
</code></pre></div>
<h2 id="kube-traefik-troubleshooting">Troubleshooting<a class="headerlink" href="#kube-traefik-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="kube-traefik-check-traefik-logs">Check Traefik Logs<a class="headerlink" href="#kube-traefik-check-traefik-logs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>traefik
</code></pre></div>
<h3 id="kube-traefik-verify-ingressroutes">Verify IngressRoutes<a class="headerlink" href="#kube-traefik-verify-ingressroutes" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>ingressroutes
kubectl<span class="w"> </span>describe<span class="w"> </span>ingressroute<span class="w"> </span>whoami-route
kubectl<span class="w"> </span>describe<span class="w"> </span>ingressroute<span class="w"> </span>longhorn-route
</code></pre></div>
<h3 id="kube-traefik-common-issues">Common Issues<a class="headerlink" href="#kube-traefik-common-issues" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>404 Not Found</strong>: Verify service names and ports in IngressRoute configuration</li>
<li><strong>503 Service Unavailable</strong>: Check if target pods are running and ready</li>
<li><strong>Path not working</strong>: Ensure PathPrefix in IngressRoute matches the request path</li>
</ol></section><section class="print-page" id="kube-deployment-opensource"><h1 id="kube-deployment-opensource-open-source-kubernetes-deployment-guide">Open Source Kubernetes Deployment Guide<a class="headerlink" href="#kube-deployment-opensource-open-source-kubernetes-deployment-guide" title="Permanent link">&para;</a></h1>
<h2 id="kube-deployment-opensource-summary">Summary<a class="headerlink" href="#kube-deployment-opensource-summary" title="Permanent link">&para;</a></h2>
<p>This guide describes a production-grade Kubernetes deployment using RKE2 as the distribution, featuring a comprehensive stack of open-source components. The deployment includes a 3-node cluster with Traefik for API and web gateway services, Keycloak for OAuth2 authentication, OpenEBS for storage management, PostgreSQL as a stateful database, and Apache Airflow for orchestrating analysis workloads.</p>
<h2 id="kube-deployment-opensource-quick-start">Quick Start<a class="headerlink" href="#kube-deployment-opensource-quick-start" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Install RKE2 on the first server node</span>
curl<span class="w"> </span>-sfL<span class="w"> </span>https://get.rke2.io<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>rke2-server.service
systemctl<span class="w"> </span>start<span class="w"> </span>rke2-server.service

<span class="c1"># Get the node token from the first server</span>
cat<span class="w"> </span>/var/lib/rancher/rke2/server/node-token

<span class="c1"># Install and join additional server nodes</span>
curl<span class="w"> </span>-sfL<span class="w"> </span>https://get.rke2.io<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-
mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/rancher/rke2/
cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; /etc/rancher/rke2/config.yaml</span>
<span class="s">server: https://&lt;first-server-ip&gt;:9345</span>
<span class="s">token: &lt;node-token&gt;</span>
<span class="s">EOF</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>rke2-server.service
systemctl<span class="w"> </span>start<span class="w"> </span>rke2-server.service

<span class="c1"># Install kubectl and configure access</span>
mkdir<span class="w"> </span>~/.kube
cp<span class="w"> </span>/etc/rancher/rke2/rke2.yaml<span class="w"> </span>~/.kube/config
chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>~/.kube/config

<span class="c1"># Deploy OpenEBS</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://openebs.github.io/charts/openebs-operator.yaml

<span class="c1"># Install Helm</span>
curl<span class="w"> </span>https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash

<span class="c1"># Add and update required Helm repositories</span>
helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>traefik<span class="w"> </span>https://helm.traefik.io/traefik
helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>bitnami<span class="w"> </span>https://charts.bitnami.com/bitnami
helm<span class="w"> </span>repo<span class="w"> </span>update

<span class="c1"># Deploy Traefik</span>
helm<span class="w"> </span>install<span class="w"> </span>traefik<span class="w"> </span>traefik/traefik<span class="w"> </span>-n<span class="w"> </span>traefik<span class="w"> </span>--create-namespace

<span class="c1"># Deploy PostgreSQL with OpenEBS storage</span>
kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>database
helm<span class="w"> </span>install<span class="w"> </span>postgresql<span class="w"> </span>bitnami/postgresql<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>database<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>persistence.storageClass<span class="o">=</span>openebs-hostpath<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>persistence.size<span class="o">=</span>10Gi

<span class="c1"># Deploy Keycloak</span>
kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>auth
helm<span class="w"> </span>install<span class="w"> </span>keycloak<span class="w"> </span>bitnami/keycloak<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>auth<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>postgresql.enabled<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>externalDatabase.host<span class="o">=</span>postgresql.database.svc.cluster.local<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>externalDatabase.port<span class="o">=</span><span class="m">5432</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>externalDatabase.user<span class="o">=</span>postgres<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>externalDatabase.database<span class="o">=</span>keycloak

<span class="c1"># Deploy Airflow</span>
helm<span class="w"> </span>install<span class="w"> </span>airflow<span class="w"> </span>bitnami/airflow<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>airflow<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>postgresql.enabled<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>externalDatabase.host<span class="o">=</span>postgresql.database.svc.cluster.local<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>externalDatabase.port<span class="o">=</span><span class="m">5432</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>externalDatabase.user<span class="o">=</span>postgres<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>externalDatabase.database<span class="o">=</span>airflow
</code></pre></div>
<h2 id="kube-deployment-opensource-architecture">Architecture<a class="headerlink" href="#kube-deployment-opensource-architecture" title="Permanent link">&para;</a></h2>
<p><img alt="Kroki" src="https://kroki.io/plantuml/svg/eNqNUj1PwzAQ3f0rTtk7EHbUUmVARaVgJAbUwU0uYMWxI_tMiRD_HddGRIAj2Hzvw_fu7KUjYcn3irlO6kFY0UNt-sFo1MRpVAiBLBmrlfENFNUrodVCwRbpaGxXwBsDeFwrGfSwGgYla0HSaLdn74xp0yAUd5uqhI0_BCcSOlgr78I1n97IcrQvaGF70p_ts3CZh88jfG8FtrKDK_1k0bmIbXAMqUUXi5sBdXXJ43lnHAUZv70GToKw9YojRWolbavMEXj9jI1XaL-hD3hIrRMa9jA66WBnmjRudg-wWFxkAv5Ckm4KPSPIZJlMSTI3X2a6fxqmZn8YZojk-nqD2SA_VsqWqJvT5_wA_kvlyg==?"></p>
<h2 id="kube-deployment-opensource-component-details">Component Details<a class="headerlink" href="#kube-deployment-opensource-component-details" title="Permanent link">&para;</a></h2>
<h3 id="kube-deployment-opensource-rke2-cluster">RKE2 Cluster<a class="headerlink" href="#kube-deployment-opensource-rke2-cluster" title="Permanent link">&para;</a></h3>
<ul>
<li>3-node highly available control plane</li>
<li>Built-in containerd runtime</li>
<li>Automated certificate management</li>
<li>Integrated security features</li>
</ul>
<h3 id="kube-deployment-opensource-traefik-gateway">Traefik Gateway<a class="headerlink" href="#kube-deployment-opensource-traefik-gateway" title="Permanent link">&para;</a></h3>
<ul>
<li>API and Web Gateway services</li>
<li>Automatic SSL/TLS termination</li>
<li>Rate limiting capabilities</li>
<li>Monitoring endpoints</li>
<li>Load balancing</li>
</ul>
<h3 id="kube-deployment-opensource-keycloak-oauth2">Keycloak OAuth2<a class="headerlink" href="#kube-deployment-opensource-keycloak-oauth2" title="Permanent link">&para;</a></h3>
<ul>
<li>Centralized authentication</li>
<li>OAuth2/OpenID Connect support</li>
<li>User federation</li>
<li>Role-based access control</li>
<li>Single sign-on capabilities</li>
</ul>
<h3 id="kube-deployment-opensource-openebs-storage">OpenEBS Storage<a class="headerlink" href="#kube-deployment-opensource-openebs-storage" title="Permanent link">&para;</a></h3>
<ul>
<li>Dynamic volume provisioning</li>
<li>Local and distributed storage options</li>
<li>Storage class management</li>
<li>Snapshot and backup support</li>
</ul>
<h3 id="kube-deployment-opensource-postgresql-statefulset">PostgreSQL StatefulSet<a class="headerlink" href="#kube-deployment-opensource-postgresql-statefulset" title="Permanent link">&para;</a></h3>
<ul>
<li>Persistent storage with OpenEBS</li>
<li>Automated backups</li>
<li>High availability configuration</li>
<li>Data replication</li>
</ul>
<h3 id="kube-deployment-opensource-airflow-orchestration">Airflow Orchestration<a class="headerlink" href="#kube-deployment-opensource-airflow-orchestration" title="Permanent link">&para;</a></h3>
<ul>
<li>Dynamic pod spawning</li>
<li>Workflow management</li>
<li>Scheduled analysis jobs</li>
<li>Resource optimization</li>
<li>Monitoring and logging</li>
</ul>
<h2 id="kube-deployment-opensource-data-flow">Data Flow<a class="headerlink" href="#kube-deployment-opensource-data-flow" title="Permanent link">&para;</a></h2>
<p><img alt="Kroki" src="https://kroki.io/plantuml/svg/eNpdkctuwyAQRfd8xSj7UvXdelEFRXKqOgsaUPfUniTIFFLAtfz3xU4c1d4A0jl3HmIZovKx-TbkmG5d6qOyERYrozHdW_xpMMQFqACr7VSRXuFO17BWEVvVDY5cT50Cu9I4VQNr4mEwCjY1uHcRy4gVCPS_usTB4mJmuRD3HsXH5oRnbZj2O-PagbF8xqwyXdAp5KqTwAlZbeHqNU2bwQ2FNyn5dX-IcV8i1z0vWAa3dJj9QgrWE56SdxQ-ldFVWh-kq9GeWV_1_pIKR2cDngtykcEDhdz5VvnqUjM1TpDlGTxSkF7v9-hhnJuwfOz4REFE5xHe3Vd6qdiMlPEMnilsVGPLA_xfmTA-xl_GeJqqMTEQskRb9V__BwBeoww=?"></p>
<h2 id="kube-deployment-opensource-security-considerations">Security Considerations<a class="headerlink" href="#kube-deployment-opensource-security-considerations" title="Permanent link">&para;</a></h2>
<ol>
<li>Network Security</li>
<li>All external traffic routed through Traefik</li>
<li>Internal service communication encrypted</li>
<li>
<p>Network policies for pod isolation</p>
</li>
<li>
<p>Authentication &amp; Authorization</p>
</li>
<li>Centralized OAuth2 with Keycloak</li>
<li>Role-based access control (RBAC)</li>
<li>Service account management</li>
<li>
<p>Token-based authentication</p>
</li>
<li>
<p>Data Security</p>
</li>
<li>Encrypted storage with OpenEBS</li>
<li>Regular database backups</li>
<li>Secure credential management</li>
<li>Pod security policies</li>
</ol>
<h2 id="kube-deployment-opensource-monitoring-and-maintenance">Monitoring and Maintenance<a class="headerlink" href="#kube-deployment-opensource-monitoring-and-maintenance" title="Permanent link">&para;</a></h2>
<ol>
<li>Cluster Health</li>
<li>Node status monitoring</li>
<li>Control plane metrics</li>
<li>
<p>Resource utilization</p>
</li>
<li>
<p>Application Monitoring</p>
</li>
<li>Traefik metrics</li>
<li>Keycloak audit logs</li>
<li>PostgreSQL performance metrics</li>
<li>
<p>Airflow task monitoring</p>
</li>
<li>
<p>Storage Management</p>
</li>
<li>Volume health monitoring</li>
<li>Capacity planning</li>
<li>Backup verification</li>
<li>Performance metrics</li>
</ol>
<h2 id="kube-deployment-opensource-scaling-considerations">Scaling Considerations<a class="headerlink" href="#kube-deployment-opensource-scaling-considerations" title="Permanent link">&para;</a></h2>
<ol>
<li>Horizontal Scaling</li>
<li>Add worker nodes as needed</li>
<li>Scale Traefik replicas</li>
<li>
<p>Increase analysis pod capacity</p>
</li>
<li>
<p>Vertical Scaling</p>
</li>
<li>Adjust resource limits</li>
<li>Optimize pod requests</li>
<li>
<p>Tune database resources</p>
</li>
<li>
<p>Storage Scaling</p>
</li>
<li>Expand volume capacity</li>
<li>Add storage nodes</li>
<li>Optimize storage classes</li>
</ol>
<h2 id="kube-deployment-opensource-troubleshooting">Troubleshooting<a class="headerlink" href="#kube-deployment-opensource-troubleshooting" title="Permanent link">&para;</a></h2>
<ol>
<li>Cluster Issues</li>
<li>Check node status</li>
<li>Verify control plane health</li>
<li>
<p>Review system logs</p>
</li>
<li>
<p>Application Issues</p>
</li>
<li>Monitor pod status</li>
<li>Check service endpoints</li>
<li>
<p>Review application logs</p>
</li>
<li>
<p>Storage Issues</p>
</li>
<li>Verify volume status</li>
<li>Check storage provisioner</li>
<li>Monitor capacity alerts</li>
</ol>
<h2 id="kube-deployment-opensource-backup-and-disaster-recovery">Backup and Disaster Recovery<a class="headerlink" href="#kube-deployment-opensource-backup-and-disaster-recovery" title="Permanent link">&para;</a></h2>
<ol>
<li>Regular Backups</li>
<li>Database dumps</li>
<li>Volume snapshots</li>
<li>
<p>Configuration backups</p>
</li>
<li>
<p>Recovery Procedures</p>
</li>
<li>Node replacement</li>
<li>Data restoration</li>
<li>
<p>Service recovery</p>
</li>
<li>
<p>High Availability</p>
</li>
<li>Multi-node redundancy</li>
<li>Service replication</li>
<li>Automated failover</li>
</ol></section><section class="print-page" id="ansible-rke2"><h1 id="ansible-rke2-installing-ansible-on-rke2-cluster">Installing Ansible on RKE2 Cluster<a class="headerlink" href="#ansible-rke2-installing-ansible-on-rke2-cluster" title="Permanent link">&para;</a></h1>
<h2 id="ansible-rke2-quick-steps">Quick Steps<a class="headerlink" href="#ansible-rke2-quick-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Install Ansible operator prerequisites:
   <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>ansible-system
</code></pre></div></li>
<li>Install Ansible Operator:
   <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/operator-framework/operator-lifecycle-manager/master/deploy/upstream/quickstart-catalog.yaml
kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>https://operatorhub.io/install/ansible-operator.yaml
</code></pre></div></li>
<li>Verify installation:
   <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>ansible-system
</code></pre></div></li>
</ol>
<h2 id="ansible-rke2-architecture-overview">Architecture Overview<a class="headerlink" href="#ansible-rke2-architecture-overview" title="Permanent link">&para;</a></h2>
<p><img alt="Kroki" src="https://kroki.io/plantuml/svg/eNqNk09PAjEQxe_9FCOeNyYeCSEg2XAQDAGNB-OhtMPSbJlu-kcgxu9u1wVZ3BXtcfvemze_TQfOc-vDRrMriStFCPN09Dh8GE9SEJo7x5jLFRXc8g0IsykMIXl4ZxDPHRd5Zk0gOTLa2F4Pd8p5RVm_DxOVrf3Y8n27knB7EiES-2CsiCKeIXTm9-ktjAx5azTMNCfsHCa-5GGJCS-UQ_uG9rU-shKgF_L8cz15SE4tNcbwwybuO5lXV4kp0HJvyuyq5HWt5ZnSBiL8h05Um-hftLGf0CZI6Ew5xZYS5uhMsAJP5WZGupZlF5GCirqWq4hvpbIpL1yDRnNVSEKR9Bt0oQvP3Is1upunQnKPjv1c_uhsRnYh3aEI0VT-wv3SmLxmrzG5FFERcbDwcXprcWm2VLq_CJ0cF7Xf2KK-4hTsH5Yazmg60mADJFk-nk_3rB-J?"></p>
<h2 id="ansible-rke2-prerequisites">Prerequisites<a class="headerlink" href="#ansible-rke2-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Running RKE2 cluster named "default"</li>
<li><code>kubectl</code> access to the cluster</li>
<li>Cluster admin privileges</li>
</ul>
<h2 id="ansible-rke2-detailed-installation-steps">Detailed Installation Steps<a class="headerlink" href="#ansible-rke2-detailed-installation-steps" title="Permanent link">&para;</a></h2>
<h3 id="ansible-rke2-1-prepare-the-cluster">1. Prepare the Cluster<a class="headerlink" href="#ansible-rke2-1-prepare-the-cluster" title="Permanent link">&para;</a></h3>
<p>Create a dedicated namespace for Ansible components:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>ansible-system
</code></pre></div></p>
<h3 id="ansible-rke2-2-install-operator-lifecycle-manager-olm">2. Install Operator Lifecycle Manager (OLM)<a class="headerlink" href="#ansible-rke2-2-install-operator-lifecycle-manager-olm" title="Permanent link">&para;</a></h3>
<p>OLM is required to manage the Ansible Operator:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/operator-framework/operator-lifecycle-manager/master/deploy/upstream/quickstart-catalog.yaml
</code></pre></div></p>
<p>Wait for OLM to be ready:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>--for<span class="o">=</span><span class="nv">condition</span><span class="o">=</span>ready<span class="w"> </span>pod<span class="w"> </span>-l<span class="w"> </span><span class="nv">name</span><span class="o">=</span>olm-operator<span class="w"> </span>-n<span class="w"> </span>olm<span class="w"> </span>--timeout<span class="o">=</span>90s
</code></pre></div></p>
<h3 id="ansible-rke2-3-install-ansible-operator">3. Install Ansible Operator<a class="headerlink" href="#ansible-rke2-3-install-ansible-operator" title="Permanent link">&para;</a></h3>
<p>Deploy the Ansible Operator using OperatorHub manifest:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>https://operatorhub.io/install/ansible-operator.yaml
</code></pre></div></p>
<h3 id="ansible-rke2-4-verify-installation">4. Verify Installation<a class="headerlink" href="#ansible-rke2-4-verify-installation" title="Permanent link">&para;</a></h3>
<p>Check if the Ansible Operator pods are running:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>ansible-system
</code></pre></div></p>
<p>Verify the operator deployment:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>ansible-system<span class="w"> </span>ansible-operator
</code></pre></div></p>
<h3 id="ansible-rke2-5-configure-rbac">5. Configure RBAC<a class="headerlink" href="#ansible-rke2-5-configure-rbac" title="Permanent link">&para;</a></h3>
<p>Create necessary RBAC permissions:
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: ServiceAccount</span>
<span class="s">metadata:</span>
<span class="s">  name: ansible-operator</span>
<span class="s">  namespace: ansible-system</span>
<span class="s">---</span>
<span class="s">apiVersion: rbac.authorization.k8s.io/v1</span>
<span class="s">kind: ClusterRole</span>
<span class="s">metadata:</span>
<span class="s">  name: ansible-operator</span>
<span class="s">rules:</span>
<span class="s">- apiGroups: [&quot;*&quot;]</span>
<span class="s">  resources: [&quot;*&quot;]</span>
<span class="s">  verbs: [&quot;*&quot;]</span>
<span class="s">---</span>
<span class="s">apiVersion: rbac.authorization.k8s.io/v1</span>
<span class="s">kind: ClusterRoleBinding</span>
<span class="s">metadata:</span>
<span class="s">  name: ansible-operator</span>
<span class="s">subjects:</span>
<span class="s">- kind: ServiceAccount</span>
<span class="s">  name: ansible-operator</span>
<span class="s">  namespace: ansible-system</span>
<span class="s">roleRef:</span>
<span class="s">  kind: ClusterRole</span>
<span class="s">  name: ansible-operator</span>
<span class="s">  apiGroup: rbac.authorization.k8s.io</span>
<span class="s">EOF</span>
</code></pre></div></p>
<h2 id="ansible-rke2-usage-example">Usage Example<a class="headerlink" href="#ansible-rke2-usage-example" title="Permanent link">&para;</a></h2>
<p>Create a simple Ansible playbook as a ConfigMap:
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: ConfigMap</span>
<span class="s">metadata:</span>
<span class="s">  name: sample-playbook</span>
<span class="s">  namespace: ansible-system</span>
<span class="s">data:</span>
<span class="s">  playbook.yml: |</span>
<span class="s">    - hosts: localhost</span>
<span class="s">      tasks:</span>
<span class="s">        - name: Create a namespace</span>
<span class="s">          k8s:</span>
<span class="s">            name: example-namespace</span>
<span class="s">            kind: Namespace</span>
<span class="s">            state: present</span>
<span class="s">EOF</span>
</code></pre></div></p>
<h2 id="ansible-rke2-troubleshooting">Troubleshooting<a class="headerlink" href="#ansible-rke2-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="ansible-rke2-common-issues">Common Issues<a class="headerlink" href="#ansible-rke2-common-issues" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Operator Pod Not Starting
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>ansible-system<span class="w"> </span>-l<span class="w"> </span><span class="nv">name</span><span class="o">=</span>ansible-operator
</code></pre></div></p>
</li>
<li>
<p>Permission Issues
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>clusterrolebinding<span class="w"> </span>ansible-operator
</code></pre></div></p>
</li>
<li>
<p>OLM Installation Problems
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>events<span class="w"> </span>-n<span class="w"> </span>olm
</code></pre></div></p>
</li>
</ol>
<h2 id="ansible-rke2-maintenance">Maintenance<a class="headerlink" href="#ansible-rke2-maintenance" title="Permanent link">&para;</a></h2>
<h3 id="ansible-rke2-updating-ansible-operator">Updating Ansible Operator<a class="headerlink" href="#ansible-rke2-updating-ansible-operator" title="Permanent link">&para;</a></h3>
<p>To update the operator to a newer version:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>https://operatorhub.io/install/ansible-operator.yaml
kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>https://operatorhub.io/install/ansible-operator.yaml
</code></pre></div></p>
<h3 id="ansible-rke2-cleanup">Cleanup<a class="headerlink" href="#ansible-rke2-cleanup" title="Permanent link">&para;</a></h3>
<p>To remove Ansible from your cluster:
```bash
kubectl delete namespace ansible-system
kubectl delete clusterrole ansible-operator
kubectl delete clusterrolebinding ansible-operator</p></section><section class="print-page" id="kube-harbor"><h1 id="kube-harbor-harbor-registry-deployment-guide">Harbor Registry Deployment Guide<a class="headerlink" href="#kube-harbor-harbor-registry-deployment-guide" title="Permanent link">&para;</a></h1>
<p>Harbor is an open source registry that secures artifacts with policies and role-based access control, ensures images are scanned and free from vulnerabilities, and signs images as trusted.</p>
<h2 id="kube-harbor-quick-steps">Quick Steps<a class="headerlink" href="#kube-harbor-quick-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Prerequisites:</li>
<li>Kubernetes cluster</li>
<li>Helm 3.x</li>
<li>Domain name for Harbor</li>
<li>
<p>SSL certificate (optional for production)</p>
</li>
<li>
<p>Installation:
   <div class="highlight"><pre><span></span><code><span class="c1"># Add Harbor Helm repository</span>
helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>harbor<span class="w"> </span>https://helm.goharbor.io
helm<span class="w"> </span>repo<span class="w"> </span>update

<span class="c1"># Create namespace</span>
kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>harbor

<span class="c1"># Install Harbor</span>
helm<span class="w"> </span>install<span class="w"> </span>harbor<span class="w"> </span>harbor/harbor<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>harbor<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>expose.type<span class="o">=</span>ingress<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>expose.tls.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span><span class="nv">externalURL</span><span class="o">=</span>https://harbor.yourdomain.com
</code></pre></div></p>
</li>
<li>
<p>Verify Installation:
   <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>harbor
</code></pre></div></p>
</li>
</ol>
<h2 id="kube-harbor-architecture-overview">Architecture Overview<a class="headerlink" href="#kube-harbor-architecture-overview" title="Permanent link">&para;</a></h2>
<p><img alt="Kroki" src="https://kroki.io/plantuml/svg/eNplksFOwzAMhu95Cmv3agduHNBGJ9iEQBOFB0hb0wXSpHJSpA3t3XHdrGzj0ti_vzr1Xy9C1BT71ipFWEXtGoswe-pLJIcRA-S2DxFpBj8KoPJt5x26CLONawgD172L5K0dEB3AjLJiuNPVl26421pT6QledIuBRRx7XXTLPaG8X3FwXXzFxoRIewEoJdfQ1lPUVpBOQgFqHXWpA3_EKkVC1OX_O2oT0gUcXZffyHyP98chknKInmS-IgX3PDC6WrBUZPCojkrpinOYvQekeW4N9xSq5_xUyzfzfAVb06E1LplhqlqpAYIsu5u8HeQLIZ2ipeHPJfF0eEg2GTgp7MZZdZj-xIh0GmViRguU8xGBTLOL4D_OBuaN-DBNT7rkVSpHT25Zz-DBWCz2vE6tpMWNHMtDL_88g8e8UAzD0Pm6f1qMtXa1xTD2W_Zxx1aaSkfj3SR5Moc_ZUv-kzcbnrXj72uZP7tjweGw_L8A7PuM?"></p>
<h2 id="kube-harbor-detailed-deployment-steps">Detailed Deployment Steps<a class="headerlink" href="#kube-harbor-detailed-deployment-steps" title="Permanent link">&para;</a></h2>
<h3 id="kube-harbor-1-prerequisites-setup">1. Prerequisites Setup<a class="headerlink" href="#kube-harbor-1-prerequisites-setup" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Ensure Kubernetes cluster is running:
   <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>cluster-info
</code></pre></div></p>
</li>
<li>
<p>Install Helm if not already installed:
   <div class="highlight"><pre><span></span><code>curl<span class="w"> </span>https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</code></pre></div></p>
</li>
<li>
<p>Prepare storage class (if using cloud provider, skip this step):
   <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: storage.k8s.io/v1</span>
<span class="s">kind: StorageClass</span>
<span class="s">metadata:</span>
<span class="s">  name: harbor-storage</span>
<span class="s">provisioner: kubernetes.io/no-provisioner</span>
<span class="s">volumeBindingMode: WaitForFirstConsumer</span>
<span class="s">EOF</span>
</code></pre></div></p>
</li>
</ol>
<h3 id="kube-harbor-2-configuration">2. Configuration<a class="headerlink" href="#kube-harbor-2-configuration" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create values.yaml for Harbor configuration:
   <div class="highlight"><pre><span></span><code><span class="nt">expose</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress</span>
<span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">      </span><span class="nt">core</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">harbor.yourdomain.com</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>

<span class="nt">persistence</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;harbor-storage&quot;</span>

<span class="nt">harborAdminPassword</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;your-secure-password&quot;</span>

<span class="nt">database</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internal</span>
<span class="w">  </span><span class="nt">internal</span><span class="p">:</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;your-db-password&quot;</span>
</code></pre></div></p>
</li>
<li>
<p>Install Harbor using Helm:
   <div class="highlight"><pre><span></span><code>helm<span class="w"> </span>install<span class="w"> </span>harbor<span class="w"> </span>harbor/harbor<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>harbor<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-f<span class="w"> </span>values.yaml
</code></pre></div></p>
</li>
</ol>
<h3 id="kube-harbor-3-post-installation">3. Post-Installation<a class="headerlink" href="#kube-harbor-3-post-installation" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Verify all pods are running:
   <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>harbor
</code></pre></div></p>
</li>
<li>
<p>Configure DNS or add to hosts file:
   <div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>harbor-ingress<span class="w"> </span>-n<span class="w"> </span>harbor<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span class="k">)</span><span class="s2"> harbor.yourdomain.com&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/hosts
</code></pre></div></p>
</li>
<li>
<p>Access Harbor Portal:</p>
</li>
<li>URL: https://harbor.yourdomain.com</li>
<li>Default credentials:<ul>
<li>Username: admin</li>
<li>Password: Harbor12345 (or the one set in values.yaml)</li>
</ul>
</li>
</ol>
<h3 id="kube-harbor-4-configure-docker-client">4. Configure Docker Client<a class="headerlink" href="#kube-harbor-4-configure-docker-client" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Add Harbor's certificate to Docker:
   <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/docker/certs.d/harbor.yourdomain.com
sudo<span class="w"> </span>cp<span class="w"> </span>ca.crt<span class="w"> </span>/etc/docker/certs.d/harbor.yourdomain.com/
</code></pre></div></p>
</li>
<li>
<p>Login to Harbor:
   <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>login<span class="w"> </span>harbor.yourdomain.com
</code></pre></div></p>
</li>
<li>
<p>Push an image:
   <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>tag<span class="w"> </span>nginx:latest<span class="w"> </span>harbor.yourdomain.com/library/nginx:latest
docker<span class="w"> </span>push<span class="w"> </span>harbor.yourdomain.com/library/nginx:latest
</code></pre></div></p>
</li>
</ol>
<h2 id="kube-harbor-security-considerations">Security Considerations<a class="headerlink" href="#kube-harbor-security-considerations" title="Permanent link">&para;</a></h2>
<ol>
<li>Change default admin password immediately</li>
<li>Enable RBAC and create projects with appropriate permissions</li>
<li>Configure vulnerability scanning with Trivy</li>
<li>Enable image signing for trusted content</li>
<li>Regular backup of Harbor data</li>
</ol>
<h2 id="kube-harbor-troubleshooting">Troubleshooting<a class="headerlink" href="#kube-harbor-troubleshooting" title="Permanent link">&para;</a></h2>
<p>Common issues and solutions:</p>
<ol>
<li>
<p>Pod startup issues:
   <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>&lt;pod-name&gt;<span class="w"> </span>-n<span class="w"> </span>harbor
kubectl<span class="w"> </span>logs<span class="w"> </span>&lt;pod-name&gt;<span class="w"> </span>-n<span class="w"> </span>harbor
</code></pre></div></p>
</li>
<li>
<p>Storage issues:</p>
</li>
<li>Check PVC status:
     <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pvc<span class="w"> </span>-n<span class="w"> </span>harbor
</code></pre></div></li>
<li>
<p>Verify StorageClass:
     <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>sc
</code></pre></div></p>
</li>
<li>
<p>Ingress issues:</p>
</li>
<li>Verify ingress configuration:
     ```bash
     kubectl get ingress -n harbor
     kubectl describe ingress -n harbor</li>
</ol></section><section class="print-page" id="kube-portworkx"><h1 id="kube-portworkx-portworx-on-suse-leap-155-with-rke2">Portworx on SUSE Leap 15.5 with RKE2<a class="headerlink" href="#kube-portworkx-portworx-on-suse-leap-155-with-rke2" title="Permanent link">&para;</a></h1>
<p>This guide provides instructions for deploying Portworx on SUSE Leap 15.5 with RKE2 Kubernetes cluster.</p>
<h2 id="kube-portworkx-quick-start">Quick Start<a class="headerlink" href="#kube-portworkx-quick-start" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Install required packages</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">KUBECTL_SERVER_VERSION</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>version<span class="w"> </span>-oyaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>serverVersion:<span class="w"> </span>-A5<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>gitVersion:<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/+.*//&#39;</span><span class="k">)</span>

kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;https://install.portworx.com/3.2?comp=pxoperator&amp;kbver=</span><span class="nv">$KUBECTL_SERVER_VERSION</span><span class="s2">&amp;ns=portworx&quot;</span>

zypper<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>docker<span class="w"> </span>python3-pip

<span class="c1"># Start and enable docker service</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>docker

<span class="c1"># Download Portworx Spec Generator</span>
curl<span class="w"> </span>-o<span class="w"> </span>px-spec.yaml<span class="w"> </span><span class="s2">&quot;https://install.portworx.com/3.2?operator=true&amp;mc=false&amp;kbver=</span><span class="nv">$KUBECTL_SERVER_VERSION</span><span class="s2">&amp;ns=portworx&amp;b=true&amp;iop=6&amp;r=17001&amp;c=px-cluster-d7b5a3e7-93c6-4fb5-9bed-3623c2df15c5&amp;osft=true&amp;stork=true&amp;csi=true&amp;tel=true&amp;st=k8s&quot;</span>

<span class="c1"># Apply the spec</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>px-spec.yaml
</code></pre></div>
<h2 id="kube-portworkx-deployment-architecture">Deployment Architecture<a class="headerlink" href="#kube-portworkx-deployment-architecture" title="Permanent link">&para;</a></h2>
<p><img alt="Kroki" src="https://kroki.io/plantuml/svg/eNp1krFOAzEMhvc8hbm9CyMDalUqBlCpWsSCOrg5U06XxCH2CSrEu5O79kRPPTJkyOff_ixlKopJG-_MVUlvVSBYL-bPs-X94wKsQxFjpK5CxIQeLPvIgYJu9OAIElnFsHd0VuI5sH1P7Ak0NWSMddyUUKwfFtcwd40opQK-DeQT0da4JyjqZkcTOWTme9ae12OoHyrbjvyYYThy0k9OX4Pk6vQIT5ESKqftCLtDyrob0jO4ybVt25PqHylRcYeSB_YlK2ZXjCrNYnSVRa04wBI9SSY09HuZD4zKfrfcakQeJpPbSze4AY8hv4i5ZF1iZNUcshw0sRMzygej2h0Hc1rVU-92he7-1y7RR0OiAnJkZkqhbP_aL_zZyD0=?"></p>
<h2 id="kube-portworkx-manifest-components">Manifest Components<a class="headerlink" href="#kube-portworkx-manifest-components" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Component</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>portworx-operator</td>
<td>Deployment</td>
<td>Manages the Portworx cluster lifecycle</td>
</tr>
<tr>
<td>portworx</td>
<td>DaemonSet</td>
<td>Runs Portworx storage on each node</td>
</tr>
<tr>
<td>px-cluster</td>
<td>StorageCluster</td>
<td>Defines the Portworx storage cluster configuration</td>
</tr>
<tr>
<td>stork</td>
<td>Deployment</td>
<td>Storage orchestration for Kubernetes</td>
</tr>
<tr>
<td>stork-scheduler</td>
<td>Deployment</td>
<td>Custom scheduler for Portworx volumes</td>
</tr>
<tr>
<td>px-api</td>
<td>Service</td>
<td>Exposes Portworx API</td>
</tr>
<tr>
<td>portworx-service</td>
<td>Service</td>
<td>Internal communication service</td>
</tr>
</tbody>
</table>
<h2 id="kube-portworkx-available-storageclasses">Available StorageClasses<a class="headerlink" href="#kube-portworkx-available-storageclasses" title="Permanent link">&para;</a></h2>
<p>Portworx creates several StorageClasses by default:</p>
<table>
<thead>
<tr>
<th>StorageClass</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>px-replicated</td>
<td>Replication factor of 3 for high availability</td>
</tr>
<tr>
<td>px-secure-sc</td>
<td>Encrypted volumes with replication</td>
</tr>
<tr>
<td>px-db-sc</td>
<td>Optimized for database workloads</td>
</tr>
<tr>
<td>px-shared-sc</td>
<td>ReadWriteMany volumes for shared access</td>
</tr>
</tbody>
</table>
<h3 id="kube-portworkx-sample-pvc-definitions">Sample PVC Definitions<a class="headerlink" href="#kube-portworkx-sample-pvc-definitions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># High Availability PVC</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">px-ha-pvc</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">px-replicated</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<span class="nn">---</span>
<span class="c1"># Encrypted Volume PVC</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">px-secure-pvc</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">px-secure-sc</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
<span class="nn">---</span>
<span class="c1"># Shared Volume PVC</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">px-shared-pvc</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">px-shared-sc</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50Gi</span>
</code></pre></div>
<h2 id="kube-portworkx-verification">Verification<a class="headerlink" href="#kube-portworkx-verification" title="Permanent link">&para;</a></h2>
<p>To verify the Portworx installation:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check Portworx pods</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>portworx

<span class="c1"># Verify StorageClasses</span>
kubectl<span class="w"> </span>get<span class="w"> </span>sc

<span class="c1"># Check Portworx status</span>
<span class="nv">PX_POD</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-l<span class="w"> </span><span class="nv">name</span><span class="o">=</span>portworx<span class="w"> </span>-n<span class="w"> </span>portworx<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[0].metadata.name}&#39;</span><span class="k">)</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>portworx<span class="w"> </span><span class="nv">$PX_POD</span><span class="w"> </span>--<span class="w"> </span>/opt/pwx/bin/pxctl<span class="w"> </span>status
</code></pre></div></section><section class="print-page" id="kube-airflow"><h1 id="kube-airflow-apache-airflow-on-rke2">Apache Airflow on RKE2<a class="headerlink" href="#kube-airflow-apache-airflow-on-rke2" title="Permanent link">&para;</a></h1>
<p>This guide provides instructions for deploying Apache Airflow on RKE2 Kubernetes cluster.</p>
<h2 id="kube-airflow-architecture-overview">Architecture Overview<a class="headerlink" href="#kube-airflow-architecture-overview" title="Permanent link">&para;</a></h2>
<h3 id="kube-airflow-celery-executor-architecture-method-1">Celery Executor Architecture (Method 1)<a class="headerlink" href="#kube-airflow-celery-executor-architecture-method-1" title="Permanent link">&para;</a></h3>
<p><img alt="Kroki" src="https://kroki.io/plantuml/svg/eNqNUs1uwjAMvucpvHJG2nHiMLFCd2GDQjdxThvTVW2Tyk7GYeLd1y5A6aFo8SGyvx_bUeZsJVlXV-JB4aHQCKvPMNqto48ogcnrYxdXKN4sYRI9dSEEl4VuJMkaMlM3RqO28COgPaHMypyM02phKkM3jh42pJA8FFYtV5yEaNpb5gjByqVIGi0yLCrHFik42_ZtgpeCDpU5wlrWyK0UL5wR3h5TRvpGgtioACTDsa9slvekSfaFylU3Uu4r96V7Q6XXse_5l_NApqSVqeR28diwzQmT7du1U-NLY4odqoKvZPLZmXnqHrVfcjp97t1m8I5Wdj6i32WMcRn6fw5-iBlsHTocaIfIHLXqPt0vT5TMOQ==?"></p>
<h2 id="kube-airflow-installation">Installation<a class="headerlink" href="#kube-airflow-installation" title="Permanent link">&para;</a></h2>
<p>There are two methods to install Airflow on RKE2: using Helm with Celery executor (recommended for production) or using Kubernetes manifests with Kubernetes executor (simpler setup).</p>
<h3 id="kube-airflow-method-1-helm-installation-with-celery-executor">Method 1: Helm Installation with Celery Executor<a class="headerlink" href="#kube-airflow-method-1-helm-installation-with-celery-executor" title="Permanent link">&para;</a></h3>
<p>This method is recommended for production environments as it provides better scalability and worker management.</p>
<p>First, create the necessary PersistentVolumes. These must be created before installing Helm chart as they need to exist for the PVCs to bind successfully:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create airflow-pv.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-airflow-postgresql-0</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
<span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local-path</span>
<span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/local-path-provisioner/airflow-postgres</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DirectoryOrCreate</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-dags</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
<span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local-path</span>
<span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/local-path-provisioner/airflow-dags</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DirectoryOrCreate</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-logs</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
<span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local-path</span>
<span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/local-path-provisioner/airflow-logs</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DirectoryOrCreate</span>
</code></pre></div>
<p>Apply the PV configuration:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create the PVs</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>airflow-pv.yaml

<span class="c1"># Create namespace for Airflow</span>
kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>airflow

<span class="c1"># Add the official Apache Airflow Helm repository</span>
helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>apache-airflow<span class="w"> </span>https://airflow.apache.org
helm<span class="w"> </span>repo<span class="w"> </span>update

<span class="c1"># Install Airflow using Helm with storage configuration</span>
helm<span class="w"> </span>install<span class="w"> </span>airflow<span class="w"> </span>apache-airflow/airflow<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--namespace<span class="w"> </span>airflow<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span><span class="nv">executor</span><span class="o">=</span>CeleryExecutor<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>postgresql.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>redis.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>webserver.defaultUser.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>webserver.defaultUser.username<span class="o">=</span>admin<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>webserver.defaultUser.password<span class="o">=</span>admin<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>webserver.defaultUser.email<span class="o">=</span>admin@example.com<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>dags.persistence.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>dags.persistence.storageClassName<span class="o">=</span>local-path<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>dags.persistence.size<span class="o">=</span>1Gi<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>logs.persistence.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>logs.persistence.storageClassName<span class="o">=</span>local-path<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>logs.persistence.size<span class="o">=</span>1Gi<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>postgresql.persistence.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>postgresql.persistence.storageClassName<span class="o">=</span>local-path<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>postgresql.persistence.size<span class="o">=</span>10Gi
</code></pre></div>
<p>Note: The PV names must match exactly what the Helm chart expects:
- <code>data-airflow-postgresql-0</code> for PostgreSQL data
- <code>airflow-dags</code> for DAGs storage
- <code>airflow-logs</code> for logs storage</p>
<h3 id="kube-airflow-method-2-manifest-installation-with-kubernetes-executor">Method 2: Manifest Installation with Kubernetes Executor<a class="headerlink" href="#kube-airflow-method-2-manifest-installation-with-kubernetes-executor" title="Permanent link">&para;</a></h3>
<p>This method uses native Kubernetes resources and the Kubernetes executor, which is simpler to set up and maintain for smaller deployments.</p>
<h4 id="kube-airflow-architecture">Architecture<a class="headerlink" href="#kube-airflow-architecture" title="Permanent link">&para;</a></h4>
<p><img alt="Kroki" src="https://kroki.io/plantuml/svg/eNqFVU1T2zAQvftXbM2lHKCFQyf0wECIYRjaNE0oXLgo1ibxRJY8kmzKdPjvXUn-ImNCMhNH6_f24_ltcmEs07bMRfSJ4yqTCHd_xsl8mtwnCzi4_ure7a3ZrwkcJCP37mIPcHA5mYySb23odnozTxZEPxtdj89GUWS2mSyYZjmkKi-URGnhXwT0GrN0u9aqlPxKCaV7xcNtpTnqcGssCBu9RlFBV7ZGiO_KJWqJFg1cidJY1HGdtisT38q1RkMIJa1WQjgQM5DV4abXwHuHOy8FPj3Jz19YpldCPR_6FJqinkU9uUvb12VAwZTlaCiK8XD6BveIS4O6Qg0zxX3q5y5CknfknQQdcUGXzBWqyVXacl73lV6kG-Q0R1fadJF9pXvaJ38xLa0KumJ9GCjPmWVLZkigmTKWlF38_tGWLULI7K_aI_YnLtYmnHpVh6aevEiWZyk8Kr0NI5ugmD9_UPuema2jwInnWDqefIg9bbGnH2KnLVYOzdGTj3rNyO7EXpDU5LmgQmXcNr4dYFD0ByXK_I2jjxr9D988jaJ6J9nk8sYMpeFsXadw33r013pTaKBm9Y6OzsMOuQ9_Cs6F7xDPVWkRmrRxVN9pQN70UbclLt6awPF_omWu2zjq_LwH1LgWjo_PWzcQ4kojI4tT_Tq2J0frYI9pBXSg5intdBwk8uMi4-A03e13ENJvZhAQSUXq6Wy9saBWzUD0BAa2FnhYCibEC6RhXkIGDs3BDawIhSzdeG_WG54peUwwt0LANAIWG8xRMwFMctCYqwo5sBX9KBPME53nBQYmEsg1udsqedhl7QxeeY-RI7WqMo7AS82W_nfXBFF9d60xXXHSAFaZ8GOwVCuyGg3nR-nqXtA396_3H-3mMlQ=?"></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create namespace</span>
kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>airflow
</code></pre></div>
<p>First, create the storage resources:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># PostgreSQL PV and PVC</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-postgres-pv</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
<span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local-path</span>
<span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/local-path-provisioner/airflow-postgres</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DirectoryOrCreate</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-postgres-pvc</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local-path</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<span class="nn">---</span>
<span class="c1"># DAGs PV and PVC</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-dags-pv</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
<span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local-path</span>
<span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/local-path-provisioner/airflow-dags</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DirectoryOrCreate</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-dags-pvc</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local-path</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</code></pre></div>
<p>Create the ConfigMap for Airflow configuration:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-config</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">AIRFLOW__CORE__EXECUTOR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KubernetesExecutor</span>
<span class="w">  </span><span class="nt">AIRFLOW__CORE__SQL_ALCHEMY_CONN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql+psycopg2://airflow:airflow@airflow-postgres:5432/airflow</span>
<span class="w">  </span><span class="nt">AIRFLOW__CORE__LOAD_EXAMPLES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span>
<span class="w">  </span><span class="nt">AIRFLOW__KUBERNETES__NAMESPACE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="w">  </span><span class="nt">AIRFLOW__KUBERNETES__WORKER_CONTAINER_REPOSITORY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache/airflow</span>
<span class="w">  </span><span class="nt">AIRFLOW__KUBERNETES__WORKER_CONTAINER_TAG</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.7.1</span>
<span class="w">  </span><span class="nt">AIRFLOW__KUBERNETES__DELETE_WORKER_PODS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
</code></pre></div>
<p>Create the PostgreSQL deployment:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-postgres</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-postgres</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-postgres</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_USER</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_PASSWORD</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_DB</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-data</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/data</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-data</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-postgres-pvc</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-postgres</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-postgres</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</code></pre></div>
<p>Create the Airflow webserver and scheduler deployments:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-webserver</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-webserver</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-webserver</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webserver</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache/airflow:2.7.1</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;airflow&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;webserver&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">          </span><span class="nt">envFrom</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">configMapRef</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-config</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dags</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/airflow/dags</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dags</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-dags-pvc</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-scheduler</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-scheduler</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-scheduler</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scheduler</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache/airflow:2.7.1</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;airflow&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;scheduler&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">envFrom</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">configMapRef</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-config</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dags</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/airflow/dags</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dags</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-dags-pvc</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-webserver</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-webserver</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div>
<p>Initialize the database and create admin user:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create initialization job</span>
kubectl<span class="w"> </span>create<span class="w"> </span>job<span class="w"> </span>--namespace<span class="w"> </span>airflow<span class="w"> </span>airflow-init-db<span class="w"> </span>--from<span class="o">=</span>deployment/airflow-scheduler<span class="w"> </span>--<span class="w"> </span>airflow<span class="w"> </span>db<span class="w"> </span>init

<span class="c1"># Create admin user</span>
kubectl<span class="w"> </span>create<span class="w"> </span>job<span class="w"> </span>--namespace<span class="w"> </span>airflow<span class="w"> </span>airflow-create-user<span class="w"> </span>--from<span class="o">=</span>deployment/airflow-scheduler<span class="w"> </span>--<span class="w"> </span>airflow<span class="w"> </span>users<span class="w"> </span>create<span class="w"> </span>--username<span class="w"> </span>admin<span class="w"> </span>--password<span class="w"> </span>admin<span class="w"> </span>--firstname<span class="w"> </span>admin<span class="w"> </span>--lastname<span class="w"> </span>admin<span class="w"> </span>--role<span class="w"> </span>Admin<span class="w"> </span>--email<span class="w"> </span>admin@example.com
</code></pre></div>
<p>All the above manifests are combined in a single file for easier deployment. You can find it at <code>airflow-manifest.yaml</code>. To deploy:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create the namespace</span>
kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>airflow

<span class="c1"># Apply the combined manifest</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>airflow-manifest.yaml
</code></pre></div>
<p>The manifest includes all necessary resources:
- Persistent Volumes and Claims for storage
- ConfigMap for Airflow configuration
- PostgreSQL deployment and service
- Airflow webserver and scheduler deployments
- Ingress configuration</p>
<h2 id="kube-airflow-configuration">Configuration<a class="headerlink" href="#kube-airflow-configuration" title="Permanent link">&para;</a></h2>
<h3 id="kube-airflow-environment-variables-and-configmaps">Environment Variables and ConfigMaps<a class="headerlink" href="#kube-airflow-environment-variables-and-configmaps" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>AIRFLOW__CORE__EXECUTOR</td>
<td>The executor class to use</td>
<td>CeleryExecutor</td>
</tr>
<tr>
<td>AIRFLOW__CORE__SQL_ALCHEMY_CONN</td>
<td>Database connection string</td>
<td>postgresql+psycopg2://airflow:airflow@postgresql:5432/airflow</td>
</tr>
<tr>
<td>AIRFLOW__CELERY__BROKER_URL</td>
<td>Redis connection for Celery</td>
<td>redis://:@redis:6379/0</td>
</tr>
<tr>
<td>AIRFLOW__CELERY__RESULT_BACKEND</td>
<td>Celery result backend</td>
<td>db+postgresql://airflow:airflow@postgresql:5432/airflow</td>
</tr>
<tr>
<td>AIRFLOW__WEBSERVER__SECRET_KEY</td>
<td>Secret key for the web interface</td>
<td>YOUR_SECRET_KEY_HERE</td>
</tr>
<tr>
<td>AIRFLOW__WEBSERVER__BASE_URL</td>
<td>The base URL of the web interface</td>
<td>http://localhost:8080</td>
</tr>
<tr>
<td>AIRFLOW__CORE__LOAD_EXAMPLES</td>
<td>Whether to load example DAGs</td>
<td>false</td>
</tr>
<tr>
<td>AIRFLOW__CORE__DAGS_FOLDER</td>
<td>Location of DAG files</td>
<td>/opt/airflow/dags</td>
</tr>
</tbody>
</table>
<h2 id="kube-airflow-accessing-the-web-interface">Accessing the Web Interface<a class="headerlink" href="#kube-airflow-accessing-the-web-interface" title="Permanent link">&para;</a></h2>
<h3 id="kube-airflow-setting-up-ingress">Setting up Ingress<a class="headerlink" href="#kube-airflow-setting-up-ingress" title="Permanent link">&para;</a></h3>
<p>Create an ingress resource to expose the Airflow webserver:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-ingress</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/ssl-redirect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/use-regex</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/rewrite-target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/$2</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow.example.com</span><span class="w">  </span><span class="c1"># Replace with your domain</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/airflow(/|$)(.*)</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">airflow-webserver</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div>
<p>The ingress configuration is included in the combined manifest. After applying the manifest and once the ingress controller is properly configured, you can access the Airflow web interface at <code>http://airflow.example.com/airflow</code>. Login with the default credentials:
- Username: admin
- Password: admin</p>
<h2 id="kube-airflow-verification">Verification<a class="headerlink" href="#kube-airflow-verification" title="Permanent link">&para;</a></h2>
<p>To verify the installation:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check all pods are running</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>airflow

<span class="c1"># Check services</span>
kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>-n<span class="w"> </span>airflow

<span class="c1"># Check persistent volumes</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pvc<span class="w"> </span>-n<span class="w"> </span>airflow
</code></pre></div>
<h2 id="kube-airflow-uninstallation">Uninstallation<a class="headerlink" href="#kube-airflow-uninstallation" title="Permanent link">&para;</a></h2>
<h3 id="kube-airflow-method-1-uninstalling-helm-based-installation">Method 1: Uninstalling Helm-based Installation<a class="headerlink" href="#kube-airflow-method-1-uninstalling-helm-based-installation" title="Permanent link">&para;</a></h3>
<p>To remove the Helm-based Airflow installation:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Delete the Helm release</span>
helm<span class="w"> </span>uninstall<span class="w"> </span>airflow<span class="w"> </span>-n<span class="w"> </span>airflow

<span class="c1"># Delete the namespace and all its resources</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>namespace<span class="w"> </span>airflow

<span class="c1"># Delete the PersistentVolumes</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>pv<span class="w"> </span>data-airflow-postgresql-0
kubectl<span class="w"> </span>delete<span class="w"> </span>pv<span class="w"> </span>airflow-dags
kubectl<span class="w"> </span>delete<span class="w"> </span>pv<span class="w"> </span>airflow-logs

<span class="c1"># Optional: Remove the Helm repository</span>
helm<span class="w"> </span>repo<span class="w"> </span>remove<span class="w"> </span>apache-airflow

<span class="c1"># Optional: Clean up the local storage directories</span>
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/opt/local-path-provisioner/airflow-postgres
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/opt/local-path-provisioner/airflow-dags
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/opt/local-path-provisioner/airflow-logs
</code></pre></div>
<h3 id="kube-airflow-method-2-uninstalling-manifest-based-installation">Method 2: Uninstalling Manifest-based Installation<a class="headerlink" href="#kube-airflow-method-2-uninstalling-manifest-based-installation" title="Permanent link">&para;</a></h3>
<p>To remove the manifest-based Airflow installation:</p>
<p>```bash</p>
<h1 id="kube-airflow-delete-all-airflow-resources-using-the-combined-manifest">Delete all Airflow resources using the combined manifest<a class="headerlink" href="#kube-airflow-delete-all-airflow-resources-using-the-combined-manifest" title="Permanent link">&para;</a></h1>
<p>kubectl delete -f airflow-manifest.yaml</p>
<h1 id="kube-airflow-alternative-delete-the-namespace-this-will-delete-all-resources-in-the-namespace">Alternative: Delete the namespace (this will delete all resources in the namespace)<a class="headerlink" href="#kube-airflow-alternative-delete-the-namespace-this-will-delete-all-resources-in-the-namespace" title="Permanent link">&para;</a></h1>
<p>kubectl delete namespace airflow</p>
<h1 id="kube-airflow-optional-clean-up-the-local-storage-directories">Optional: Clean up the local storage directories<a class="headerlink" href="#kube-airflow-optional-clean-up-the-local-storage-directories" title="Permanent link">&para;</a></h1>
<p>sudo rm -rf /opt/local-path-provisioner/airflow-postgres
sudo rm -rf /opt/local-path-provisioner/airflow-dags</p></section><h1 class='nav-section-title-end'>Ended: Infrastructure</h1>
                        <h1 class='nav-section-title' id='section-monitoring'>
                            Monitoring <a class='headerlink' href='#section-monitoring' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="kube-loki"><h1 id="kube-loki-installing-grafana-loki-on-rke2">Installing Grafana Loki on RKE2<a class="headerlink" href="#kube-loki-installing-grafana-loki-on-rke2" title="Permanent link">&para;</a></h1>
<p>This guide provides step-by-step instructions for installing Grafana Loki on an RKE2 cluster with existing Prometheus and Rancher installations.</p>
<h2 id="kube-loki-prerequisites">Prerequisites<a class="headerlink" href="#kube-loki-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>RKE2 cluster up and running</li>
<li>Helm v3.x installed</li>
<li>kubectl configured to access your cluster</li>
<li>Prometheus installed</li>
<li>Rancher installed</li>
<li>Grafana installed (typically comes with Rancher monitoring)</li>
</ul>
<h2 id="kube-loki-installation-steps">Installation Steps<a class="headerlink" href="#kube-loki-installation-steps" title="Permanent link">&para;</a></h2>
<h3 id="kube-loki-1-add-grafana-helm-repository">1. Add Grafana Helm Repository<a class="headerlink" href="#kube-loki-1-add-grafana-helm-repository" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>grafana<span class="w"> </span>https://grafana.github.io/helm-charts
helm<span class="w"> </span>repo<span class="w"> </span>update
</code></pre></div>
<h3 id="kube-loki-2-create-custom-values-file">2. Create Custom Values File<a class="headerlink" href="#kube-loki-2-create-custom-values-file" title="Permanent link">&para;</a></h3>
<p>Create a file named <code>loki-values.yaml</code> with the following content:</p>
<div class="highlight"><pre><span></span><code><span class="nt">loki</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auth_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">commonConfig</span><span class="p">:</span>
<span class="w">    </span><span class="nt">replication_factor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">storage</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filesystem</span>

<span class="nt">monitoring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selfMonitoring</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">grafanaAgent</span><span class="p">:</span>
<span class="w">      </span><span class="nt">installOperator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="nt">lokiCanary</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="nt">scrape_configs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-pods</span>
<span class="w">    </span><span class="nt">kubernetes_sd_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod</span>
<span class="w">    </span><span class="nt">relabel_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">labelmap</span>
<span class="w">        </span><span class="nt">regex</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__meta_kubernetes_pod_label_(.+)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__meta_kubernetes_namespace</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replace</span>
<span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namespace</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__meta_kubernetes_pod_name</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replace</span>
<span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__meta_kubernetes_container_name</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replace</span>
<span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-nodes</span>
<span class="w">    </span><span class="nt">kubernetes_sd_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node</span>
<span class="w">    </span><span class="nt">relabel_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">labelmap</span>
<span class="w">        </span><span class="nt">regex</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__meta_kubernetes_node_label_(.+)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__meta_kubernetes_node_name</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replace</span>
<span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-system-containers</span>
<span class="w">    </span><span class="nt">kubernetes_sd_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod</span>
<span class="w">        </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">names</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;kube-system&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">relabel_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">labelmap</span>
<span class="w">        </span><span class="nt">regex</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__meta_kubernetes_pod_label_(.+)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__meta_kubernetes_namespace</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replace</span>
<span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namespace</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__meta_kubernetes_pod_name</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replace</span>
<span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod</span>
</code></pre></div>
<h3 id="kube-loki-3-install-loki-using-helm">3. Install Loki Using Helm<a class="headerlink" href="#kube-loki-3-install-loki-using-helm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create namespace for Loki</span>
kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>loki-stack

<span class="c1"># Install Loki using Helm with custom values</span>
helm<span class="w"> </span>install<span class="w"> </span>loki<span class="w"> </span>grafana/loki-stack<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>loki-stack<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--values<span class="w"> </span>loki-values.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>grafana.enabled<span class="o">=</span><span class="nb">false</span>
</code></pre></div>
<h3 id="kube-loki-4-configure-grafana-data-source">4. Configure Grafana Data Source<a class="headerlink" href="#kube-loki-4-configure-grafana-data-source" title="Permanent link">&para;</a></h3>
<ol>
<li>Access your Grafana instance through Rancher UI</li>
<li>Go to Configuration &gt; Data Sources</li>
<li>Click "Add data source"</li>
<li>Select "Loki"</li>
<li>Set the URL to: <code>http://loki.loki-stack.svc.cluster.local:3100</code></li>
<li>Click "Save &amp; Test"</li>
</ol>
<h3 id="kube-loki-5-verify-installation">5. Verify Installation<a class="headerlink" href="#kube-loki-5-verify-installation" title="Permanent link">&para;</a></h3>
<p>Check if all pods are running:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>loki-stack
</code></pre></div>
<p>Verify Loki is collecting logs:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Get one of the Loki pod names</span>
<span class="nv">LOKI_POD</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>loki-stack<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>loki<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.items[0].metadata.name}&quot;</span><span class="k">)</span>

<span class="c1"># Check Loki logs</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>loki-stack<span class="w"> </span><span class="nv">$LOKI_POD</span>
</code></pre></div>
<h3 id="kube-loki-6-using-loki-in-grafana">6. Using Loki in Grafana<a class="headerlink" href="#kube-loki-6-using-loki-in-grafana" title="Permanent link">&para;</a></h3>
<ol>
<li>In Grafana, go to "Explore"</li>
<li>Select "Loki" as the data source</li>
<li>Try a simple LogQL query:
   <div class="highlight"><pre><span></span><code>{namespace=&quot;kube-system&quot;}
</code></pre></div></li>
</ol>
<h2 id="kube-loki-troubleshooting">Troubleshooting<a class="headerlink" href="#kube-loki-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="kube-loki-common-issues">Common Issues<a class="headerlink" href="#kube-loki-common-issues" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>If pods are not starting:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>loki-stack<span class="w"> </span>&lt;pod-name&gt;
</code></pre></div></p>
</li>
<li>
<p>If logs are not appearing:</p>
</li>
<li>
<p>Verify Promtail configuration:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>configmap<span class="w"> </span>-n<span class="w"> </span>loki-stack
kubectl<span class="w"> </span>describe<span class="w"> </span>configmap<span class="w"> </span>-n<span class="w"> </span>loki-stack<span class="w"> </span>loki-promtail
</code></pre></div></p>
</li>
<li>
<p>If Grafana can't connect to Loki:</p>
</li>
<li>Verify the Loki service is running:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>loki-stack
</code></pre></div></li>
<li>Check Loki is accessible within the cluster:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>run<span class="w"> </span>curl<span class="w"> </span>--image<span class="o">=</span>curlimages/curl<span class="w"> </span>-i<span class="w"> </span>--tty<span class="w"> </span>--rm<span class="w"> </span>--<span class="w"> </span>curl<span class="w"> </span>http://loki.loki-stack.svc.cluster.local:3100/ready
</code></pre></div></li>
</ol>
<h2 id="kube-loki-best-practices">Best Practices<a class="headerlink" href="#kube-loki-best-practices" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Resource Limits</strong>: Adjust resource limits based on your cluster size and log volume</li>
<li><strong>Retention</strong>: Configure log retention period based on your requirements</li>
<li><strong>Monitoring</strong>: Set up alerts for Loki component health</li>
<li><strong>Backup</strong>: Regularly backup Loki storage if using persistent storage</li>
</ol>
<h2 id="kube-loki-additional-configuration">Additional Configuration<a class="headerlink" href="#kube-loki-additional-configuration" title="Permanent link">&para;</a></h2>
<h3 id="kube-loki-scaling-loki">Scaling Loki<a class="headerlink" href="#kube-loki-scaling-loki" title="Permanent link">&para;</a></h3>
<p>For production environments, consider:</p>
<ol>
<li>Using object storage (S3, GCS) instead of filesystem</li>
<li>Implementing retention policies</li>
<li>Setting up proper resource limits</li>
<li>Configuring index and chunk storage separately</li>
</ol>
<p>Example production values:</p>
<div class="highlight"><pre><span></span><code><span class="nt">loki</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auth_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">storage</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s3</span>
<span class="w">    </span><span class="nt">s3</span><span class="p">:</span>
<span class="w">      </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your-s3-endpoint</span>
<span class="w">      </span><span class="nt">bucketnames</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your-bucket</span>
<span class="w">      </span><span class="nt">access_key_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your-access-key</span>
<span class="w">      </span><span class="nt">secret_access_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your-secret-key</span>
<span class="w">  </span><span class="nt">limits_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">retention_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30d</span>
<span class="w">    </span><span class="nt">ingestion_rate_mb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">ingestion_burst_size_mb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
</code></pre></div>
<p>Remember to adjust these values according to your specific requirements and infrastructure setup.</p></section><h1 class='nav-section-title-end'>Ended: Monitoring</h1>
                        <h1 class='nav-section-title' id='section-tools-references'>
                            Tools & References <a class='headerlink' href='#section-tools-references' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="kubecheat"><h1 id="kubecheat-kubectl-common-commands-cheatsheet">Kubectl Common Commands Cheatsheet<a class="headerlink" href="#kubecheat-kubectl-common-commands-cheatsheet" title="Permanent link">&para;</a></h1>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>kubectl get all -n &lt;namespace&gt;</code></td>
<td>Lists all resources in a namespace (omit -n for current namespace)</td>
<td><code>kubectl get all -n default</code></td>
</tr>
<tr>
<td><code>kubectl get services -n &lt;namespace&gt;</code></td>
<td>Lists services in a namespace (omit -n for current namespace)</td>
<td><code>kubectl get services -n kube-system</code></td>
</tr>
<tr>
<td><code>kubectl get namespaces</code></td>
<td>Lists all namespaces in the cluster</td>
<td><code>kubectl get namespaces</code></td>
</tr>
<tr>
<td><code>kubectl get pods -n &lt;namespace&gt;</code></td>
<td>Lists pods in a namespace (omit -n for current namespace)</td>
<td><code>kubectl get pods -n default</code></td>
</tr>
<tr>
<td><code>kubectl get pods -o wide</code></td>
<td>Lists pods with additional details including node name and IP</td>
<td><code>kubectl get pods -o wide</code></td>
</tr>
<tr>
<td><code>kubectl get pods --watch</code></td>
<td>Watch real-time changes to pods</td>
<td><code>kubectl get pods --watch</code></td>
</tr>
<tr>
<td><code>kubectl get ingress -n &lt;namespace&gt;</code></td>
<td>Lists ingress resources in a namespace (omit -n for current namespace)</td>
<td><code>kubectl get ingress -n default</code></td>
</tr>
<tr>
<td><code>kubectl describe pod &lt;pod-name&gt;</code></td>
<td>Shows detailed information about a specific pod</td>
<td><code>kubectl describe pod nginx-pod</code></td>
</tr>
<tr>
<td><code>kubectl describe service &lt;service-name&gt;</code></td>
<td>Shows detailed information about a specific service</td>
<td><code>kubectl describe service my-service</code></td>
</tr>
<tr>
<td><code>kubectl logs &lt;pod-name&gt;</code></td>
<td>Shows logs for a specific pod</td>
<td><code>kubectl logs nginx-pod</code></td>
</tr>
<tr>
<td><code>kubectl logs -f &lt;pod-name&gt;</code></td>
<td>Follows/streams logs for a specific pod</td>
<td><code>kubectl logs -f nginx-pod</code></td>
</tr>
<tr>
<td><code>kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt;</code></td>
<td>Shows logs for a specific container in a pod</td>
<td><code>kubectl logs nginx-pod -c nginx</code></td>
</tr>
<tr>
<td><code>kubectl exec &lt;pod-name&gt; -- env</code></td>
<td>Lists all environment variables in a pod</td>
<td><code>kubectl exec nginx-pod -- env</code></td>
</tr>
<tr>
<td><code>kubectl apply -f &lt;file&gt;</code></td>
<td>Creates/updates resources defined in a file</td>
<td><code>kubectl apply -f deployment.yaml</code></td>
</tr>
<tr>
<td><code>kubectl apply -f &lt;directory&gt;</code></td>
<td>Creates/updates resources defined in all files in a directory</td>
<td><code>kubectl apply -f ./configs</code></td>
</tr>
<tr>
<td><code>kubectl cluster-info</code></td>
<td>Displays cluster information</td>
<td><code>kubectl cluster-info</code></td>
</tr>
<tr>
<td><code>kubectl cluster-info dump</code></td>
<td>Dumps cluster state for debugging</td>
<td><code>kubectl cluster-info dump</code></td>
</tr>
<tr>
<td><code>kubectl rollout restart deployment &lt;deployment-name&gt;</code></td>
<td>Restarts all pods in a deployment</td>
<td><code>kubectl rollout restart deployment nginx-deployment</code></td>
</tr>
<tr>
<td><code>kubectl rollout status deployment &lt;deployment-name&gt;</code></td>
<td>Shows the status of a deployment rollout</td>
<td><code>kubectl rollout status deployment nginx-deployment</code></td>
</tr>
<tr>
<td><code>kubectl delete pod &lt;pod-name&gt; -n &lt;namespace&gt;</code></td>
<td>Deletes a pod in a namespace (omit -n for current namespace)</td>
<td><code>kubectl delete pod nginx-pod -n default</code></td>
</tr>
<tr>
<td><code>kubectl delete deployment &lt;deployment-name&gt;</code></td>
<td>Deletes a deployment and its pods</td>
<td><code>kubectl delete deployment nginx-deployment</code></td>
</tr>
<tr>
<td><code>kubectl delete service &lt;service-name&gt;</code></td>
<td>Deletes a service</td>
<td><code>kubectl delete service my-service</code></td>
</tr>
<tr>
<td><code>kubectl delete -f &lt;file&gt;</code></td>
<td>Deletes resources defined in a file</td>
<td><code>kubectl delete -f deployment.yaml</code></td>
</tr>
<tr>
<td><code>kubectl delete -l key=value</code></td>
<td>Deletes resources matching a label</td>
<td><code>kubectl delete pods -l app=nginx</code></td>
</tr>
<tr>
<td><code>kubectl delete all --all -n &lt;namespace&gt;</code></td>
<td>Deletes all resources in a namespace</td>
<td><code>kubectl delete all --all -n test-namespace</code></td>
</tr>
</tbody>
</table></section><section class="print-page" id="mkdocscheat"><h1 id="mkdocscheat-markdown-cheatsheet">Markdown cheatsheet<a class="headerlink" href="#mkdocscheat-markdown-cheatsheet" title="Permanent link">&para;</a></h1>
<table>
<thead>
<tr>
<th><strong>Feature</strong></th>
<th><strong>Markdown Syntax</strong></th>
<th><strong>Rendered Output Example</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Headers</strong></td>
<td><code># Header 1</code> <br> <code>## Header 2</code> <br> <code>### Header 3</code></td>
<td># Header 1 <br> ## Header 2 <br> ### Header 3</td>
</tr>
<tr>
<td><strong>Bold</strong></td>
<td><code>**Bold Text**</code></td>
<td><strong>Bold Text</strong></td>
</tr>
<tr>
<td><strong>Italic</strong></td>
<td><code>*Italic Text*</code></td>
<td><em>Italic Text</em></td>
</tr>
<tr>
<td><strong>Bold &amp; Italic</strong></td>
<td><code>***Bold &amp; Italic***</code></td>
<td><strong><em>Bold &amp; Italic</em></strong></td>
</tr>
<tr>
<td><strong>Blockquote</strong></td>
<td><code>&gt; Blockquote</code></td>
<td>&gt; Blockquote</td>
</tr>
<tr>
<td><strong>Lists</strong></td>
<td><code>- Item 1</code> <br> <code>- Item 2</code> <br> <code>- Sub-item 2.1</code></td>
<td>- Item 1 <br> - Item 2 <br> &nbsp;&nbsp;- Sub-item 2.1</td>
</tr>
<tr>
<td><strong>Numbered Lists</strong></td>
<td><code>1. Item 1</code> <br> <code>2. Item 2</code></td>
<td>1. Item 1 <br> 2. Item 2</td>
</tr>
<tr>
<td><strong>Code (Inline)</strong></td>
<td><code>`inline code`</code></td>
<td><code>inline code</code></td>
</tr>
<tr>
<td><strong>Code Block</strong></td>
<td><code> <code>yaml&lt;br&gt;key: value&lt;br&gt;</code></code></td>
<td><code>yaml&lt;br&gt;key: value&lt;br&gt;</code></td>
</tr>
<tr>
<td><strong>Links</strong></td>
<td><code>[Link Text](https://example.com)</code></td>
<td><a href="https://example.com">Link Text</a></td>
</tr>
<tr>
<td><strong>Images</strong></td>
<td><code>![Alt Text](https://example.com/image.png)</code></td>
<td><img alt="Alt Text" src="https://example.com/image.png" /></td>
</tr>
<tr>
<td><strong>Horizontal Rule</strong></td>
<td><code>---</code></td>
<td>---</td>
</tr>
<tr>
<td><strong>Footnotes</strong></td>
<td><code>Text with footnote[^1]</code> <br> <code>[^1]: Footnote content</code></td>
<td>Text with footnote¹ <br> ¹ Footnote content</td>
</tr>
<tr>
<td><strong>Tables</strong></td>
<td><code>| Column 1 | Column 2 |</code> <br> <code>|----------|----------|</code> <br> <code>| Data 1   | Data 2   |</code></td>
<td>See below for rendered example</td>
</tr>
<tr>
<td><strong>Task Lists</strong></td>
<td><code>- [ ] Task 1</code> <br> <code>- [x] Completed Task</code></td>
<td>- [ ] Task 1 <br> - [x] Completed Task</td>
</tr>
<tr>
<td><strong>Admonitions</strong></td>
<td><code>!!! note</code> <br> <code>This is a note.</code></td>
<td>See below for rendered example</td>
</tr>
<tr>
<td><strong>Code Tabs (Tabs)</strong></td>
<td><code>{% tabs %}</code> <br> <code>{% tab "Tab 1" %}</code> <br> <code>Content for Tab 1</code> <br> <code>{% endtab %}</code> <br> <code>{% endtabs %}</code></td>
<td>Tabs (specific to MkDocs Material configuration)</td>
</tr>
</tbody>
</table></section><section class="print-page" id="vim-commands"><h1 id="vim-commands-vim-quick-reference">Vim Quick Reference<a class="headerlink" href="#vim-commands-vim-quick-reference" title="Permanent link">&para;</a></h1>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>D</code></td>
<td>Delete from cursor to end of line</td>
</tr>
<tr>
<td><code>dd</code></td>
<td>Delete current line</td>
</tr>
<tr>
<td><code>R</code></td>
<td>Enter Replace mode (overwrite existing text)</td>
</tr>
<tr>
<td><code>:w</code></td>
<td>Save changes</td>
</tr>
<tr>
<td><code>:q</code></td>
<td>Quit (fails if unsaved changes)</td>
</tr>
<tr>
<td><code>:wq</code> or <code>ZZ</code></td>
<td>Save and quit</td>
</tr>
<tr>
<td><code>:q!</code></td>
<td>Quit without saving (force quit)</td>
</tr>
</tbody>
</table></section><section class="print-page" id="windows-disk-management"><h1 id="windows-disk-management-windows-11-usb-drive-partitioning-guide">Windows 11 USB Drive Partitioning Guide<a class="headerlink" href="#windows-disk-management-windows-11-usb-drive-partitioning-guide" title="Permanent link">&para;</a></h1>
<h2 id="windows-disk-management-quick-steps">Quick Steps<a class="headerlink" href="#windows-disk-management-quick-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Press <code>Windows + X</code> → Select "Disk Management"</li>
<li>Right-click your USB drive partitions → Delete Volume</li>
<li>Right-click unallocated space → New Simple Volume</li>
<li>Follow wizard: set size → assign letter → format (NTFS/FAT32)</li>
<li>Click Finish</li>
</ol>
<hr />
<h2 id="windows-disk-management-detailed-instructions">Detailed Instructions<a class="headerlink" href="#windows-disk-management-detailed-instructions" title="Permanent link">&para;</a></h2>
<h3 id="windows-disk-management-prerequisites">Prerequisites<a class="headerlink" href="#windows-disk-management-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>A USB drive that you want to partition</li>
<li>Windows 11 operating system</li>
<li>Administrative privileges</li>
</ul>
<h2 id="windows-disk-management-steps-to-partition-usb-drive">Steps to Partition USB Drive<a class="headerlink" href="#windows-disk-management-steps-to-partition-usb-drive" title="Permanent link">&para;</a></h2>
<h3 id="windows-disk-management-1-open-disk-management">1. Open Disk Management<a class="headerlink" href="#windows-disk-management-1-open-disk-management" title="Permanent link">&para;</a></h3>
<ol>
<li>Right-click on the Start button (Windows icon)</li>
<li>Select "Disk Management" from the menu</li>
<li>Alternatively, press <code>Windows + X</code> and select "Disk Management"</li>
<li>Or type "Create and format hard disk partitions" in the Windows search</li>
</ol>
<h3 id="windows-disk-management-2-identify-your-usb-drive">2. Identify Your USB Drive<a class="headerlink" href="#windows-disk-management-2-identify-your-usb-drive" title="Permanent link">&para;</a></h3>
<ol>
<li>Look for your USB drive in the list of drives</li>
<li>Verify it's the correct drive by checking the size</li>
<li><strong>IMPORTANT</strong>: Make sure you select the correct drive to avoid data loss</li>
</ol>
<h3 id="windows-disk-management-3-delete-existing-partitions-if-needed">3. Delete Existing Partitions (if needed)<a class="headerlink" href="#windows-disk-management-3-delete-existing-partitions-if-needed" title="Permanent link">&para;</a></h3>
<ol>
<li>Right-click on each partition of the USB drive</li>
<li>Select "Delete Volume"</li>
<li>Click "Yes" to confirm</li>
<li><strong>Warning</strong>: This will erase all data on the selected partition</li>
</ol>
<h3 id="windows-disk-management-4-create-new-partitions">4. Create New Partitions<a class="headerlink" href="#windows-disk-management-4-create-new-partitions" title="Permanent link">&para;</a></h3>
<ol>
<li>Right-click on the unallocated space</li>
<li>Select "New Simple Volume"</li>
<li>Follow the New Simple Volume Wizard:</li>
<li>Choose partition size</li>
<li>Assign a drive letter</li>
<li>Format the partition (usually NTFS or FAT32)</li>
<li>Name your volume (optional)</li>
<li>Click "Finish"</li>
</ol>
<h3 id="windows-disk-management-5-create-additional-partitions-if-desired">5. Create Additional Partitions (if desired)<a class="headerlink" href="#windows-disk-management-5-create-additional-partitions-if-desired" title="Permanent link">&para;</a></h3>
<ul>
<li>Repeat step 4 for any remaining unallocated space</li>
<li>Adjust partition sizes as needed</li>
</ul>
<h2 id="windows-disk-management-tips">Tips<a class="headerlink" href="#windows-disk-management-tips" title="Permanent link">&para;</a></h2>
<ul>
<li>FAT32 is more compatible but limited to 4GB file size</li>
<li>NTFS is Windows-native and supports larger files</li>
<li>Consider ExFAT for cross-platform compatibility with large files</li>
</ul>
<h2 id="windows-disk-management-troubleshooting">Troubleshooting<a class="headerlink" href="#windows-disk-management-troubleshooting" title="Permanent link">&para;</a></h2>
<ul>
<li>If you can't delete partitions, ensure the drive isn't in use</li>
<li>If partition creation fails, try:</li>
<li>Closing and reopening Disk Management</li>
<li>Disconnecting and reconnecting the USB drive</li>
<li>Using Command Prompt's <code>diskpart</code> utility as an alternative</li>
</ul>
<h2 id="windows-disk-management-alternative-method-using-diskpart">Alternative Method Using DiskPart<a class="headerlink" href="#windows-disk-management-alternative-method-using-diskpart" title="Permanent link">&para;</a></h2>
<p>If Disk Management doesn't work, you can use Command Prompt:</p>
<ol>
<li>Open Command Prompt as Administrator</li>
<li>Type <code>diskpart</code></li>
<li><code>list disk</code></li>
<li><code>select disk X</code> (replace X with your USB drive number)</li>
<li><code>clean</code></li>
<li><code>create partition primary</code></li>
<li><code>format fs=ntfs quick</code></li>
<li><code>assign</code></li>
</ol>
<p><strong>Warning</strong>: Be extremely careful with DiskPart commands as selecting the wrong disk can lead to data loss.</p></section><section class="print-page" id="opensuse-disk-management"><h1 id="opensuse-disk-management-opensuse-linux-usb-drive-partitioning-guide">OpenSUSE Linux USB Drive Partitioning Guide<a class="headerlink" href="#opensuse-disk-management-opensuse-linux-usb-drive-partitioning-guide" title="Permanent link">&para;</a></h1>
<h2 id="opensuse-disk-management-quick-steps">Quick Steps<a class="headerlink" href="#opensuse-disk-management-quick-steps" title="Permanent link">&para;</a></h2>
<p>Replace <code>X</code> in the commands below with your device letter (b, c, d, etc.):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># List all disks to find your USB device</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l

<span class="c1"># Unmount USB if mounted</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/dev/sdX1

<span class="c1"># Create new partition table and partition</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdX
<span class="c1"># Type these commands in fdisk:</span>
<span class="c1"># d    (delete partition)</span>
<span class="c1"># n    (new partition)</span>
<span class="c1"># p    (primary)</span>
<span class="c1"># 1    (partition number)</span>
<span class="c1"># Enter (default first sector)</span>
<span class="c1"># Enter (default last sector)</span>
<span class="c1"># w    (write changes)</span>

<span class="c1"># Format the new partition</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdX1
</code></pre></div>
<hr />
<h2 id="opensuse-disk-management-detailed-instructions">Detailed Instructions<a class="headerlink" href="#opensuse-disk-management-detailed-instructions" title="Permanent link">&para;</a></h2>
<h3 id="opensuse-disk-management-prerequisites">Prerequisites<a class="headerlink" href="#opensuse-disk-management-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>OpenSUSE Linux system</li>
<li>Root privileges (sudo access)</li>
<li>USB drive to partition</li>
</ul>
<h3 id="opensuse-disk-management-1-identify-your-usb-drive">1. Identify Your USB Drive<a class="headerlink" href="#opensuse-disk-management-1-identify-your-usb-drive" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><span class="c1"># List all disk devices</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l
</code></pre></div>
Look for your USB drive - it will typically be listed as <code>/dev/sdX</code> where X is a letter (b, c, d, etc.).
The drive can be identified by its size and manufacturer information.</p>
<p><strong>Warning</strong>: Make sure you identify the correct drive to avoid data loss!</p>
<h3 id="opensuse-disk-management-2-using-fdisk-command-line-method">2. Using fdisk (Command Line Method)<a class="headerlink" href="#opensuse-disk-management-2-using-fdisk-command-line-method" title="Permanent link">&para;</a></h3>
<h4 id="opensuse-disk-management-start-fdisk">Start fdisk<a class="headerlink" href="#opensuse-disk-management-start-fdisk" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdX<span class="w">  </span><span class="c1"># Replace X with your device letter</span>
</code></pre></div>
<h4 id="opensuse-disk-management-common-fdisk-commands">Common fdisk Commands<a class="headerlink" href="#opensuse-disk-management-common-fdisk-commands" title="Permanent link">&para;</a></h4>
<ul>
<li><code>m</code> - Show help menu</li>
<li><code>p</code> - Print partition table</li>
<li><code>d</code> - Delete a partition</li>
<li><code>n</code> - Create new partition</li>
<li><code>w</code> - Write changes to disk</li>
<li><code>q</code> - Quit without saving</li>
</ul>
<h4 id="opensuse-disk-management-step-by-step-process">Step-by-Step Process<a class="headerlink" href="#opensuse-disk-management-step-by-step-process" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Delete existing partitions:
   <div class="highlight"><pre><span></span><code>Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>d
Partition<span class="w"> </span>number<span class="w"> </span><span class="o">(</span><span class="m">1</span>-4<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>
</code></pre></div>
   Repeat for each partition</p>
</li>
<li>
<p>Create new partition:
   <div class="highlight"><pre><span></span><code>Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>n
Partition<span class="w"> </span>type:<span class="w"> </span>p<span class="w"> </span><span class="o">(</span>primary<span class="o">)</span>
Partition<span class="w"> </span>number<span class="w"> </span><span class="o">(</span><span class="m">1</span>-4<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>
First<span class="w"> </span>sector:<span class="w"> </span><span class="o">[</span>Press<span class="w"> </span>Enter<span class="w"> </span><span class="k">for</span><span class="w"> </span>default<span class="o">]</span>
Last<span class="w"> </span>sector:<span class="w"> </span><span class="o">[</span>Press<span class="w"> </span>Enter<span class="w"> </span><span class="k">for</span><span class="w"> </span>default<span class="o">]</span>
</code></pre></div></p>
</li>
<li>
<p>Write changes:
   <div class="highlight"><pre><span></span><code>Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>w
</code></pre></div></p>
</li>
</ol>
<h3 id="opensuse-disk-management-3-format-the-partition">3. Format the Partition<a class="headerlink" href="#opensuse-disk-management-3-format-the-partition" title="Permanent link">&para;</a></h3>
<h4 id="opensuse-disk-management-common-filesystem-types">Common Filesystem Types<a class="headerlink" href="#opensuse-disk-management-common-filesystem-types" title="Permanent link">&para;</a></h4>
<ul>
<li>ext4 (Linux standard):
  <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdX1
</code></pre></div></li>
<li>FAT32 (Cross-platform compatibility):
  <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>mkfs.vfat<span class="w"> </span>-F<span class="w"> </span><span class="m">32</span><span class="w"> </span>/dev/sdX1
</code></pre></div></li>
<li>NTFS (Windows compatibility):
  <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>mkfs.ntfs<span class="w"> </span>/dev/sdX1
</code></pre></div></li>
</ul>
<h3 id="opensuse-disk-management-4-using-parted-alternative-method">4. Using parted (Alternative Method)<a class="headerlink" href="#opensuse-disk-management-4-using-parted-alternative-method" title="Permanent link">&para;</a></h3>
<p>parted is another command-line tool that's more modern than fdisk:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Start parted</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX

<span class="c1"># Common parted commands</span>
<span class="o">(</span>parted<span class="o">)</span><span class="w"> </span>print<span class="w">         </span><span class="c1"># Show current partition table</span>
<span class="o">(</span>parted<span class="o">)</span><span class="w"> </span>mklabel<span class="w"> </span>gpt<span class="w">  </span><span class="c1"># Create new GPT partition table</span>
<span class="o">(</span>parted<span class="o">)</span><span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span><span class="m">0</span>%<span class="w"> </span><span class="m">100</span>%<span class="w">  </span><span class="c1"># Create partition</span>
<span class="o">(</span>parted<span class="o">)</span><span class="w"> </span>quit
</code></pre></div>
<h3 id="opensuse-disk-management-5-using-yast-gui-alternative">5. Using YaST (GUI Alternative)<a class="headerlink" href="#opensuse-disk-management-5-using-yast-gui-alternative" title="Permanent link">&para;</a></h3>
<ol>
<li>Open YaST from system menu</li>
<li>Select "Partitioner"</li>
<li>Find your USB device</li>
<li>Use the graphical interface to:</li>
<li>Delete existing partitions</li>
<li>Create new partitions</li>
<li>Format partitions</li>
<li>Apply changes</li>
</ol>
<h2 id="opensuse-disk-management-tips">Tips<a class="headerlink" href="#opensuse-disk-management-tips" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <code>lsblk</code> to see block devices and their mount points</li>
<li>Use <code>blkid</code> to see filesystem types and UUIDs</li>
<li>Always unmount drives before partitioning:
  <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>umount<span class="w"> </span>/dev/sdX1
</code></pre></div></li>
</ul>
<h2 id="opensuse-disk-management-troubleshooting">Troubleshooting<a class="headerlink" href="#opensuse-disk-management-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="opensuse-disk-management-common-issues">Common Issues<a class="headerlink" href="#opensuse-disk-management-common-issues" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Device is busy:
   <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>fuser<span class="w"> </span>-m<span class="w"> </span>/dev/sdX<span class="w">  </span><span class="c1"># Find processes using the device</span>
sudo<span class="w"> </span>umount<span class="w"> </span>-l<span class="w"> </span>/dev/sdX<span class="w">  </span><span class="c1"># Force unmount if needed</span>
</code></pre></div></p>
</li>
<li>
<p>Permission denied:</p>
</li>
<li>Ensure you're using sudo</li>
<li>Check if device is mounted</li>
<li>
<p>Verify device permissions</p>
</li>
<li>
<p>Device not showing up:
   <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w">  </span><span class="c1"># Check system messages</span>
</code></pre></div></p>
</li>
</ol>
<h3 id="opensuse-disk-management-safety-tips">Safety Tips<a class="headerlink" href="#opensuse-disk-management-safety-tips" title="Permanent link">&para;</a></h3>
<ul>
<li>Always backup important data before partitioning</li>
<li>Double-check device name before executing commands</li>
<li>Use <code>lsblk</code> or <code>fdisk -l</code> to verify changes</li>
<li>Never partition a mounted drive</li>
</ul></section><section class="print-page" id="opensuse-usb-devices"><h1 id="opensuse-usb-devices-opensuse-usb-and-storage-device-information-guide">OpenSUSE USB and Storage Device Information Guide<a class="headerlink" href="#opensuse-usb-devices-opensuse-usb-and-storage-device-information-guide" title="Permanent link">&para;</a></h1>
<p>This guide explains how to list and get detailed information about USB and storage devices on OpenSUSE Linux using various command-line tools.</p>
<h2 id="opensuse-usb-devices-prerequisites">Prerequisites<a class="headerlink" href="#opensuse-usb-devices-prerequisites" title="Permanent link">&para;</a></h2>
<p>Some tools required for device listing are not installed by default on OpenSUSE Tumbleweed. Install them using:</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Install usbutils for lsusb command</span>
sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>usbutils

<span class="c1"># Install util-linux for lsblk command</span>
sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>util-linux
</code></pre></div>
<a href="https://manpages.opensuse.org/Tumbleweed/util-linux-systemd/lsblk.8.en.html">thumbleweed manual</a></p>
<h2 id="opensuse-usb-devices-basic-device-listing">Basic Device Listing<a class="headerlink" href="#opensuse-usb-devices-basic-device-listing" title="Permanent link">&para;</a></h2>
<h3 id="opensuse-usb-devices-list-usb-devices">List USB Devices<a class="headerlink" href="#opensuse-usb-devices-list-usb-devices" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># List all USB devices</span>
lsusb

<span class="c1"># Show detailed information for all USB devices</span>
lsusb<span class="w"> </span>-v

<span class="c1"># Show USB device tree</span>
lsusb<span class="w"> </span>-t
</code></pre></div>
<h3 id="opensuse-usb-devices-list-block-devices">List Block Devices<a class="headerlink" href="#opensuse-usb-devices-list-block-devices" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># List all block devices with basic info</span>
lsblk

<span class="c1"># Show full device information including filesystem type</span>
lsblk<span class="w"> </span>-f

<span class="c1"># Show device size information</span>
lsblk<span class="w"> </span>-b

<span class="c1"># Show device topology</span>
lsblk<span class="w"> </span>-t
</code></pre></div>
<h2 id="opensuse-usb-devices-detailed-device-information">Detailed Device Information<a class="headerlink" href="#opensuse-usb-devices-detailed-device-information" title="Permanent link">&para;</a></h2>
<h3 id="opensuse-usb-devices-using-udevadm">Using udevadm<a class="headerlink" href="#opensuse-usb-devices-using-udevadm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Get detailed information about a specific device (replace sdX with your device)</span>
udevadm<span class="w"> </span>info<span class="w"> </span>--query<span class="o">=</span>all<span class="w"> </span>--name<span class="o">=</span>/dev/sdX

<span class="c1"># Monitor USB device events in real-time</span>
udevadm<span class="w"> </span>monitor<span class="w"> </span>--udev<span class="w"> </span>--property
</code></pre></div>
<h3 id="opensuse-usb-devices-using-blkid">Using blkid<a class="headerlink" href="#opensuse-usb-devices-using-blkid" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Show all block devices with UUID and filesystem type</span>
sudo<span class="w"> </span>blkid

<span class="c1"># Get information for a specific device</span>
sudo<span class="w"> </span>blkid<span class="w"> </span>/dev/sdX
</code></pre></div>
<h3 id="opensuse-usb-devices-using-dmesg">Using dmesg<a class="headerlink" href="#opensuse-usb-devices-using-dmesg" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Show recent device messages</span>
dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>usb

<span class="c1"># Watch for new USB device connections</span>
dmesg<span class="w"> </span>-w<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>usb
</code></pre></div>
<h2 id="opensuse-usb-devices-storage-device-types">Storage Device Types<a class="headerlink" href="#opensuse-usb-devices-storage-device-types" title="Permanent link">&para;</a></h2>
<h3 id="opensuse-usb-devices-identify-device-types">Identify Device Types<a class="headerlink" href="#opensuse-usb-devices-identify-device-types" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Show device types and models</span>
lsblk<span class="w"> </span>-d<span class="w"> </span>-o<span class="w"> </span>name,rota,type,tran,model

<span class="c1"># List only USB storage devices</span>
lsblk<span class="w"> </span>-S<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;usb&quot;</span>
</code></pre></div>
<p>The output columns mean:
- <code>rota</code>: 1 for rotational (HDD), 0 for non-rotational (SSD)
- <code>type</code>: disk, part (partition), rom, etc.
- <code>tran</code>: transport type (sata, usb, nvme)
- <code>model</code>: device model name</p>
<h3 id="opensuse-usb-devices-smart-status-for-storage-devices">Smart Status for Storage Devices<a class="headerlink" href="#opensuse-usb-devices-smart-status-for-storage-devices" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Install smartmontools if not installed</span>
sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>smartmontools

<span class="c1"># Get SMART information for a device</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-i<span class="w"> </span>/dev/sdX

<span class="c1"># Run SMART self-test</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-t<span class="w"> </span>short<span class="w"> </span>/dev/sdX
</code></pre></div>
<h2 id="opensuse-usb-devices-examples-with-output">Examples with Output<a class="headerlink" href="#opensuse-usb-devices-examples-with-output" title="Permanent link">&para;</a></h2>
<h3 id="opensuse-usb-devices-example-lsusb-output">Example: lsusb Output<a class="headerlink" href="#opensuse-usb-devices-example-lsusb-output" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 003: ID 0781:5567 SanDisk Corp. Cruzer Blade
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</code></pre></div>
<h3 id="opensuse-usb-devices-example-lsblk-output">Example: lsblk Output<a class="headerlink" href="#opensuse-usb-devices-example-lsblk-output" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda      8:0    0 931.5G  0 disk 
├─sda1   8:1    0   512M  0 part /boot/efi
├─sda2   8:2    0    32G  0 part [SWAP]
└─sda3   8:3    0   899G  0 part /
sdb      8:16   1    32G  0 disk
└─sdb1   8:17   1    32G  0 part /media/usb
</code></pre></div>
<h2 id="opensuse-usb-devices-tips-and-tricks">Tips and Tricks<a class="headerlink" href="#opensuse-usb-devices-tips-and-tricks" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Quick Device Identification</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Combine tools for quick overview</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== USB Devices ===&quot;</span><span class="p">;</span><span class="w"> </span>lsusb<span class="p">;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n=== Block Devices ===&quot;</span><span class="p">;</span><span class="w"> </span>lsblk<span class="w"> </span>-f
</code></pre></div></p>
</li>
<li>
<p><strong>Monitor Device Changes</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Watch for device changes in real-time</span>
watch<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>lsblk
</code></pre></div></p>
</li>
<li>
<p><strong>Find Device Serial Numbers</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Get serial numbers for USB devices</span>
lsusb<span class="w"> </span>-v<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">2</span><span class="w"> </span>-B<span class="w"> </span><span class="m">2</span><span class="w"> </span>Serial
</code></pre></div></p>
</li>
<li>
<p><strong>Check Device Speed</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Show USB device speed</span>
lsusb<span class="w"> </span>-t
</code></pre></div></p>
</li>
</ol>
<h2 id="opensuse-usb-devices-troubleshooting">Troubleshooting<a class="headerlink" href="#opensuse-usb-devices-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="opensuse-usb-devices-common-issues">Common Issues<a class="headerlink" href="#opensuse-usb-devices-common-issues" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Device Not Showing Up</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Check system messages</span>
dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail
<span class="c1"># Check USB controller status</span>
lspci<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>usb
</code></pre></div></p>
</li>
<li>
<p><strong>Permission Issues</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Check device permissions</span>
ls<span class="w"> </span>-l<span class="w"> </span>/dev/sdX
<span class="c1"># Check if you&#39;re in the disk group</span>
groups
</code></pre></div></p>
</li>
<li>
<p><strong>USB Port Problems</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Check USB host controllers</span>
lspci<span class="w"> </span>-v<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">7</span><span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;usb&quot;</span>
</code></pre></div></p>
</li>
</ol>
<h3 id="opensuse-usb-devices-safety-tips">Safety Tips<a class="headerlink" href="#opensuse-usb-devices-safety-tips" title="Permanent link">&para;</a></h3>
<ul>
<li>Always verify device names before running commands</li>
<li>Use <code>sudo</code> when required</li>
<li>Be careful with device names to avoid data loss</li>
<li>Monitor system logs if devices aren't recognized</li>
</ul></section><section class="print-page" id="wsl2-linux-mint"><h1 id="wsl2-linux-mint-installing-linux-mint-with-gui-on-wsl2-windows-11">Installing Linux Mint with GUI on WSL2 (Windows 11)<a class="headerlink" href="#wsl2-linux-mint-installing-linux-mint-with-gui-on-wsl2-windows-11" title="Permanent link">&para;</a></h1>
<p>This guide walks you through the process of installing Linux Mint with a graphical user interface (GUI) on Windows Subsystem for Linux 2 (WSL2) for Windows 11.</p>
<h2 id="wsl2-linux-mint-prerequisites">Prerequisites<a class="headerlink" href="#wsl2-linux-mint-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Windows 11 (Build 22000 or later)</li>
<li>Administrator access to your Windows system</li>
<li>At least 8GB of free disk space</li>
<li>A working internet connection</li>
</ul>
<h2 id="wsl2-linux-mint-step-1-enable-wsl2">Step 1: Enable WSL2<a class="headerlink" href="#wsl2-linux-mint-step-1-enable-wsl2" title="Permanent link">&para;</a></h2>
<ol>
<li>Open PowerShell as Administrator</li>
<li>Enable WSL and Virtual Machine Platform:
   <div class="highlight"><pre><span></span><code><span class="n">dism</span><span class="p">.</span><span class="n">exe</span> <span class="p">/</span><span class="n">online</span> <span class="p">/</span><span class="nb">enable-feature</span> <span class="p">/</span><span class="n">featurename</span><span class="p">:</span><span class="n">Microsoft-Windows-Subsystem-Linux</span> <span class="p">/</span><span class="n">all</span> <span class="p">/</span><span class="n">norestart</span>
<span class="n">dism</span><span class="p">.</span><span class="n">exe</span> <span class="p">/</span><span class="n">online</span> <span class="p">/</span><span class="nb">enable-feature</span> <span class="p">/</span><span class="n">featurename</span><span class="p">:</span><span class="n">VirtualMachinePlatform</span> <span class="p">/</span><span class="n">all</span> <span class="p">/</span><span class="n">norestart</span>
</code></pre></div></li>
<li>Restart your computer</li>
<li>Set WSL2 as the default version:
   <div class="highlight"><pre><span></span><code><span class="n">wsl</span> <span class="p">-</span><span class="n">-set-default-version</span> <span class="n">2</span>
</code></pre></div></li>
</ol>
<h2 id="wsl2-linux-mint-step-2-download-linux-mint-iso">Step 2: Download Linux Mint ISO<a class="headerlink" href="#wsl2-linux-mint-step-2-download-linux-mint-iso" title="Permanent link">&para;</a></h2>
<ol>
<li>Visit the <a href="https://linuxmint.com/download.php">Linux Mint download page</a></li>
<li>Download the latest Linux Mint Cinnamon Edition ISO</li>
<li>Create a temporary directory to store the ISO:
   <div class="highlight"><pre><span></span><code><span class="n">mkdir</span> <span class="n">C</span><span class="p">:\</span><span class="n">temp</span><span class="p">\</span><span class="n">mint</span>
</code></pre></div></li>
</ol>
<h2 id="wsl2-linux-mint-step-3-create-wsl-distro-from-iso">Step 3: Create WSL Distro from ISO<a class="headerlink" href="#wsl2-linux-mint-step-3-create-wsl-distro-from-iso" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Download the WSL Distro Creator tool:
   <div class="highlight"><pre><span></span><code><span class="n">curl</span><span class="p">.</span><span class="n">exe</span> <span class="n">-L</span> <span class="n">-o</span> <span class="n">C</span><span class="p">:\</span><span class="n">temp</span><span class="p">\</span><span class="n">mint</span><span class="p">\</span><span class="n">WSL-Distro-Creator</span><span class="p">.</span><span class="n">zip</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">sileshn</span><span class="p">/</span><span class="n">WSL-Distro-Creator</span><span class="p">/</span><span class="n">archive</span><span class="p">/</span><span class="n">refs</span><span class="p">/</span><span class="n">heads</span><span class="p">/</span><span class="n">master</span><span class="p">.</span><span class="n">zip</span>
<span class="nb">Expand-Archive</span> <span class="n">C</span><span class="p">:\</span><span class="n">temp</span><span class="p">\</span><span class="n">mint</span><span class="p">\</span><span class="n">WSL-Distro-Creator</span><span class="p">.</span><span class="n">zip</span> <span class="n">C</span><span class="p">:\</span><span class="n">temp</span><span class="p">\</span><span class="n">mint</span>
</code></pre></div></p>
</li>
<li>
<p>Create the WSL distro:
   <div class="highlight"><pre><span></span><code><span class="nb">cd </span><span class="n">C</span><span class="p">:\</span><span class="n">temp</span><span class="p">\</span><span class="n">mint</span><span class="p">\</span><span class="n">WSL-Distro-Creator-master</span>
<span class="p">.\</span><span class="n">WSL-Distro-Creator</span><span class="p">.</span><span class="n">cmd</span>
</code></pre></div></p>
</li>
<li>
<p>Follow the prompts:</p>
</li>
<li>Select the Linux Mint ISO</li>
<li>Choose a name for your distribution (e.g., "LinuxMint")</li>
<li>Select installation location</li>
</ol>
<h2 id="wsl2-linux-mint-step-4-initialize-the-wsl-instance">Step 4: Initialize the WSL Instance<a class="headerlink" href="#wsl2-linux-mint-step-4-initialize-the-wsl-instance" title="Permanent link">&para;</a></h2>
<ol>
<li>Launch your new Linux Mint distribution from the Start menu</li>
<li>Create a user account when prompted</li>
<li>Update the system:
   <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>upgrade<span class="w"> </span>-y
</code></pre></div></li>
</ol>
<h2 id="wsl2-linux-mint-step-5-install-gui-components">Step 5: Install GUI Components<a class="headerlink" href="#wsl2-linux-mint-step-5-install-gui-components" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Install X server and desktop environment:
   <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>xfce4<span class="w"> </span>xfce4-goodies
</code></pre></div></p>
</li>
<li>
<p>Install additional required packages:
   <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>dbus-x11<span class="w"> </span>x11-utils<span class="w"> </span>x11-xserver-utils
</code></pre></div></p>
</li>
</ol>
<h2 id="wsl2-linux-mint-step-6-install-x-server-on-windows">Step 6: Install X Server on Windows<a class="headerlink" href="#wsl2-linux-mint-step-6-install-x-server-on-windows" title="Permanent link">&para;</a></h2>
<ol>
<li>Download and install <a href="https://sourceforge.net/projects/vcxsrv/">VcXsrv</a></li>
<li>Launch XLaunch from the Start menu</li>
<li>Configure XLaunch:</li>
<li>Choose "Multiple windows"</li>
<li>Display number: 0</li>
<li>Start no client</li>
<li>Enable "Disable access control"</li>
<li>Save configuration for future use</li>
</ol>
<h2 id="wsl2-linux-mint-step-7-configure-gui-launch">Step 7: Configure GUI Launch<a class="headerlink" href="#wsl2-linux-mint-step-7-configure-gui-launch" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Add these lines to your <code>~/.bashrc</code>:
   <div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">DISPLAY</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>/etc/resolv.conf<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nameserver<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>:0
<span class="nb">export</span><span class="w"> </span><span class="nv">LIBGL_ALWAYS_INDIRECT</span><span class="o">=</span><span class="m">1</span>
</code></pre></div></p>
</li>
<li>
<p>Apply the changes:
   <div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>~/.bashrc
</code></pre></div></p>
</li>
</ol>
<h2 id="wsl2-linux-mint-step-8-launch-the-gui">Step 8: Launch the GUI<a class="headerlink" href="#wsl2-linux-mint-step-8-launch-the-gui" title="Permanent link">&para;</a></h2>
<ol>
<li>Start VcXsrv using your saved configuration</li>
<li>In your WSL Linux Mint terminal, start Xfce:
   <div class="highlight"><pre><span></span><code>startxfce4
</code></pre></div></li>
</ol>
<h2 id="wsl2-linux-mint-creating-a-startup-script">Creating a Startup Script<a class="headerlink" href="#wsl2-linux-mint-creating-a-startup-script" title="Permanent link">&para;</a></h2>
<p>To make launching the GUI easier, you can create a startup script:</p>
<ol>
<li>
<p>Create a new script file:
   <div class="highlight"><pre><span></span><code>nano<span class="w"> </span>~/.start-gui.sh
</code></pre></div></p>
</li>
<li>
<p>Add the following content:
   <div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check if VcXsrv is running</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>tasklist.exe<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;vcxsrv.exe&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting VcXsrv...&quot;</span>
<span class="w">    </span><span class="c1"># Replace the path below with your actual VcXsrv config file path</span>
<span class="w">    </span><span class="s2">&quot;/mnt/c/Program Files/VcXsrv/vcxsrv.exe&quot;</span><span class="w"> </span>:0<span class="w"> </span>-multiwindow<span class="w"> </span>-ac<span class="w"> </span><span class="p">&amp;</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">2</span>
<span class="k">fi</span>

<span class="c1"># Set display</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DISPLAY</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span>nameserver<span class="w"> </span>/etc/resolv.conf<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>:0.0
<span class="nb">export</span><span class="w"> </span><span class="nv">LIBGL_ALWAYS_INDIRECT</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># Start Xfce</span>
startxfce4
</code></pre></div></p>
</li>
<li>
<p>Make the script executable:
   <div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>~/.start-gui.sh
</code></pre></div></p>
</li>
<li>
<p>Create an alias for easy access (add to ~/.bashrc):
   <div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;alias startgui=&#39;~/.start-gui.sh&#39;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">source</span><span class="w"> </span>~/.bashrc
</code></pre></div></p>
</li>
</ol>
<p>Now you can start the GUI environment simply by typing:
<div class="highlight"><pre><span></span><code>startgui
</code></pre></div></p>
<p>The script will:
- Check if VcXsrv is already running
- Start VcXsrv if needed
- Set up the display environment
- Launch the Xfce desktop environment</p>
<h2 id="wsl2-linux-mint-troubleshooting">Troubleshooting<a class="headerlink" href="#wsl2-linux-mint-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="wsl2-linux-mint-display-issues">Display Issues<a class="headerlink" href="#wsl2-linux-mint-display-issues" title="Permanent link">&para;</a></h3>
<p>If you encounter display issues:
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">DISPLAY</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span>nameserver<span class="w"> </span>/etc/resolv.conf<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>:0.0
</code></pre></div></p>
<h3 id="wsl2-linux-mint-sound-issues">Sound Issues<a class="headerlink" href="#wsl2-linux-mint-sound-issues" title="Permanent link">&para;</a></h3>
<p>To enable sound:
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>pulseaudio
</code></pre></div></p>
<h3 id="wsl2-linux-mint-performance-tips">Performance Tips<a class="headerlink" href="#wsl2-linux-mint-performance-tips" title="Permanent link">&para;</a></h3>
<ul>
<li>Adjust memory usage in <code>.wslconfig</code>:
  <div class="highlight"><pre><span></span><code>[wsl2]
memory=4GB
processors=2
</code></pre></div></li>
</ul>
<h2 id="wsl2-linux-mint-additional-notes">Additional Notes<a class="headerlink" href="#wsl2-linux-mint-additional-notes" title="Permanent link">&para;</a></h2>
<ul>
<li>The GUI will need to be restarted each time you reboot Windows</li>
<li>Save any important work before closing the GUI session</li>
</ul></section><h1 class='nav-section-title-end'>Ended: Tools & References</h1>
                        <h1 class='nav-section-title' id='section-other'>
                            Other <a class='headerlink' href='#section-other' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="30-100"><h1 id="30-100-containers">Containers<a class="headerlink" href="#30-100-containers" title="Permanent link">&para;</a></h1>
<p>Containers are the building blocks for Kubernetes-based cloud native applications. If we make a comparison with OOP and Java, container images are like classes, and containers are like objects. The same way we can extend classes to reuse and alter behavior, we can have container images that extend other container images to reuse and alter behavior. The same way we can do object composition and use functionality, we can do container compositions by putting containers into a Pod and using collaborating containers.</p>
<p>If we continue the comparison, Kubernetes would be like the JVM but spread over multiple hosts, and it would be responsible for running and managing the containers. Init containers would be something like object constructors; DaemonSets would be similar to daemon threads that run in the background (like the Java Garbage Collector, for example). A Pod would be something similar to an Inversion of Control (IoC) context (Spring Framework, for example), where multiple running objects share a managed lifecycle and can access one another directly.</p>
<p>The parallel doesn't go much further, but the point is that containers play a fundamental role in Kubernetes, and creating modularized, reusable, single-purpose container images is fundamental to the long-term success of any project and even the containers' ecosystem as a whole. Apart from the technical characteristics of a container image that provide packaging and isolation, what does a container represent, and what is its purpose in the context of a distributed application? Here are a few suggestions on how to look at containers:</p>
<ul>
<li>A container image is the unit of functionality that addresses a single concern.</li>
<li>A container image is owned by one team and has its own release cycle.</li>
<li>A container image is self-contained and defines and carries its runtime dependencies.</li>
<li>A container image is immutable, and once it is built, it does not change; it is configured.</li>
<li>A container image defines its resource requirements and external dependencies.</li>
<li>A container image has well-defined APIs to expose its functionality.</li>
<li>A container typically runs as a single Unix process.</li>
<li>A container is disposable and safe to scale up or down at any moment.</li>
</ul>
<p>In addition to all these characteristics, a proper container image is modular. It is parameterized and created for reuse in the different environments in which it is going to run. Having small, modular, and reusable container images leads to the creation of more specialized and stable container images in the long term, similar to a great reusable library in the programming language world.</p>
<h1 id="30-100-pods">Pods<a class="headerlink" href="#30-100-pods" title="Permanent link">&para;</a></h1>
<p>Looking at the characteristics of containers, we can see that they are a perfect match for implementing the microservices principles. A container image provides a single unit of functionality, belongs to a single team, has an independent release cycle, and provides deployment and runtime isolation. Most of the time, one microservice corresponds to one container image.</p>
<p>However, most cloud native platforms offer another primitive for managing the lifecycle of a group of containers—in Kubernetes, it is called a Pod. A Pod is an atomic unit of scheduling, deployment, and runtime isolation for a group of containers. All containers in a Pod are always scheduled to the same host, are deployed and scaled together, and can also share filesystem, networking, and process namespaces. This joint lifecycle allows the containers in a Pod to interact with one another over the filesystem or through networking via localhost or host interprocess communication mechanisms if desired (for performance reasons, for example). A Pod also represents a security boundary for an application. While it is possible to have containers with varying security parameters in the same Pod, typically all containers would have the same access level, network segmentation, and identity.</p>
<p>As you can see in Figure 1-2, at development and build time, a microservice corresponds to a container image that one team develops and releases. But at runtime, a microservice is represented by a Pod, which is the unit of deployment, placement, and scaling. The only way to run a container—whether for scale or migration—is through the Pod abstraction. Sometimes a Pod contains more than one container. In one such example, a containerized microservice uses a helper container at runtime, as Chapter 16, "Sidecar", demonstrates.</p>
<p>Containers, Pods, and their unique characteristics offer a new set of patterns and principles for designing microservices-based applications. We saw some of the characteristics of well-designed containers; now let's look at some characteristics of a Pod:</p>
<ul>
<li>
<p>A Pod is the atomic unit of scheduling. That means the scheduler tries to find a host that satisfies the requirements of all containers that belong to the Pod (we cover some specifics around init containers in Chapter 15, "Init Container"). If you create a Pod with many containers, the scheduler needs to find a host that has enough resources to satisfy all container demands combined. This scheduling process is described in Chapter 6, "Automated Placement".</p>
</li>
<li>
<p>A Pod ensures colocation of containers. Thanks to the colocation, containers in the same Pod have additional means to interact with one another. The most common ways of communicating include using a shared local filesystem for exchanging data, using the localhost network interface, or using some host interprocess communication (IPC) mechanism for high-performance interactions.</p>
</li>
<li>
<p>A Pod has an IP address, name, and port range that are shared by all containers belonging to it. That means containers in the same Pod have to be carefully configured to avoid port clashes, in the same way that parallel, running Unix processes have to take care when sharing the networking space on a host.</p>
</li>
</ul>
<p>A Pod is the atom of Kubernetes where your application lives, but you don't access Pods directly—that is where Services enter the scene.</p>
<h1 id="30-100-services">Services<a class="headerlink" href="#30-100-services" title="Permanent link">&para;</a></h1>
<p>Pods are ephemeral. They come and go at any time for all sorts of reasons (e.g., scaling up and down, failing container health checks, node migrations). A Pod IP address is known only after it is scheduled and started on a node. A Pod can be rescheduled to a different node if the existing node it is running on is no longer healthy. This means the Pod's network address may change over the life of an application, and there is a need for another primitive for discovery and load balancing.</p>
<p>That's where the Kubernetes Services come into play. The Service is another simple but powerful Kubernetes abstraction that binds the Service name to an IP address and port number permanently. So a Service represents a named entry point for accessing an application. In the most common scenario, the Service serves as the entry point for a set of Pods, but that might not always be the case. The Service is a generic primitive, and it may also point to functionality provided outside the Kubernetes cluster. As such, the Service primitive can be used for Service discovery and load balancing, and it allows altering implementations and scaling without affecting Service consumers. We explain Services in detail in Chapter 13, "Service Discovery".</p>
<h1 id="30-100-labels">Labels<a class="headerlink" href="#30-100-labels" title="Permanent link">&para;</a></h1>
<p>We have seen that a microservice is a container image at build time but is represented by a Pod at runtime. So what is an application that consists of multiple microservices? Here, Kubernetes offers two more primitives that can help you define the concept of an application: labels and namespaces.</p>
<p>Before microservices, an application corresponded to a single deployment unit with a single versioning scheme and release cycle. There was a single file for an application in a .war, .ear, or some other packaging format. But then, applications were split into microservices, which are independently developed, released, run, restarted, or scaled. With microservices, the notion of an application diminishes, and there are no key artifacts or activities that we have to perform at the application level. But if you still need a way to indicate that some independent services belong to an application, labels can be used. Let's imagine that we have split one monolithic application into three microservices and another one into two microservices.</p>
<p>We now have five Pod definitions (and maybe many more Pod instances) that are independent of the development and runtime points of view. However, we may still need to indicate that the first three Pods represent an application and the other two Pods represent another application. Even the Pods may be independent, to provide a business value, but they may depend on one another. For example, one Pod may contain the containers responsible for the frontend, and the other two Pods are responsible for providing the backend functionality. If either of these Pods is down, the application is useless from a business point of view. Using label selectors gives us the ability to query and identify a set of Pods and manage it as one logical unit.</p>
<p>Here are a few examples where labels can be useful:</p>
<ul>
<li>
<p>Labels are used by ReplicaSets to keep some instances of a specific Pod running. That means every Pod definition needs to have a unique combination of labels used for scheduling.</p>
</li>
<li>
<p>Labels are also heavily used by the scheduler. The scheduler uses labels for colocating or spreading Pods to the nodes that satisfy the Pods' requirements.</p>
</li>
<li>
<p>A label can indicate a logical grouping of a set of Pods and give an application identity to them.</p>
</li>
<li>
<p>In addition to the preceding typical use cases, labels can be used to store metadata. It may be difficult to predict what a label could be used for, but it is best to have enough labels to describe all important aspects of the Pods. For example, having labels to indicate the logical group of an application, the business characteristics and criticality, the specific runtime platform dependencies such as hardware architecture, or location preferences are all useful.</p>
</li>
</ul>
<p>Later, these labels can be used by the scheduler for more fine-grained scheduling, or the same labels can be used from the command line for managing the matching Pods at scale. However, you should not go overboard and add too many labels in advance. You can always add them later if needed. Removing labels is much riskier as there is no straightforward way of finding out what a label is used for and what unintended effect such an action may cause.</p>
<h1 id="30-100-annotations">Annotations<a class="headerlink" href="#30-100-annotations" title="Permanent link">&para;</a></h1>
<p>Another primitive very similar to labels is the annotation. Like labels, annotations are organized as a map, but they are intended for specifying nonsearchable metadata and for machine usage rather than human.</p>
<p>The information on the annotations is not intended for querying and matching objects. Instead, it is intended for attaching additional metadata to objects from various tools and libraries we want to use. Some examples of using annotations include build IDs, release IDs, image information, timestamps, Git branch names, pull request numbers, image hashes, registry addresses, author names, tooling information, and more. So while labels are used primarily for query matching and performing actions on the matching resources, annotations are used to attach metadata that can be consumed by a machine.</p>
<h1 id="30-100-namespaces">Namespaces<a class="headerlink" href="#30-100-namespaces" title="Permanent link">&para;</a></h1>
<p>Another primitive that can also help manage a group of resources is the Kubernetes namespace. As we have described, a namespace may seem similar to a label, but in reality, it is a very different primitive with different characteristics and purposes.</p>
<p>Kubernetes namespaces allow you to divide a Kubernetes cluster (which is usually spread across multiple hosts) into a logical pool of resources. Namespaces provide scopes for Kubernetes resources and a mechanism to apply authorizations and other policies to a subsection of the cluster. The most common use case of namespaces is representing different software environments such as development, testing, integration testing, or production. Namespaces can also be used to achieve multitenancy and provide isolation for team workspaces, projects, and even specific applications. But ultimately, for a greater isolation of certain environments, namespaces are not enough, and having separate clusters is common. Typically, there is one nonproduction Kubernetes cluster used for some environments (development, testing, and integration testing) and another production Kubernetes cluster to represent performance testing and production environments.</p>
<p>Let's look at some of the characteristics of namespaces and how they can help us in different scenarios:</p>
<ul>
<li>
<p>A namespace is managed as a Kubernetes resource.</p>
</li>
<li>
<p>A namespace provides scope for resources such as containers, Pods, Services, or ReplicaSets. The names of resources need to be unique within a namespace but not across them.</p>
</li>
<li>
<p>By default, namespaces provide scope for resources, but nothing isolates those resources and prevents access from one resource to another. For example, a Pod from a development namespace can access another Pod from a production namespace as long as the Pod IP address is known. "Network isolation across namespaces for creating a lightweight multitenancy solution is described in Chapter 24, "Network Segmentation".</p>
</li>
<li>
<p>Some other resources, such as namespaces, nodes, and PersistentVolumes, do not belong to namespaces and should have unique cluster-wide names.</p>
</li>
<li>
<p>Each Kubernetes Service belongs to a namespace and gets a corresponding Domain Name Service (DNS) record that has the namespace in the form of <service-name>.<namespace-name>.svc.cluster.local. So the namespace name is in the URL of every Service belonging to the given namespace. That's one reason it is vital to name namespaces wisely.</p>
</li>
<li>
<p>ResourceQuotas provide constraints that limit the aggregated resource consumption per namespace. With ResourceQuotas, a cluster administrator can control the number of objects per type that are allowed in a namespace. For example, a developer namespace may allow only five ConfigMaps, five Secrets, five Services, five ReplicaSets, five PersistentVolumeClaims, and ten Pods.</p>
</li>
<li>
<p>ResourceQuotas can also limit the total sum of computing resources we can request in a given namespace. For example, in a cluster with a capacity of 32 GB RAM and 16 cores, it is possible to allocate 16 GB RAM and 8 cores for the production namespace, 8 GB RAM and 4 cores for the staging environment, 4 GB RAM and 2 cores for development, and the same amount for testing namespaces. The ability to impose resource constraints decoupled from the shape and the limits of the underlying infrastructure is invaluable.</p>
</li>
</ul>
<h1 id="30-100-discussion">Discussion<a class="headerlink" href="#30-100-discussion" title="Permanent link">&para;</a></h1>
<p>We've only briefly covered a few of the main Kubernetes concepts we use in this book. However, there are more primitives used by developers on a day-by-day basis. For example, if you create a containerized service, there are plenty of Kubernetes abstractions you can use to reap all the benefits of Kubernetes. Keep in mind, these are only a few of the objects used by application developers to integrate a containerized service into Kubernetes. There are plenty of other concepts used primarily by cluster administrators for managing Kubernetes.</p>
<p>With time, these new primitives give birth to new ways of solving problems, and some of these repetitive solutions become patterns. Throughout this book, rather than describing each Kubernetes resource in detail, we will focus on concepts that are proven as patterns.</p>
<h1 id="30-100-more-information">More Information<a class="headerlink" href="#30-100-more-information" title="Permanent link">&para;</a></h1>
<ul>
<li>The Twelve-Factor App</li>
<li>CNCF Cloud Native Definition v1.0</li>
<li>Hexagonal Architecture</li>
<li>Domain-Driven Design: Tackling Complexity in the Heart of Software</li>
<li>Best Practices for Writing Dockerfiles</li>
<li>Principles of Container-Based Application Design</li>
<li>General Container Image Guidelines</li>
</ul>
<h1 id="30-100-part-i-foundational-patterns">PART I: Foundational Patterns<a class="headerlink" href="#30-100-part-i-foundational-patterns" title="Permanent link">&para;</a></h1>
<p>Foundational patterns describe a number of fundamental principles that containerized applications must comply with in order to become good cloud-native citizens. Adhering to these principles will help ensure that your applications are suitable for automation in cloud-native platforms such as Kubernetes.</p>
<p>The patterns described in the following chapters represent the foundational building blocks of distributed container-based Kubernetes-native applications:</p>
<ul>
<li>Chapter 2, "Predictable Demands", explains why every container should declare its resource requirements and stay confined to the indicated resource boundaries.</li>
<li>Chapter 3, "Declarative Deployment", describes the different application deployment strategies that can be expressed in a declarative way.</li>
<li>Chapter 4, "Health Probe", dictates that every container should implement specific APIs to help the platform observe and maintain the application healthily.</li>
<li>Chapter 5, "Managed Lifecycle", explains why a container should have a way to read the events coming from the platform and conform by reacting to those events.</li>
<li>Chapter 6, "Automated Placement", introduces the Kubernetes scheduling algorithm and the ways to influence the placement decisions from the outside.</li>
</ul>
<h1 id="30-100-chapter-2-predictable-demands">Chapter 2: Predictable Demands<a class="headerlink" href="#30-100-chapter-2-predictable-demands" title="Permanent link">&para;</a></h1>
<p>The foundation of successful application deployment, management, and coexistence on a shared cloud environment is dependent on identifying and declaring the application resource requirements and runtime dependencies. This Predictable Demands pattern indicates how you should declare application requirements, whether they are hard runtime dependencies or resource requirements. Declaring your requirements is essential for Kubernetes to find the right place for your application within the cluster.</p>
<h2 id="30-100-problem">Problem<a class="headerlink" href="#30-100-problem" title="Permanent link">&para;</a></h2>
<p>Kubernetes can manage applications written in different programming languages as long as the application can be run in a container. However, different languages have different resource requirements. Typically, a compiled language runs faster and often requires less memory compared to just-in-time runtimes or interpreted languages. Considering that many modern programming languages in the same category have similar resource requirements, from a resource consumption point of view, more important aspects are the domain, the business logic of an application, and the actual implementation details.</p>
<p>Besides resource requirements, application runtimes also have dependencies on platform-managed capabilities like data storage or application configuration.</p>
<h2 id="30-100-solution">Solution<a class="headerlink" href="#30-100-solution" title="Permanent link">&para;</a></h2>
<p>Knowing the runtime requirements for a container is important mainly for two reasons. First, with all the runtime dependencies defined and resource demands envisaged, Kubernetes can make intelligent decisions about where to place a container on the cluster for the most efficient hardware utilization. In an environment with shared resources among a large number of processes with different priorities, the only way to ensure a successful coexistence is to know the demands of every process in advance.</p>
<p>Container resource profiles are also essential for capacity planning. Based on the particular service demands and the total number of services, we can do some capacity planning for different environments and come up with the most cost-effective host profiles to satisfy the entire cluster demand. Service resource profiles and capacity planning go hand in hand for successful cluster management in the long term.</p>
<h3 id="30-100-runtime-dependencies">Runtime Dependencies<a class="headerlink" href="#30-100-runtime-dependencies" title="Permanent link">&para;</a></h3>
<p>One of the most common runtime dependencies is file storage for saving application state. Container filesystems are ephemeral and are lost when a container is shut down. Kubernetes offers volume as a Pod-level storage utility that survives container restarts.</p>
<p>The most straightforward type of volume is emptyDir, which lives as long as the Pod lives. When the Pod is removed, its content is also lost. The volume needs to be backed by another kind of storage mechanism to survive Pod restarts. If your application needs to read or write files to such long-lived storage, you must declare that dependency explicitly in the container definition using volumes.</p>
<p>The scheduler evaluates the kind of volume a Pod requires, which affects where the Pod gets placed. If the Pod needs a volume that is not provided by any node on the cluster, the Pod is not scheduled at all. Volumes are an example of a runtime dependency that affects what kind of infrastructure a Pod can run and whether the Pod can be scheduled at all.</p>
<p>A similar dependency happens when you ask Kubernetes to expose a container port on a specific port on the host system through hostPort. The usage of a hostPort creates another runtime dependency on the nodes and limits where a Pod can be scheduled. hostPort reserves the port on each node in the cluster and is limited to a maximum of one Pod scheduled per node. Because of port conflicts, you can scale to as many Pods as there are nodes in the Kubernetes cluster.</p>
<p>Configurations are another type of dependency. Almost every application needs some configuration information, and the recommended solution offered by Kubernetes is through ConfigMaps. Your services need to have a strategy for consuming settings—either through environment variables or the filesystem. In either case, this introduces a runtime dependency of your container to the named ConfigMaps. If not all of the expected ConfigMaps are created, the containers are scheduled on a node, but they do not start up.</p>
<p>Similar to ConfigMaps, Secrets offer a slightly more secure way of distributing environment-specific configurations to a container. The way to consume a Secret is the same as it is for ConfigMaps, and using a Secret introduces the same kind of dependency from a container to a namespace.</p>
<p>While the creation of ConfigMap and Secret objects are simple deployment tasks we have to perform, cluster nodes provide storage and port numbers. Some of these dependencies limit where a Pod gets scheduled (if anywhere at all), and other dependencies may prevent the Pod from starting up. When designing your containerized applications with such dependencies, always consider the runtime constraints they will create later.</p>
<h3 id="30-100-resource-profiles">Resource Profiles<a class="headerlink" href="#30-100-resource-profiles" title="Permanent link">&para;</a></h3>
<p>Specifying container dependencies such as ConfigMap, Secret, and volumes is straightforward. We need some more thinking and experimentation for figuring out the resource requirements of a container. Compute resources in the context of Kubernetes are defined as something that can be requested by, allocated to, and consumed from a container. The resources are categorized as compressible (i.e., can be throttled, such as CPU or network bandwidth) and incompressible (i.e., cannot be throttled, such as memory).</p>
<p>Making the distinction between compressible and incompressible resources is important. If your containers consume too many compressible resources such as CPU, they are throttled, but if they use too many incompressible resources (such as memory), they are killed (as there is no other way to ask an application to release allocated memory).</p>
<p>Based on the nature and the implementation details of your application, you have to specify the minimum amount of resources that are needed (called requests) and the maximum amount it can grow up to (the limits). Every container definition can specify the amount of CPU and memory it needs in the form of a request and limit. At a high level, the concept of requests/limits is similar to soft/hard limits. For example, similarly, we define heap size for a Java application by using the -Xms and -Xmx command-line options.</p>
<p>The requests amount (but not limits) is used by the scheduler when placing Pods to nodes. For a given Pod, the scheduler considers only nodes that still have enough capacity to accommodate the Pod and all of its containers by summing up the requested resource amounts. In that sense, the requests field of each container affects where a Pod can be scheduled or not.</p>
<p>The following types of resources can be used as keys in the requests and limits specification:</p>
<p><strong>memory</strong>
This type is for the heap memory demands of your application, including volumes of type emptyDir with the configuration medium: Memory. Memory resources are incompressible, so containers that exceed their configured memory limit will trigger the Pod to be evicted; i.e., it gets deleted and recreated potentially on a different node.</p>
<p><strong>cpu</strong>
The cpu type is used to specify the range of needed CPU cycles for your application. However, it is a compressible resource, which means that in an overcommit situation for a node, all assigned CPU slots of all running containers are throttled relative to their specified requests. Therefore, it is highly recommended that you set requests for the CPU resource but no limits so that they can benefit from all excess CPU resources that otherwise would be wasted.</p>
<p><strong>ephemeral-storage</strong>
Every node has some filesystem space dedicated for ephemeral storage that holds logs and writable container layers. emptyDir volumes that are not stored in a memory filesystem also use ephemeral storage. With this request and limit type, you can specify the application's minimal and maximal needs. ephemeral-storage resources are not compressible and will cause a Pod to be evicted from the node if it uses more storage than specified in its limit.</p>
<p><strong>hugepage-<size></strong>
Huge pages are large, contiguous pre-allocated pages of memory that can be mounted as volumes. Depending on your Kubernetes node configuration, several sizes of huge pages are available, like 2 MB and 1 GB pages. You can specify a request and limit for how many of a certain type of huge pages you want to consume (e.g., hugepages-1Gi: 2Gi for requesting two 1 GB huge pages). Huge pages can't be overcommitted, so the request and limit must be the same.</p>
<p>Depending on whether you specify the requests, the limits, or both, the platform offers three types of Quality of Service (QoS):</p>
<p><strong>Best-Effort</strong>
Pods that do not have any requests and limits set for its containers have a QoS of Best-Effort. Such a Best-Effort Pod is considered the lowest priority and is most likely killed first when the node where the Pod is placed runs out of incompressible resources.</p>
<p><strong>Burstable</strong>
A Pod that defines an unequal amount for requests and limits values (and limits is larger than requests, as expected) are tagged as Burstable. Such a Pod has minimal resource guarantees but is also willing to consume more resources up to its limit when available. When the node is under incompressible resource pressure, these Pods are likely to be killed if no Best-Effort Pods remain.</p>
<p><strong>Guaranteed</strong>
A Pod that has an equal amount of request and limit resources belongs to the Guaranteed QoS category. These are the highest-priority Pods and are guaranteed not to be killed before Best-Effort and Burstable Pods. This QoS mode is the best option for your application's memory resources, as it entails the least surprise and avoids out-of-memory triggered evictions.</p>
<p>So the resource characteristics you define or omit for the containers have a direct impact on its QoS and define the relative importance of the Pod in the event of resource starvation. Define your Pod resource requirements with this consequence in mind.</p>
<h3 id="30-100-recommendations-for-cpu-and-memory-resources">Recommendations for CPU and Memory Resources<a class="headerlink" href="#30-100-recommendations-for-cpu-and-memory-resources" title="Permanent link">&para;</a></h3>
<p>While you have many options for declaring the memory and CPU needs of your applications, we and others recommend the following rules:</p>
<ul>
<li>For memory, always set requests equal to limits.</li>
<li>For CPU, set requests but no limits.</li>
</ul>
<p>See the blog post "For the Love of God, Stop Using CPU Limits on Kubernetes" for a more in-depth explanation of why you should not use limits for the CPU, and see the blog post "What Everyone Should Know About Kubernetes Memory Limits" for more details about the recommended memory settings.</p>
<h3 id="30-100-pod-priority">Pod Priority<a class="headerlink" href="#30-100-pod-priority" title="Permanent link">&para;</a></h3>
<p>We explained how container resource declarations also define Pods' QoS and affect the order in which the Kubelet kills the container in a Pod in case of resource starvation. Two other related concepts are Pod priority and preemption. Pod priority allows you to indicate the importance of a Pod relative to other Pods, which affects the order in which Pods are scheduled.</p>
<p>Pod priority affects the order in which the scheduler places Pods on nodes. First, the priority admission controller uses the priorityClassName field to populate the priority value for new Pods. When multiple Pods are waiting to be placed, the scheduler sorts the queue of pending Pods by highest priority first. Any pending Pod is picked before any other pending Pod with lower priority in the scheduling queue, and if there are no constraints preventing it from scheduling, the Pod gets scheduled.</p>
<p>Here comes the critical part. If there are no nodes with enough capacity to place a Pod, the scheduler can preempt (remove) lower-priority Pods from nodes to free up resources and place Pods with higher priority. As a result, the higher-priority Pod might be scheduled sooner than Pods with a lower priority if all other scheduling requirements are met. This algorithm effectively enables cluster administrators to control which Pods are more critical workloads and place them first by allowing the scheduler to evict Pods with lower priority to make room on a worker node for higher-priority Pods. If a Pod cannot be scheduled, the scheduler continues with the placement of other lower-priority Pods.</p>
<p>Suppose you want your Pod to be scheduled with a particular priority but don't want to evict any existing Pods. In that case, you can mark a PriorityClass with the field preemptionPolicy: Never. Pods assigned to this priority class will not trigger any eviction of running Pods but will still get scheduled according to their priority value.</p>
<p>Pod QoS (discussed previously) and Pod priority are two orthogonal features that are not connected and have only a little overlap. QoS is used primarily by the Kubelet to preserve node stability when available compute resources are low. The Kubelet first considers QoS and then the PriorityClass of Pods before eviction. On the other hand, the scheduler eviction logic ignores the QoS of Pods entirely when choosing preemption targets. The scheduler attempts to pick a set of Pods with the lowest priority possible that satisfies the needs of higher-priority Pods waiting to be placed.</p>
<p>When Pods have a priority specified, it can have an undesired effect on other Pods that are evicted. For example, while a Pod's graceful termination policies are respected, the PodDisruptionBudget as discussed in Chapter 10, "Singleton Service", is not guaranteed, which could break a lower-priority clustered application that relies on a quorum of Pods.</p>
<p>Another concern is a malicious or uninformed user who creates Pods with the highest possible priority and evicts all other Pods. To prevent that, ResourceQuota has been extended to support PriorityClass, and higher-priority numbers are reserved for critical system-Pods that should not usually be preempted or evicted.</p>
<p>In conclusion, Pod priorities should be used with caution because user-specified numerical priorities that guide the scheduler and Kubelet about which Pods to place or to kill are subject to gaming by users. Any change could affect many Pods and could prevent the platform from delivering predictable service-level agreements.</p>
<h3 id="30-100-project-resources">Project Resources<a class="headerlink" href="#30-100-project-resources" title="Permanent link">&para;</a></h3>
<p>Kubernetes is a self-service platform that enables developers to run applications as they see suitable on the designated isolated environments. However, working in a shared multitenanted platform also requires the presence of specific boundaries and control units to prevent some users from consuming all the platform's resources. One such tool is ResourceQuota, which provides constraints for limiting the aggregated resource consumption in a namespace. With ResourceQuotas, the cluster administrators can limit the total sum of computing resources (CPU, memory) and storage consumed. It can also limit the total number of objects (such as ConfigMaps, Secrets, Pods, or Services) created in a namespace.</p>
<p>Another helpful tool in this area is LimitRange, which allows you to set resource usage limits for each type of resource. In addition to specifying the minimum and maximum permitted amounts for different resource types and the default values for these resources, it also allows you to control the ratio between the requests and limits, also known as the overcommit level.</p>
<p>LimitRanges help control the container resource profiles so that no containers require more resources than a cluster node can provide. LimitRanges can also prevent cluster users from creating containers that consume many resources, making the nodes not allocatable for other containers. Considering that the requests (and not limits) are the primary container characteristic the scheduler uses for placing, LimitRequestRatio allows you to control the amount of difference between the requests and limits of containers. A big combined gap between requests and limits increases the chances of overcommitting on the node and may degrade application performance when many containers simultaneously require more resources than initially requested.</p>
<p>Keep in mind that other shared node-level resources such as process IDs (PIDs) can be exhausted before hitting any resource limits. Kubernetes allows you to reserve a number of node PIDs for the system use and ensure that they are never exhausted by user workloads. Similarly, Pod PID limits allow a cluster administrator to limit the number of processes running in a Pod. We are not reviewing these in details here as they are set as Kubelet configurations options by cluster administrators and are not used by application developers.</p>
<h3 id="30-100-capacity-planning">Capacity Planning<a class="headerlink" href="#30-100-capacity-planning" title="Permanent link">&para;</a></h3>
<p>Considering that containers may have different resource profiles in different environments, and a varied number of instances, it is evident that capacity planning for a multipurpose environment is not straightforward. For example, for best hardware utilization, on a nonproduction cluster, you may have mainly Best-Effort and Burstable containers. In such a dynamic environment, many containers are starting up and shutting down at the same time, and even if a container gets killed by the platform during resource starvation, it is not fatal. On the production cluster, where we want things to be more stable and predictable, the containers may be mainly of the Guaranteed type, and some may be Burstable. If a container gets killed, that is most likely a sign that the capacity of the cluster should be increased.</p>
<p>Of course, in a real-life scenario, the more likely reason you are using a platform such as Kubernetes is that there are many more services to manage, some of which are about to retire, and some of which are still in the design and development phase. Even if it is a continually moving target, based on a similar approach as described previously, we can calculate the total amount of resources needed for all the services per environment.</p>
<p>Keep in mind that in the different environments, there are different numbers of containers, and you may even need to leave some room for autoscaling, build jobs, infrastructure containers, and more. Based on this information and the infrastructure provider, you can choose the most cost-effective compute instances that provide the required resources.</p>
<h2 id="30-100-discussion_1">Discussion<a class="headerlink" href="#30-100-discussion_1" title="Permanent link">&para;</a></h2>
<p>Containers are useful not only for process isolation and as a packaging format. With identified resource profiles, they are also the building blocks for successful capacity planning. Perform some early tests to discover the resource needs for each container, and use that information as a base for future capacity planning and prediction.</p>
<p>Kubernetes can help you here with the Vertical Pod Autoscaler (VPA), which monitors the resource consumption of your Pod over time and gives a recommendation for requests and limits. The VPA is described in detail in "Vertical Pod Autoscaling" on page 325.</p>
<p>However, more importantly, resource profiles are the way an application communicates with Kubernetes to assist in scheduling and managing decisions. If your application doesn't provide any requests or limits, all Kubernetes can do is treat your containers as opaque boxes that are dropped when the cluster gets full. So it is more or less mandatory for every application to think about and provide these resource declarations.</p>
<p>Now that you know how to size our applications, in Chapter 3, "Declarative Deployment", you will learn multiple strategies to install and update our applications on Kubernetes.</p>
<h2 id="30-100-more-information_1">More Information<a class="headerlink" href="#30-100-more-information_1" title="Permanent link">&para;</a></h2>
<ul>
<li>Predictable Demands Example</li>
<li>Configure a Pod to Use a ConfigMap</li>
<li>Kubernetes Best Practices: Resource Requests and Limits</li>
<li>Resource Management for Pods and Containers</li>
<li>Manage HugePages</li>
<li>Configure Default Memory Requests and Limits for a Namespace</li>
<li>Node-Pressure Eviction</li>
<li>Pod Priority and Preemption</li>
<li>Configure Quality of Service for Pods</li>
<li>Resource Quality of Service in Kubernetes</li>
<li>Resource Quotas</li>
<li>Limit Ranges</li>
<li>Process ID Limits and Reservations</li>
<li>For the Love of God, Stop Using CPU Limits on Kubernetes</li>
<li>What Everyone Should Know About Kubernetes Memory Limits</li>
</ul>
<h1 id="30-100-chapter-3-declarative-deployment">Chapter 3: Declarative Deployment<a class="headerlink" href="#30-100-chapter-3-declarative-deployment" title="Permanent link">&para;</a></h1>
<p>The heart of the Declarative Deployment pattern is the Kubernetes Deployment resource. This abstraction encapsulates the upgrade and rollback processes of a group of containers and makes its execution a repeatable and automated activity.</p>
<h2 id="30-100-problem_1">Problem<a class="headerlink" href="#30-100-problem_1" title="Permanent link">&para;</a></h2>
<p>We can provision isolated environments as namespaces in a self-service manner and place the applications in these environments with minimal human intervention through the scheduler. But with a growing number of microservices, continually updating and replacing them with newer versions becomes an increasing burden too.</p>
<p>Upgrading a service to a next version involves activities such as starting the new version of the Pod, stopping the old version of a Pod gracefully, waiting and verifying that it has launched successfully, and sometimes rolling it all back to the previous version in the case of failure. These activities are performed either by allowing some downtime but not running concurrent service versions, or with no downtime but increased resource usage due to both versions of the service running during the update process. Performing these steps manually can lead to human errors, and scripting properly can require a significant amount of effort, both of which quickly turn the release process into a bottleneck.</p>
<h2 id="30-100-solution_1">Solution<a class="headerlink" href="#30-100-solution_1" title="Permanent link">&para;</a></h2>
<p>Luckily, Kubernetes has automated application upgrades as well. Using the concept of Deployment, we can describe how our application should be updated, using different strategies and tuning the various aspects of the update process. If you consider that you do multiple Deployments for every microservice instance per release cycle (which, depending on the team and project, can span from minutes to several months), this is another effort-saving automation by Kubernetes.</p>
<p>In Chapter 2, "Predictable Demands", we saw that, to do its job effectively, the scheduler requires sufficient resources on the host system, appropriate placement policies, and containers with adequately defined resource profiles. Similarly, for a Deployment to do its job correctly, it expects the containers to be good cloud native citizens. At the very core of a Deployment is the ability to start and stop a set of Pods predictably. For this to work as expected, the containers themselves usually listen and honor lifecycle events (such as SIGTERM; see Chapter 5, "Managed Lifecycle") and also provide health-check endpoints as described in Chapter 4, "Health Probe", which indicate whether they started successfully.</p>
<p>If a container covers these two areas accurately, the platform can cleanly shut down old containers and replace them by starting updated instances. Then</p></section><section class="print-page" id="streamlit-guide"><h1 id="streamlit-guide-understanding-streamlit-for-web-app-development">Understanding Streamlit for Web App Development<a class="headerlink" href="#streamlit-guide-understanding-streamlit-for-web-app-development" title="Permanent link">&para;</a></h1>
<h2 id="streamlit-guide-introduction">Introduction<a class="headerlink" href="#streamlit-guide-introduction" title="Permanent link">&para;</a></h2>
<p>Streamlit is a powerful Python library that enables developers to create web applications with minimal effort. It transforms Python scripts into shareable web apps through a simple, yet powerful API that lets you create everything from data visualizations to machine learning applications.</p>
<h2 id="streamlit-guide-key-features-and-capabilities">Key Features and Capabilities<a class="headerlink" href="#streamlit-guide-key-features-and-capabilities" title="Permanent link">&para;</a></h2>
<p>Streamlit excels at creating data-focused web applications by providing:</p>
<ol>
<li>Direct integration with popular data science libraries like Pandas, NumPy, and scikit-learn</li>
<li>Real-time data updates and interactive widgets</li>
<li>Built-in support for charts and visualizations</li>
<li>Automatic responsive layouts</li>
<li>Session state management for maintaining user data</li>
<li>Easy deployment options through Streamlit Cloud or other platforms</li>
</ol>
<h2 id="streamlit-guide-basic-example">Basic Example<a class="headerlink" href="#streamlit-guide-basic-example" title="Permanent link">&para;</a></h2>
<p>Here's a simple example that demonstrates how to create a Streamlit app:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">streamlit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">st</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Create a title for your app</span>
<span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;My First Streamlit App&#39;</span><span class="p">)</span>

<span class="c1"># Add some text</span>
<span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Welcome to this demonstration of Streamlit&#39;s capabilities!&quot;</span><span class="p">)</span>

<span class="c1"># Create a DataFrame with random data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Column 1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;Column 2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1"># Display the DataFrame</span>
<span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Add a chart</span>
<span class="n">st</span><span class="o">.</span><span class="n">line_chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Add an interactive widget</span>
<span class="n">user_input</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s1">&#39;Select a value&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;You selected: </span><span class="si">{</span><span class="n">user_input</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="streamlit-guide-common-use-cases">Common Use Cases<a class="headerlink" href="#streamlit-guide-common-use-cases" title="Permanent link">&para;</a></h2>
<p>Streamlit is particularly well-suited for:</p>
<ul>
<li>Data Visualization Dashboards</li>
<li>Machine Learning Model Demonstrations</li>
<li>Data Exploration Tools</li>
<li>Interactive Reports</li>
<li>Prototype Applications</li>
<li>Internal Tools</li>
</ul>
<h2 id="streamlit-guide-advantages">Advantages<a class="headerlink" href="#streamlit-guide-advantages" title="Permanent link">&para;</a></h2>
<p>Streamlit offers several benefits that make it an excellent choice for web app development:</p>
<h3 id="streamlit-guide-development-speed">Development Speed<a class="headerlink" href="#streamlit-guide-development-speed" title="Permanent link">&para;</a></h3>
<ul>
<li>No frontend experience required</li>
<li>Single-file applications</li>
<li>Hot-reloading during development</li>
<li>Minimal boilerplate code</li>
</ul>
<h3 id="streamlit-guide-python-native">Python-Native<a class="headerlink" href="#streamlit-guide-python-native" title="Permanent link">&para;</a></h3>
<ul>
<li>Works seamlessly with Python libraries</li>
<li>Familiar syntax for data scientists</li>
<li>Easy integration with existing Python code</li>
</ul>
<h3 id="streamlit-guide-interactive-features">Interactive Features<a class="headerlink" href="#streamlit-guide-interactive-features" title="Permanent link">&para;</a></h3>
<ul>
<li>Built-in widgets and components</li>
<li>Real-time updates</li>
<li>Session state management</li>
<li>File uploaders and downloads</li>
</ul>
<h2 id="streamlit-guide-limitations">Limitations<a class="headerlink" href="#streamlit-guide-limitations" title="Permanent link">&para;</a></h2>
<p>While powerful, Streamlit does have some constraints:</p>
<ul>
<li>Less flexible than traditional web frameworks</li>
<li>Limited custom styling options</li>
<li>Not ideal for complex, multi-page applications</li>
<li>May have performance limitations with very large datasets</li>
</ul>
<h2 id="streamlit-guide-getting-started">Getting Started<a class="headerlink" href="#streamlit-guide-getting-started" title="Permanent link">&para;</a></h2>
<p>To begin developing with Streamlit:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Install Streamlit</span>
pip<span class="w"> </span>install<span class="w"> </span>streamlit

<span class="c1"># Create a new file (app.py)</span>
<span class="c1"># Run your app</span>
streamlit<span class="w"> </span>run<span class="w"> </span>app.py
</code></pre></div>
<h2 id="streamlit-guide-best-practices">Best Practices<a class="headerlink" href="#streamlit-guide-best-practices" title="Permanent link">&para;</a></h2>
<p>When developing Streamlit applications:</p>
<ol>
<li>Structure your code logically with clear sections</li>
<li>Cache computationally expensive operations using <code>@st.cache</code></li>
<li>Use appropriate widgets for user interaction</li>
<li>Consider mobile responsiveness</li>
<li>Implement error handling for robust applications</li>
</ol>
<h2 id="streamlit-guide-deployment-options">Deployment Options<a class="headerlink" href="#streamlit-guide-deployment-options" title="Permanent link">&para;</a></h2>
<p>Streamlit applications can be deployed through:</p>
<ul>
<li>Streamlit Cloud (formerly Streamlit Sharing)</li>
<li>Heroku</li>
<li>AWS</li>
<li>Google Cloud Platform</li>
<li>Private servers</li>
</ul>
<h2 id="streamlit-guide-conclusion">Conclusion<a class="headerlink" href="#streamlit-guide-conclusion" title="Permanent link">&para;</a></h2>
<p>Streamlit represents a significant advancement in creating data-focused web applications with Python. Its simplicity, combined with powerful features, makes it an excellent choice for developers who want to quickly create interactive web applications without dealing with traditional web development complexities.</p>
<p>For more information and detailed documentation, visit the official Streamlit website and documentation.</p></section><h1 class='nav-section-title-end'>Ended: Other</h1></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "/docs/", "features": ["content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
    
  </body>
</html>